{"version":3,"sources":["components/layout/stories/Story.tsx","components/pages/Stories.tsx"],"names":["Screen","styled","div","ZIndex","POST","OVERLAY","Story","props","index","onInView","onFinished","onBack","active","React","useState","ref","setRef","useIsOnScreen","isInView","useSelector","selectPostByIndex","type","preview_url","sample_url","file_url","width","height","useEffect","scrollIntoView","id","Media","thumbnailSrc","sampleSrc","fullSrc","onLoad","NO_OP","detailsVisible","isFullscreen","isActive","StoriesWrapper","Filler","css","Math","max","Stories","dispatch","useDispatch","history","useHistory","currentIdx","selectFullsceenIndex","postCount","selectCount","nextIdx","prevIdx","indexes","setIndex","useCallback","setFullscreenPost","scrollToPrevious","document","getElementById","behavior","scrollToNext","handler","fullscreenElement","goBack","addEventListener","passive","removeEventListener","openFullscreen","map"],"mappings":"ySAQMA,EAASC,IAAOC,IAAV,mYAcGC,IAAOC,KAIPD,IAAOE,SAkBP,SAASC,EAAMC,GAC5B,IAAQC,EAAwDD,EAAxDC,MAAOC,EAAiDF,EAAjDE,SAAUC,EAAuCH,EAAvCG,WAAYC,EAA2BJ,EAA3BI,OAArC,EAAgEJ,EAAnBK,cAA7C,SACA,EAAsBC,IAAMC,SAA6B,MAAzD,mBAAOC,EAAP,KAAYC,EAAZ,KACA,EAAmBC,YAAcF,GAA1BG,EAAP,oBACA,EAAmEC,YAAYC,YAAkBZ,IAAzFa,EAAR,EAAQA,KAAMC,EAAd,EAAcA,YAAaC,EAA3B,EAA2BA,WAAYC,EAAvC,EAAuCA,SAAUC,EAAjD,EAAiDA,MAAOC,EAAxD,EAAwDA,OAcxD,OAZAb,IAAMc,WAAU,WACVf,GAAUG,GACZA,EAAIa,mBAEL,CAAChB,EAAQG,IAEZF,IAAMc,WAAU,WACVlB,GAAYS,GACdT,EAASD,KAEV,CAACA,EAAOU,EAAUT,IAGnB,cAACT,EAAD,CAAQ6B,GAAE,gBAAWrB,GAASO,IAAKC,EAAnC,SACE,cAACc,EAAA,EAAD,CACET,KAAMA,EACNb,MAAOA,EACPuB,aAAcT,EACdU,UAAWT,EACXU,QAAST,EACTU,OAAQC,IACRV,MAAOA,EACPC,OAAQA,EACRU,gBAAgB,EAChBC,cAAc,EACd3B,WAAYA,EACZC,OAAQA,EACR2B,SAAUpB,MCnElB,IAAMqB,EAAiBtC,IAAOC,IAAV,sNAiBdsC,EAASvC,IAAOC,KACpB,gBAAGM,EAAH,EAAGA,MAAH,OAA4BiC,YAA3B,IAAD,+CACYC,KAAKC,IAAInC,EAAQ,EAAG,OAI5BR,EAASC,IAAOC,IAAV,wUAoBG,SAAS0C,IACtB,IAAMC,EAAWC,cACXC,EAAUC,cAEhB,EAAsBnC,IAAMC,SAA6B,MAAzD,mBAAOC,EAAP,KAAYC,EAAZ,KAEMiC,EAAa9B,YAAY+B,KACzBC,EAAYhC,YAAYiC,KACxBC,EAAUJ,EAAa,EACvBK,EAAUL,EAAa,EAEvBM,EAAU,CAACD,EAASL,EAAYI,GAEhCG,EAAW3C,IAAM4C,aAAY,SAACjD,GAAD,OAAmBqC,EAASa,YAAkBlD,MAAS,CAACqC,IAErFc,EAAmB9C,IAAM4C,aAAY,WAAO,IAAD,EAC/C,UAAAG,SAASC,eAAT,gBAAiCP,WAAjC,SAA6C1B,eAAe,CAAEkC,SAAU,aACvE,CAACR,IAEES,EAAelD,IAAM4C,aAAY,WAAO,IAAD,EAC3C,UAAAG,SAASC,eAAT,gBAAiCR,WAAjC,SAA6CzB,eAAe,CAAEkC,SAAU,aACvE,CAACT,IAsBJ,OApBAxC,IAAMc,WAAU,WACd,IAAMqC,EAAU,WACTJ,SAASK,mBACZlB,EAAQmB,UAMZ,OAFAN,SAASO,iBAAiB,mBAAoBH,EAAS,CAAEI,SAAS,IAE3D,WACLR,SAASS,oBAAoB,mBAAoBL,MAElD,CAACjB,IAEJlC,IAAMc,WAAU,WACVZ,GACFuD,YAAevD,KAEhB,CAACA,IAGF,eAACwB,EAAD,CAAgBxB,IAAKC,EAArB,UACE,cAACwB,EAAD,CAAQhC,MAAOyC,IACdM,EAAQgB,KAAI,SAAC/D,GACZ,OAAIA,EAAQ,EAAU,KAClBA,GAAS2C,EAET,cAAC,EAAD,UACE,cAAC,IAAD,KADW3C,GAIbA,EAAQyC,GACRzC,EAAQyC,EADmB,cAAC3C,EAAD,CAAmBE,MAAOA,EAAOC,SAAU+C,GAA/BhD,GAEpC,cAACF,EAAD,CAAmBE,MAAOA,EAAOE,WAAYqD,EAAcpD,OAAQgD,EAAkB/C,QAAM,GAA/EJ","file":"static/js/11.e5e53268.chunk.js","sourcesContent":["import React from 'react'\nimport { useSelector } from 'react-redux'\nimport styled from 'styled-components'\nimport { NO_OP } from '../../../data/types'\nimport useIsOnScreen from '../../../hooks/useIsOnScreen'\nimport { selectPostByIndex } from '../../../redux/selectors'\nimport { ZIndex } from '../../../styled/zIndex'\nimport { Media } from '../../player/Media'\nconst Screen = styled.div`\n  min-height: 100vh;\n  min-width: 100vw;\n  max-height: 100vh;\n  max-width: 100vw;\n  scroll-snap-align: start;\n  scroll-snap-stop: always;\n\n  display: grid;\n\n  img,\n  video {\n    max-height: 100vh;\n    max-width: 100vw;\n    z-index: ${ZIndex.POST};\n  }\n\n  .overlay {\n    z-index: ${ZIndex.OVERLAY};\n  }\n\n  img,\n  video,\n  .overlay {\n    grid-area: 1/1/2/2;\n  }\n`\n\ninterface StoryProps {\n  index: number\n  onInView?: (index: number) => void\n  onFinished?: () => void\n  onBack?: () => void\n  active?: boolean\n}\n\nexport default function Story(props: StoryProps) {\n  const { index, onInView, onFinished, onBack, active = false } = props\n  const [ref, setRef] = React.useState<HTMLElement | null>(null)\n  const [isInView] = useIsOnScreen(ref)\n  const { type, preview_url, sample_url, file_url, width, height } = useSelector(selectPostByIndex(index))\n\n  React.useEffect(() => {\n    if (active && ref) {\n      ref.scrollIntoView()\n    }\n  }, [active, ref])\n\n  React.useEffect(() => {\n    if (onInView && isInView) {\n      onInView(index)\n    }\n  }, [index, isInView, onInView])\n\n  return (\n    <Screen id={`story-${index}`} ref={setRef}>\n      <Media\n        type={type}\n        index={index}\n        thumbnailSrc={preview_url}\n        sampleSrc={sample_url}\n        fullSrc={file_url}\n        onLoad={NO_OP}\n        width={width}\n        height={height}\n        detailsVisible={false}\n        isFullscreen={true}\n        onFinished={onFinished}\n        onBack={onBack}\n        isActive={isInView}\n      />\n    </Screen>\n  )\n}\n","import React from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { useHistory } from 'react-router-dom'\nimport styled, { css } from 'styled-components'\nimport { openFullscreen } from '../../data/browserUtils'\nimport { setFullscreenPost } from '../../redux/actions'\nimport { selectCount, selectFullsceenIndex } from '../../redux/selectors'\nimport { OutOfItems } from '../layout/LayoutOutOfItems'\nimport Story from '../layout/stories/Story'\n\nconst StoriesWrapper = styled.div`\n  height: 100vh;\n  width: 100vw;\n  overflow: scroll;\n  scroll-snap-type: y mandatory;\n  scroll-snap-stop: always;\n\n  ::-webkit-scrollbar {\n    height: 0px;\n    width: 0px;\n  }\n`\n\ntype FillerProps = {\n  index: number\n}\n\nconst Filler = styled.div(\n  ({ index }: FillerProps) => css`\n    height: ${Math.max(index - 1, 0)}00vh;\n  `\n)\n\nconst Screen = styled.div`\n  min-height: 100vh;\n  min-width: 100vw;\n  max-height: 100vh;\n  max-width: 100vw;\n\n  scroll-snap-align: start;\n  scroll-snap-stop: always;\n\n  display: grid;\n  place-content: center;\n\n  @media (pointer: fine) {\n    ::-webkit-scrollbar {\n      height: 0px;\n      width: 0px;\n    }\n  }\n`\n\nexport default function Stories() {\n  const dispatch = useDispatch()\n  const history = useHistory()\n\n  const [ref, setRef] = React.useState<HTMLElement | null>(null)\n\n  const currentIdx = useSelector(selectFullsceenIndex)\n  const postCount = useSelector(selectCount)\n  const nextIdx = currentIdx + 1\n  const prevIdx = currentIdx - 1\n\n  const indexes = [prevIdx, currentIdx, nextIdx]\n\n  const setIndex = React.useCallback((index: number) => dispatch(setFullscreenPost(index)), [dispatch])\n\n  const scrollToPrevious = React.useCallback(() => {\n    document.getElementById(`story-${prevIdx}`)?.scrollIntoView({ behavior: 'smooth' })\n  }, [prevIdx])\n\n  const scrollToNext = React.useCallback(() => {\n    document.getElementById(`story-${nextIdx}`)?.scrollIntoView({ behavior: 'smooth' })\n  }, [nextIdx])\n\n  React.useEffect(() => {\n    const handler = () => {\n      if (!document.fullscreenElement) {\n        history.goBack()\n      }\n    }\n\n    document.addEventListener('fullscreenchange', handler, { passive: true })\n\n    return () => {\n      document.removeEventListener('fullscreenchange', handler)\n    }\n  }, [history])\n\n  React.useEffect(() => {\n    if (ref) {\n      openFullscreen(ref)\n    }\n  }, [ref])\n\n  return (\n    <StoriesWrapper ref={setRef}>\n      <Filler index={currentIdx} />\n      {indexes.map((index) => {\n        if (index < 0) return null\n        if (index >= postCount)\n          return (\n            <Screen key={index}>\n              <OutOfItems />\n            </Screen>\n          )\n        if (index < currentIdx) return <Story key={index} index={index} onInView={setIndex} />\n        if (index > currentIdx) return <Story key={index} index={index} onInView={setIndex} />\n        return <Story key={index} index={index} onFinished={scrollToNext} onBack={scrollToPrevious} active />\n      })}\n    </StoriesWrapper>\n  )\n}\n"],"sourceRoot":""}