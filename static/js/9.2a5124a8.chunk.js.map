{"version":3,"sources":["hooks/useFirebaseAuthState.tsx","hooks/usePageTitle.tsx","data/encryption.ts","hooks/useSupertags.ts","components/pages/Share.tsx"],"names":["useFirebaseAuthState","useState","authState","setAuthState","user","setUser","useEffect","unsubscribe","firebase","auth","onAuthStateChanged","usePageTitle","title","React","document","message","a","msgBuffer","TextEncoder","encode","crypto","subtle","digest","hashBuffer","hashArray","Array","from","Uint8Array","hashHex","map","b","toString","padStart","join","useSupertags","supertags","setSupertags","collection","setCollection","userInfo","email","sha256","then","hash","col","firestore","get","snapshot","result","docs","reduce","doc","id","data","catch","err","console","error","onSnapshot","ShareColumn","styled","FlexColumnWithSpacing","SupertagSurface","Surface","theme","css","dimensions","hugeSpacing","modalWidth","Name","Title","ShortDesc","Faded","ImportButton","PrimaryButton","ScrollFaded","Link","span","flexRowWithGap","layer","bigSpacing","colors","subduedText","accentColor","Tags","TagList","TAG_NO_OP","tag","About","location","useLocation","decodeSupertag","search","name","description","tags","tagObjects","useMemo","Object","entries","modifier","types","copySupertagUrl","useCallback","navigator","permissions","query","state","clipboard","writeText","window","href","warn","signedIn","handleImport","addSupertag","deleteSupertag","removeSupertag","imported","disabled","onClick","detailed","onTagClick","onTagMenu","NO_OP"],"mappings":"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","file":"static/js/9.2a5124a8.chunk.js","sourcesContent":["import firebase from 'firebase/app'\nimport 'firebase/auth'\nimport { useEffect, useState } from 'react'\n\n/**\n * A hook that provides the firebase authentication status for use in functional components.\n */\nexport default function useFirebaseAuthState() {\n  const [authState, setAuthState] = useState(false)\n  const [user, setUser] = useState<firebase.User | null>(null)\n\n  useEffect(() => {\n    try {\n      const unsubscribe = firebase\n      .auth()\n      .onAuthStateChanged((user) => {\n        if (user) {\n          setAuthState(true)\n          setUser(user)\n        } else {\n          setAuthState(false)\n          setUser(null)\n        }\n      })\n      return () => {\n        unsubscribe()\n      }\n    } catch {\n      setAuthState(false)\n      setUser(null)\n    }\n  }, [])\n\n  return [authState, user] as const\n}\n","import React from 'react'\n\n/**\n * Effect that sets the title of the page to a specified string.\n * Really small utility hook that saves a few lines.\n */\nexport function usePageTitle(title: string) {\n  React.useEffect(() => {\n    document.title = title\n  }, [title])\n}\n","export async function sha256(message: string) {\n  const msgBuffer = new TextEncoder().encode(message)\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer)\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\n  const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('')\n\n  return hashHex\n}\n","import React from 'react'\nimport firebase from 'firebase'\nimport * as r34 from 'r34-types'\nimport useFirebaseAuthState from './useFirebaseAuthState'\nimport { sha256 } from '../data/encryption'\n\nexport function useSupertags() {\n  const [supertags, setSupertags] = React.useState<Record<string, r34.SupertagData>>({})\n  const [collection, setCollection] = React.useState<firebase.firestore.CollectionReference>()\n\n  const [, userInfo] = useFirebaseAuthState()\n\n  React.useEffect(() => {\n    if (userInfo?.email) {\n      sha256(userInfo.email)\n        .then((hash) => {\n          const col = firebase.firestore().collection(`users/${hash}/supertags`)\n          setCollection(col)\n          return col.get()\n        })\n        .then((snapshot) => {\n          const result = snapshot.docs.reduce((result, doc) => {\n            result[doc.id] = doc.data() as r34.SupertagData\n            return result\n          }, {} as Record<string, r34.SupertagData>)\n\n          setSupertags(result)\n        })\n        .catch((err) => {\n          console.error('Error with useSupertags', err)\n        })\n    }\n  }, [userInfo?.email])\n\n  React.useEffect(() => {\n    if (collection) {\n      const unsubscribe = collection.onSnapshot((snapshot) => {\n        const result = snapshot.docs.reduce((result, doc) => {\n          const userSupertags = doc\n          result[userSupertags.id] = doc.data() as r34.SupertagData\n          return result\n        }, {} as Record<string, r34.SupertagData>)\n\n        setSupertags(result)\n      })\n\n      return () => {\n        unsubscribe()\n      }\n    }\n  }, [collection])\n\n  return supertags\n}\n","import * as r34 from 'r34-types'\nimport React from 'react'\nimport { useLocation } from 'react-router-dom'\nimport styled, { css } from 'styled-components'\nimport { decodeSupertag } from '../../data/tagUtils'\nimport { addSupertag, removeSupertag } from '../../client/firebase'\nimport { usePageTitle } from '../../hooks/usePageTitle'\nimport { CopyIcon, PlusIcon, SuccessIcon } from '../../icons/FontAwesomeIcons'\nimport { PrimaryButton } from '../designsystem/Buttons'\nimport { FlexColumn, FlexColumnWithSpacing } from '../designsystem/FlexColumn'\nimport { Surface } from '../designsystem/Surface'\nimport { Faded, Title } from '../designsystem/Text'\nimport Header from '../features/Header'\nimport TagList from '../tag/TagList'\nimport { NO_OP } from '../../data/types'\nimport { flexRowWithGap } from '../../styled/mixins/layout'\nimport { layer } from '../../styled/mixins/theming'\nimport useFirebaseAuthState from '../../hooks/useFirebaseAuthState'\nimport { useSupertags } from '../../hooks/useSupertags'\n\nconst ShareColumn = styled(FlexColumnWithSpacing)`\n  place-content: center;\n  align-items: center;\n  place-content: center;\n  flex-grow: 1;\n`\n\nconst SupertagSurface = styled(Surface)(\n  ({ theme }) => css`\n    grid-template-rows: auto auto auto 1fr;\n    grid-template-columns: 1fr auto;\n    padding: ${theme.dimensions.hugeSpacing};\n    justify-content: center;\n    max-width: ${theme.dimensions.modalWidth};\n  `\n)\n\nconst Name = styled(Title)`\n  text-align: left;\n  grid-area: 1/1/2/2;\n`\n\nconst ShortDesc = styled(Faded)`\n  grid-area: 2/1/3/3;\n`\n\nconst ImportButton = styled(PrimaryButton)`\n  grid-area: 1/2/2/3;\n`\n\nconst ScrollFaded = styled(Faded)`\n  overflow-x: auto;\n  white-space: nowrap;\n  mask-image: linear-gradient(90deg, #000 95%, transparent);\n  ::-webkit-scrollbar {\n    height: 0px;\n  }\n`\n\nconst Link = styled.span(\n  ({ theme }) => css`\n    ${flexRowWithGap}\n    ${layer}\n    padding: ${theme.dimensions.bigSpacing};\n    color: ${theme.colors.subduedText};\n    grid-area: 3/1/4/3;\n    cursor: pointer;\n\n    :active,\n    :active > span {\n      color: ${theme.colors.accentColor};\n    }\n  `\n)\n\nconst Tags = styled(TagList)`\n  grid-area: 4/1/5/3;\n`\n\nconst TAG_NO_OP = (tag: r34.AnyBiasedTag) => {}\n\nexport default function About() {\n  const location = useLocation()\n\n  const { name, description, tags } = decodeSupertag(location.search)\n\n  usePageTitle(`Rule34 React - ${name}`)\n\n  const tagObjects = React.useMemo(\n    () =>\n      Object.entries(tags).reduce((result, [name, modifier]) => {\n        result[name] = { name, modifier, types: [] }\n        return result\n      }, {} as Record<string, Omit<r34.BiasedTag, 'count'>>),\n    [tags]\n  )\n\n  const copySupertagUrl = React.useCallback(() => {\n    navigator.permissions.query({ name: 'clipboard-write' as PermissionName }).then((result) => {\n      if (result.state === 'granted' || result.state === 'prompt') {\n        navigator.clipboard.writeText(window.location.href).then(\n          () => {},\n          () => {\n            console.warn('Failed to write to clipboard')\n          }\n        )\n      }\n    })\n  }, [])\n\n  const [signedIn] = useFirebaseAuthState()\n  const supertags = useSupertags()\n\n  const handleImport = React.useCallback(() => {\n    addSupertag(name, description, tags)\n      .then(() => {})\n      .catch((err) => console.error('Failed to import supertag', err))\n  }, [description, name, tags])\n  const deleteSupertag = React.useCallback(() => removeSupertag(name), [name])\n\n  const imported = React.useMemo(() => {\n    return signedIn && name in supertags\n  }, [name, signedIn, supertags])\n\n  return (\n    <FlexColumn>\n      <Header />\n      <ShareColumn>\n        <Title>Supertag</Title>\n\n        <SupertagSurface>\n          <Name>{name}</Name>\n          <ShortDesc>{description}</ShortDesc>\n          {imported ? (\n            <ImportButton\n              disabled={!signedIn}\n              title={signedIn ? 'Remove from your collection' : 'You need to be signed in'}\n              onClick={deleteSupertag}\n            >\n              <SuccessIcon /> Imported\n            </ImportButton>\n          ) : (\n            <ImportButton\n              disabled={!signedIn}\n              title={signedIn ? 'Import into your collection' : 'You need to be signed in'}\n              onClick={handleImport}\n            >\n              <PlusIcon /> Import\n            </ImportButton>\n          )}\n\n          <Link onClick={copySupertagUrl} title='Copy share url'>\n            <ScrollFaded id='share-link'>{window.location.href}</ScrollFaded>\n            <CopyIcon />\n          </Link>\n          <Tags tags={tagObjects} detailed={false} onTagClick={TAG_NO_OP} onTagMenu={NO_OP} />\n        </SupertagSurface>\n      </ShareColumn>\n    </FlexColumn>\n  )\n}\n"],"sourceRoot":""}