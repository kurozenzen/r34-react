{"version":3,"sources":["hooks/useFirebaseAuthState.tsx","hooks/usePageTitle.tsx","hooks/useSupertags.ts","data/encryption.ts","components/pages/Share.tsx"],"names":["useFirebaseAuthState","authState","setAuthState","useState","user","setUser","useEffect","unsubscribe","firebase","auth","onAuthStateChanged","_unused","usePageTitle","title","React","document","useSupertags","supertags","setSupertags","collection","setCollection","userInfo","email","async","message","msgBuffer","TextEncoder","encode","hashBuffer","crypto","subtle","digest","Array","from","Uint8Array","map","b","toString","padStart","join","sha256","then","hash","col","firestore","concat","get","snapshot","result","docs","reduce","doc","id","data","catch","err","console","error","onSnapshot","ShareColumn","styled","FlexColumnWithSpacing","_templateObject","_taggedTemplateLiteral","SupertagSurface","Surface","_ref","theme","css","_templateObject2","dimensions","hugeSpacing","modalWidth","Name","Title","_templateObject3","ShortDesc","Faded","_templateObject4","ImportButton","PrimaryButton","_templateObject5","ScrollFaded","_templateObject6","Link","span","_ref2","_templateObject7","flexRowWithGap","layer","bigSpacing","colors","subduedText","accentColor","Tags","TagList","_templateObject8","TAG_NO_OP","tag","About","location","useLocation","name","description","tags","decodeSupertag","search","tagObjects","useMemo","Object","entries","_ref3","modifier","types","copySupertagUrl","useCallback","navigator","permissions","query","state","clipboard","writeText","window","href","warn","signedIn","handleImport","addSupertag","deleteSupertag","removeSupertag","imported","_jsxs","FlexColumn","children","_jsx","Header","disabled","onClick","SuccessIcon","PlusIcon","CopyIcon","detailed","onTagClick","onTagMenu","NO_OP"],"mappings":"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","file":"static/js/9.dca15171.chunk.js","sourcesContent":["import firebase from 'firebase/app'\r\nimport 'firebase/auth'\r\nimport { useEffect, useState } from 'react'\r\n\r\n/**\r\n * A hook that provides the firebase authentication status for use in functional components.\r\n */\r\nexport default function useFirebaseAuthState() {\r\n  const [authState, setAuthState] = useState(false)\r\n  const [user, setUser] = useState<firebase.User | null>(null)\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const unsubscribe = firebase\r\n      .auth()\r\n      .onAuthStateChanged((user) => {\r\n        if (user) {\r\n          setAuthState(true)\r\n          setUser(user)\r\n        } else {\r\n          setAuthState(false)\r\n          setUser(null)\r\n        }\r\n      })\r\n      return () => {\r\n        unsubscribe()\r\n      }\r\n    } catch {\r\n      setAuthState(false)\r\n      setUser(null)\r\n    }\r\n  }, [])\r\n\r\n  return [authState, user] as const\r\n}\r\n","import React from 'react'\r\n\r\n/**\r\n * Effect that sets the title of the page to a specified string.\r\n * Really small utility hook that saves a few lines.\r\n */\r\nexport function usePageTitle(title: string) {\r\n  React.useEffect(() => {\r\n    document.title = title\r\n  }, [title])\r\n}\r\n","import React from 'react'\r\nimport firebase from 'firebase'\r\nimport * as r34 from 'r34-types'\r\nimport useFirebaseAuthState from './useFirebaseAuthState'\r\nimport { sha256 } from '../data/encryption'\r\n\r\nexport function useSupertags() {\r\n  const [supertags, setSupertags] = React.useState<Record<string, r34.SupertagData>>({})\r\n  const [collection, setCollection] = React.useState<firebase.firestore.CollectionReference>()\r\n\r\n  const [, userInfo] = useFirebaseAuthState()\r\n\r\n  React.useEffect(() => {\r\n    if (userInfo?.email) {\r\n      sha256(userInfo.email)\r\n        .then((hash) => {\r\n          const col = firebase.firestore().collection(`users/${hash}/supertags`)\r\n          setCollection(col)\r\n          return col.get()\r\n        })\r\n        .then((snapshot) => {\r\n          const result = snapshot.docs.reduce((result, doc) => {\r\n            result[doc.id] = doc.data() as r34.SupertagData\r\n            return result\r\n          }, {} as Record<string, r34.SupertagData>)\r\n\r\n          setSupertags(result)\r\n        })\r\n        .catch((err) => {\r\n          console.error('Error with useSupertags', err)\r\n        })\r\n    }\r\n  }, [userInfo?.email])\r\n\r\n  React.useEffect(() => {\r\n    if (collection) {\r\n      const unsubscribe = collection.onSnapshot((snapshot) => {\r\n        const result = snapshot.docs.reduce((result, doc) => {\r\n          const userSupertags = doc\r\n          result[userSupertags.id] = doc.data() as r34.SupertagData\r\n          return result\r\n        }, {} as Record<string, r34.SupertagData>)\r\n\r\n        setSupertags(result)\r\n      })\r\n\r\n      return () => {\r\n        unsubscribe()\r\n      }\r\n    }\r\n  }, [collection])\r\n\r\n  return supertags\r\n}\r\n","export async function sha256(message: string) {\r\n  const msgBuffer = new TextEncoder().encode(message)\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer)\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\r\n  const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('')\r\n\r\n  return hashHex\r\n}\r\n","import * as r34 from 'r34-types'\r\nimport React from 'react'\r\nimport { useLocation } from 'react-router-dom'\r\nimport styled, { css } from 'styled-components'\r\nimport { decodeSupertag } from '../../data/tagUtils'\r\nimport { addSupertag, removeSupertag } from '../../client/firebase'\r\nimport { usePageTitle } from '../../hooks/usePageTitle'\r\nimport { CopyIcon, PlusIcon, SuccessIcon } from '../../icons/FontAwesomeIcons'\r\nimport { PrimaryButton } from '../designsystem/Buttons'\r\nimport { FlexColumn, FlexColumnWithSpacing } from '../designsystem/FlexColumn'\r\nimport { Surface } from '../designsystem/Surface'\r\nimport { Faded, Title } from '../designsystem/Text'\r\nimport Header from '../features/Header'\r\nimport TagList from '../tag/TagList'\r\nimport { NO_OP } from '../../data/types'\r\nimport { flexRowWithGap } from '../../styled/mixins/layout'\r\nimport { layer } from '../../styled/mixins/theming'\r\nimport useFirebaseAuthState from '../../hooks/useFirebaseAuthState'\r\nimport { useSupertags } from '../../hooks/useSupertags'\r\n\r\nconst ShareColumn = styled(FlexColumnWithSpacing)`\r\n  place-content: center;\r\n  align-items: center;\r\n  place-content: center;\r\n  flex-grow: 1;\r\n`\r\n\r\nconst SupertagSurface = styled(Surface)(\r\n  ({ theme }) => css`\r\n    grid-template-rows: auto auto auto 1fr;\r\n    grid-template-columns: 1fr auto;\r\n    padding: ${theme.dimensions.hugeSpacing};\r\n    justify-content: center;\r\n    max-width: ${theme.dimensions.modalWidth};\r\n  `\r\n)\r\n\r\nconst Name = styled(Title)`\r\n  text-align: left;\r\n  grid-area: 1/1/2/2;\r\n`\r\n\r\nconst ShortDesc = styled(Faded)`\r\n  grid-area: 2/1/3/3;\r\n`\r\n\r\nconst ImportButton = styled(PrimaryButton)`\r\n  grid-area: 1/2/2/3;\r\n`\r\n\r\nconst ScrollFaded = styled(Faded)`\r\n  overflow-x: auto;\r\n  white-space: nowrap;\r\n  mask-image: linear-gradient(90deg, #000 95%, transparent);\r\n  ::-webkit-scrollbar {\r\n    height: 0px;\r\n  }\r\n`\r\n\r\nconst Link = styled.span(\r\n  ({ theme }) => css`\r\n    ${flexRowWithGap}\r\n    ${layer}\r\n    padding: ${theme.dimensions.bigSpacing};\r\n    color: ${theme.colors.subduedText};\r\n    grid-area: 3/1/4/3;\r\n    cursor: pointer;\r\n\r\n    :active,\r\n    :active > span {\r\n      color: ${theme.colors.accentColor};\r\n    }\r\n  `\r\n)\r\n\r\nconst Tags = styled(TagList)`\r\n  grid-area: 4/1/5/3;\r\n`\r\n\r\nconst TAG_NO_OP = (tag: r34.AnyBiasedTag) => {}\r\n\r\nexport default function About() {\r\n  const location = useLocation()\r\n\r\n  const { name, description, tags } = decodeSupertag(location.search)\r\n\r\n  usePageTitle(`Rule34 React - ${name}`)\r\n\r\n  const tagObjects = React.useMemo(\r\n    () =>\r\n      Object.entries(tags).reduce((result, [name, modifier]) => {\r\n        result[name] = { name, modifier, types: [] }\r\n        return result\r\n      }, {} as Record<string, Omit<r34.BiasedTag, 'count'>>),\r\n    [tags]\r\n  )\r\n\r\n  const copySupertagUrl = React.useCallback(() => {\r\n    navigator.permissions.query({ name: 'clipboard-write' as PermissionName }).then((result) => {\r\n      if (result.state === 'granted' || result.state === 'prompt') {\r\n        navigator.clipboard.writeText(window.location.href).then(\r\n          () => {},\r\n          () => {\r\n            console.warn('Failed to write to clipboard')\r\n          }\r\n        )\r\n      }\r\n    })\r\n  }, [])\r\n\r\n  const [signedIn] = useFirebaseAuthState()\r\n  const supertags = useSupertags()\r\n\r\n  const handleImport = React.useCallback(() => {\r\n    addSupertag(name, description, tags)\r\n      .then(() => {})\r\n      .catch((err) => console.error('Failed to import supertag', err))\r\n  }, [description, name, tags])\r\n  const deleteSupertag = React.useCallback(() => removeSupertag(name), [name])\r\n\r\n  const imported = React.useMemo(() => {\r\n    return signedIn && name in supertags\r\n  }, [name, signedIn, supertags])\r\n\r\n  return (\r\n    <FlexColumn>\r\n      <Header />\r\n      <ShareColumn>\r\n        <Title>Supertag</Title>\r\n\r\n        <SupertagSurface>\r\n          <Name>{name}</Name>\r\n          <ShortDesc>{description}</ShortDesc>\r\n          {imported ? (\r\n            <ImportButton\r\n              disabled={!signedIn}\r\n              title={signedIn ? 'Remove from your collection' : 'You need to be signed in'}\r\n              onClick={deleteSupertag}\r\n            >\r\n              <SuccessIcon /> Imported\r\n            </ImportButton>\r\n          ) : (\r\n            <ImportButton\r\n              disabled={!signedIn}\r\n              title={signedIn ? 'Import into your collection' : 'You need to be signed in'}\r\n              onClick={handleImport}\r\n            >\r\n              <PlusIcon /> Import\r\n            </ImportButton>\r\n          )}\r\n\r\n          <Link onClick={copySupertagUrl} title='Copy share url'>\r\n            <ScrollFaded id='share-link'>{window.location.href}</ScrollFaded>\r\n            <CopyIcon />\r\n          </Link>\r\n          <Tags tags={tagObjects} detailed={false} onTagClick={TAG_NO_OP} onTagMenu={NO_OP} />\r\n        </SupertagSurface>\r\n      </ShareColumn>\r\n    </FlexColumn>\r\n  )\r\n}\r\n"],"sourceRoot":""}