{"version":3,"sources":["redux/actions.ts","redux/selectors.ts","styled/mixins/layout.ts","data/tagUtils.ts","icons/FontAwesomeIcons.tsx","data/types.ts","components/designsystem/Buttons.tsx","styled/mixins/theming.ts","styled/mixins/gap.ts","client/firebase/signIn.ts","client/firebase/genericConverter.ts","client/firebase/storage.ts","client/firebase/analytics.ts","client/firebase/index.ts","components/designsystem/Text.tsx","styled/zIndex.ts","data/browserUtils.ts","data/utils.ts","hooks/useAction.tsx","hooks/usePreference.tsx","components/designsystem/Surface.tsx","misc/formatting.ts","components/designsystem/FlexPair.tsx","components/designsystem/FlexImage.tsx","client/utils.ts","components/designsystem/LabeledToggle.tsx","icons/TypeIcon.tsx","styled/mixins/scrollbar.ts","components/designsystem/FlexColumn.tsx","styled/mixins/media.ts","client/tagUtils.ts","components/designsystem/Toggle.tsx","components/widgets/OfflineIndicator.tsx","hooks/useOnlineChange.ts","components/widgets/Menubar.tsx","components/features/Header.tsx","components/designsystem/ModifierStyledText.tsx","components/tag/TagName.tsx","components/tag/Alias.tsx","components/tag/AliasesList.tsx","components/tag/ChipWrapper.tsx","components/tag/TagChip.tsx","components/tag/Supertag.tsx","components/tag/BiasedTag.tsx","components/tag/Tag.tsx","components/tag/TagList.tsx","styled/mixins/shadow.ts","components/designsystem/Lines.tsx","hooks/useToggle.ts","hooks/useToggleTag.tsx","components/tagSelector/DropdownListEntry.tsx","components/tagSelector/DropdownListError.tsx","components/tagSelector/DropdownList.tsx","components/tagSelector/TagInput.tsx","components/tagSelector/TagSelector.tsx","components/widgets/ResetButton.tsx","icons/OutOfResults.png","icons/Loading.tsx","icons/R34Icon.tsx","hooks/useModifier.tsx","components/widgets/ActiveTags.tsx","hooks/useCheckIsActive.ts","hooks/useActivateTag.ts","components/features/ErrorBoundary.tsx","components/features/GlobalKeybindings.tsx","GlobalStyles.tsx","components/pages/ErrorScreen.tsx","components/pages/LoadingScreen.tsx","components/pages/Terms.tsx","components/designsystem/Modal.tsx","icons/eeek.png","components/widgets/CellularWarningModal.tsx","components/widgets/CookieConfirmation.tsx","components/widgets/SupertagModal.tsx","analytics/events.ts","redux/middleware/analytics.ts","redux/reducers/preferences.ts","redux/middleware/persistence.ts","redux/middleware/requests.ts","client/R34Client.ts","redux/middleware/index.ts","redux/migrations.ts","redux/reducers/results.ts","redux/reducers/tags.ts","redux/reducers/fullscreen.ts","redux/reducers/likes.ts","redux/reducers/modals.ts","redux/reducers/suggestions.ts","redux/reducers/index.ts","redux/store.ts","App.tsx","serviceWorkerRegistration.ts","index.tsx"],"names":["ADD_ALIASES","ADD_POSTS","ADD_TAG","CLOSE_MODAL","ENTER_FULLSCREEN","EXIT_FULLSCREEN","FETCH_COMMENTS","FETCH_PREFERENCES","FETCH_SUGGESTIONS","GET_MORE_RESULTS","GET_RESULTS","LIKE_POST","OPEN_MODAL","REMOVE_TAG","SAVE_PREFERENCES","SET_COMMENTS","SET_FULLSCREEN_POST","SET_POSTS","SET_PREFERENCE","SET_PREFERENCES","SET_SUGGESTIONS","SET_SUGGESTIONS_ERROR","SET_SUGGESTIONS_MODIFIER","SCROLL_TO_POST","addTag","tag","type","removeTag","tagName","addAliases","aliases","forTag","addPosts","posts","setPosts","count","pageNumber","arguments","length","undefined","setComments","postId","comments","fetchComments","setPreference","key","value","setPreferences","preferences","getResults","getMoreResults","setFullscreenPost","index","scrollToPost","likePost","openModal","modalId","closeModal","setSuggestions","suggestions","setSuggestionsError","error","fetchSuggestions","includeSupertags","savePreferences","setSuggestionsModifier","modifier","selectActiveTags","state","tags","active","selectActiveThemeId","themeId","selectAliases","selectAutoPlay","autoPlay","selectCookies","cookies","selectCount","results","selectFullsceenIndex","fullscreen","currentIndex","selectOpenModalId","modals","selectOriginals","originals","selectPageNumber","selectPageSize","pageSize","selectPosts","selectPreferences","selectPreloadVideos","preloadVideos","selectPreloadGifs","selectResultsLayout","resultsLayout","selectShowComments","showComments","selectShowMetadata","showMetadata","selectSort","sort","selectSuggestions","entries","selectSuggestionsError","selectSuggestionsModifier","selectTagSuggestionCount","tagSuggestionsCount","selectUpdated","updated","selectAutoscrollDelay","autoscrollDelay","selectShowPostDetails","showPostDetails","selectNumberOfActiveTags","createSelector","Object","keys","selectAliasesAsList","values","flat","selectOutOfResults","selectHasMoreResults","outOfResults","selectLastPage","Math","ceil","selectFullScreenPost","fullScreenIndex","selectFullScreenIndex","fullScreenPost","indexOf","selectMinRating","rated","ratedThreshold","selectSupertagModalOpen","selectedIndex","ModalId","CREATE_SUPERTAG","selectCellularWarningModalOpen","CELLULAR_WARNING","selectPostById","defaultMemoize","id","find","post","selectPostByIndex","selectLikedByPostId","likes","selectActiveSupertagTags","activeTags","filter","isSupertag","reduce","result","_objectSpread","multilineList","_ref","theme","css","_templateObject","_taggedTemplateLiteral","flexRowGap","dimensions","bigSpacing","flexColumnGap","flexColumn","_templateObject2","flexColumnWithGap","_ref2","_templateObject3","gridWithGap","_ref3","_templateObject4","gap","flexRowWithGap","_ref4","_templateObject5","centeredMaxWidth","_ref5","_templateObject6","bodyWidth","defaultBlock","_ref6","_templateObject7","blockHeight","fullscreenOverlay","_templateObject8","coverScreen","_templateObject9","buttonBaseStyle","_ref7","_templateObject0","borderRadius","fontSizes","content","defaultRowSpacing","transitionAll","serializeTagname","tagname","encodeURIComponent","toLowerCase","replace","bias","isBiased","getInterestingType","types","t","match","isSuggestionError","message","encodeSupertag","supertag","payload","concat","encodeURI","name","description","map","m","join","Buffer","from","toString","decodeSupertag","base64","parts","substr","split","decodeURI","fromEntries","e","bindIcon","icon","React","memo","props","_jsx","FontAwesomeIcon","ArrowDown","faCaretDown","ArtistIcon","faPen","CalendarIcon","faCalendarDay","CharacterIcon","faUser","CheckIcon","faCheckSquare","CloseIcon","faTimes","CodeBranchIcon","faCodeBranch","CopyIcon","faCopy","CopyrightIcon","faCopyright","DeviantArtIcon","faDeviantart","DiscordIcon","faDiscord","DownloadIcon","faDownload","ExpandIcon","faExpand","ExternalLinkIcon","faExternalLinkAlt","FailedIcon","faTimesCircle","GithubIcon","faGithub","GoogleIcon","faGoogle","HeartIcon","faHeart","ImageIcon","faImage","LinkIcon","faLink","MetaDataIcon","faInfoCircle","PatreonIcon","faPatreon","PlusIcon","faPlus","PrivacyIcon","faUserShield","RatingIcon","faRegistered","SearchIcon","faSearch","ShareIcon","faCog","faShareAlt","SignOutIcon","faSignOutAlt","SourceIcon","faHashtag","SuccessIcon","faCheckCircle","SupertagIcon","faTags","TermsIcon","faScroll","TumblrIcon","faTumblr","TwitterIcon","faTwitter","UndoIcon","faUndoAlt","WrenchIcon","faWrench","ForwardIcon","faForward","BackwardIcon","faBackward","SubmitIcon","faArrowRight","ArrowUp","faArrowUp","RouteName","NO_OP","TextButton","styled","button","LinkButton","a","hugeSpacing","colors","layerBg","text","InvisButton","dropShadow","PrimaryButton","primary","BlockButton","AddButton","ModifierButton","defaultBorder","timings","transitionTime","accentColor","borderWidth","disabled","backgroundColor","subduedText","pointerInteraction","secondary","foreground","focus","backgroundColor2","layer","_ref8","solidLayer","_ref9","layerBgSolid","defaultInput","_ref0","amount","supportsGap","supportsFlexGap","defaultSpacing","googleAuthProvider","initialized","signIn","firebase","auth","signInWithPopup","catch","console","code","warn","async","signOut","GenericConverter","toFirestore","data","fromFirestore","snapshot","options","userConverter","getUserDoc","log","currentUser","email","sha256","firestore","collection","doc","err","getPreferences","userData","userDoc","withConverter","get","getUserData","set","resetSeenPosts","getSupertags","snap","forEach","addSupertag","removeSupertag","delete","setTagsOfSupertag","update","logEvent","event","analytics","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","init","initializeApp","GoogleAuthProvider","Title","h2","bigTitle","BigTitle","h1","SmallTitle","h3","Faded","span","ZIndex","flex","document","createElement","style","display","flexDirection","rowGap","appendChild","body","isSupported","scrollHeight","parentNode","removeChild","supportsAspectRatio","supportsObjectFit","supportsFullscreen","fullscreenEnabled","supportsNetworkInformationAPI","navigator","supportsLocalStorage","Boolean","localStorage","openFullscreen","element","fullscreenElement","requestFullscreen","Promise","resolve","listToMap","list","keyProp","current","parseUrl","URL","versionToNumber","majorMinorPatch","Number","download","url","filename","pop","fetch","then","response","blob","href","window","createObjectURL","click","remove","getVersion","_process","_process$env","process","REACT_APP_VERSION","getVersionString","version","boolToNumber","randomBelow","max","floor","random","useAction","actionCreator","dispatch","useDispatch","useCallback","usePreference","useSelector","setValue","Surface","div","SolidSurface","formatCount","trunc","formatSource","source","host","formatDuration","duration","min","sec","formatTagname","formatTagnameAndCount","z","formatDatetime","date","dd","getDate","MM","getMonth","yyyy","getFullYear","hh","getHours","mm","getMinutes","formatTime","milliseconds","formatUnit","unitSize","unit","toFixed","unitString","FlexPair","FlexImage","img","flexMedia","preserveAspectRatio","createSearchParams","params","acc","append","asString","URLSearchParams","msgBuffer","TextEncoder","encode","hashBuffer","crypto","subtle","digest","Array","Uint8Array","b","padStart","LabeledToggle","children","onToggle","className","_jsxs","Toggle","TypeIcon","dropdownScrollbar","FlexColumn","FlexColumnWithSpacing","mediaStyle","width","height","serializeAllTags","resolvedTags","push","flattenSupertags","tagsByModifier","_result$current$modif","groupTagsByModifier","normalTags","serializeTag","optionalTags","Track","longTransitionTime","Thumb","toggleOff","onClick","role","OfflineIndicator","useTheme","isOnline","setIsOnline","useState","onLine","useEffect","listenter","_options$onOnline","onOnline","call","addEventListener","removeEventListener","_options$onOffline","onOffline","useOnlineChange","title","color","negative","MenuBar","nav","LocationStyledLink","Link","to","Menu","useLocation","pathname","SEARCH","PREFERENCES","ABOUT","HeaderWrapper","header","TitleBar","Header","R34Icon","size","Menubar","modifierToStyle","ModifierStyledText","TagName","AliasWrapper","Alias","handleClick","stopPropagation","ListWrapper","parentRef","clientRect","getBoundingClientRect","offsetTop","offsetLeft","DROPDOWN","AliasesList","ChipWrapper","switchingColors","collapsed","dropdownBorderRadius","DropdownArrow","$collapsed","DropdownWrapper","TagChip","isActive","detailed","onContextMenu","tagRef","setTagRef","toggleCollapsed","useToggle","preventDefault","handleArrowClick","handleEnter","handleContextMenu","onKeyDown","ref","tabIndex","Supertag","BiasedTag","Tag","biasedTag","TagListWrapper","TagList","onTagClick","getIsActive","onTagMenu","shadow","radius","HorizontalLine","layerBgHighlight","initialValue","toggleValue","resetValue","useToggleTag","EntryWrapper","Name","Count","Icon","DropdownListEntry","DropdownListError","tagSelectorRef","tagSelector","clientHeight","clientWidth","sizeAndPosition","DropdownList","entry","Input","input","TagInput","onSubmit","handleChange","target","onChange","placeholder","TagSelectorWrapper","form","closed","TagSelector","showSupertags","setTagSelectorRef","nextModifier","useModifier","activateTag","useThrottledEffect","handleAddClick","trim","sanitizedTagname","suggestion","s","showList","ResetButton","reset","_localStorage","clear","location","hash","reload","StyledSvg","svg","Loading","xmlns","xmlnsXlink","viewBox","xmlSpace","fill","stroke","cx","cy","r","attributeName","dur","repeatCount","begin","transform","strokeWidth","strokeMiterlimit","strokeDasharray","strokeOpacity","fontStyle","fontWeight","fontSize","fontFamily","letterSpacing","wordSpacing","fillOpacity","x","y","fontVariant","fontStretch","order","ActiveTags","offerSupertags","numberOfActiveTags","openSupertagModal","toggleTag","checkIsActive","useCheckIsActive","nextModifer","activeSupertagsTags","useActivateTag","ErrorBoundary","Component","constructor","super","this","hasError","getDerivedStateFromError","render","fallback","keybinds","/","_document$getElementB","getElementById","ctrl+1","ctrl+2","ctrl+3","GlobalKeybindings","handler","pressed","ctrlKey","createGlobalStyle","FullScreenCentered","ErrorScreen","themes","defaultThemeId","GlobalStyles","src","outOfResultsPicture","alt","LoadingScreen","SectionBody","Section","Terms","Wrapper","MODAL","backdrop","ModalSurface","modalWidth","Modal","close","blockEvent","ButtonRow","CellularWarningModal","search","onConfirm","onCancel","setAutoPlay","toggleAutoPlay","setPreloadVideos","togglePreloadVideos","setOriginals","toggleOriginals","eeek","CookieWrapper","COOKIEBAR","StyledSpan","CookieConfirmation","setCookies","handleAccept","StyledInput","SupertagModal","setName","setDescription","handleCreate","AnalyticsEventId","eventLogging","store","next","action","getState","page_number","initialPreferencesState","hideSeen","backends","produce","draft","assign","saveTimeout","persistence","clearTimeout","setTimeout","firebaseFunctions","newPreferences","client","currentBackend","useFirebase","postLimit","tagLimit","requestRetries","verbose","parseComment","comment","attr","useNextBackend","getFullUrl","path","fetchWithFailover","fetchOptions","retries","res","ok","status","fetchTags","_params$name","replaceAll","fetched","json","isArray","Error","label","substring","lastIndexOf","getTags","supertags","sanitzedName","matchingSupertags","_","includes","details","_unused","getPostsUrl","limit","serializedTags","getPosts","_params$limit","_params$page","paramsInternal","pid","page","score","apiResponse","xml","DOMParser","parseFromString","getElementsByTagName","getAttribute","parsePost","attributes","getNamedItem","file_url","parent_id","sample_url","sample_width","sample_height","preview_url","rating","change","md5","creator_id","has_children","created_at","has_notes","has_comments","preview_width","preview_height","array","comments_url","creator_url","endsWith","getAliases","getComments","commentsUrl","newComment","getArtist","apiRequests","hasMoreResults","_payload","_payload$preferences","minRating","sanitizedAliases","alias","mode","middleware","composeWithDevTools","applyMiddleware","requests","migrations","reader","initialResultsState","Date","getTime","postCount","postIndex","findIndex","p","initialTagsState","newTag","initialFullscreenState","isEnabled","scrollIndex","initialLikesState","now","initialModalsState","setOpenModal","initialSuggestionsState","setError","setModifier","combineReducers","enterFullscreen","setIndex","exitFullscreen","setScrollIndex","persistConfig","storage","migrate","createMigrate","persistedReducer","persistReducer","rootReducer","createStore","persistor","persistStore","About","lazy","Privacy","Search","Preferences","Share","Stories","loadingScreen","App","Provider","PersistGate","loading","ThemedApp","isCellularWarningModalOpen","isSupertagModalOpen","ThemeProvider","Helmet","HashRouter","Suspense","Switch","Route","exact","component","PRIVACY","STORIES","TERMS","SHARE","isLocalhost","hostname","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","Sentry","dsn","integrations","Offline","tracesSampleRate","release","allowUrls","ignoreErrors","denyUrls","beforeBreadcrumb","breadcrumb","hint","_breadcrumb$category","category","startsWith","innerText","ReactDOM","origin","headers","contentType","ready","unregister","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.bdb8b83d.chunk.js","sourcesContent":["import { ModalId, SuggestionsError } from '../data/types'\r\nimport { AliasTag, AnyBiasedTag, AnyTag, Comment, Post, PreferenceKey, TagModifier } from 'r34-types'\r\nimport { PreferencesState } from './reducers/preferences'\r\n\r\n// Action Names\r\nexport const ADD_ALIASES = `r34-react/ADD_ALIASES`\r\nexport const ADD_POSTS = `r34-react/ADD_POSTS`\r\nexport const ADD_TAG = `r34-react/ADD_TAG`\r\nexport const CLOSE_MODAL = `r34-react/CLOSE_MODAL`\r\nexport const ENTER_FULLSCREEN = `r34-react/ENTER_FULLSCREEN`\r\nexport const EXIT_FULLSCREEN = 'r34-react/EXIT_FULLSCREEN'\r\nexport const FETCH_COMMENTS = `r34-react/FETCH_COMMENTS`\r\nexport const FETCH_PREFERENCES = `r34-react/FETCH_PREFERENCES`\r\nexport const FETCH_SUGGESTIONS = `r34-react/FETCH_SUGGESTIONS`\r\nexport const GET_MORE_RESULTS = `r34-react/GET_MORE_RESULTS`\r\nexport const GET_RESULTS = `r34-react/GET_RESULTS`\r\nexport const LIKE_POST = `r34-react/LIKE_POST`\r\nexport const OPEN_MODAL = `r34-react/OPEN_MODAL`\r\nexport const REMOVE_TAG = `r34-react/REMOVE_TAG`\r\nexport const SAVE_PREFERENCES = 'r34-react/SAVE_PREFERENCES'\r\nexport const SET_COMMENTS = `r34-react/SET_COMMENTS`\r\nexport const SET_FULLSCREEN_POST = `r34-react/SET_FULLSCREEN_POST`\r\nexport const SET_POSTS = `r34-react/SET_POSTS`\r\nexport const SET_PREFERENCE = `r34-react/SET_PREFERENCE`\r\nexport const SET_PREFERENCES = `r34-react/SET_PREFERENCES`\r\nexport const SET_SUGGESTIONS = `r34-react/SET_SUGGESTIONS`\r\nexport const SET_SUGGESTIONS_ERROR = `r34-react/SET_SUGGESTIONS_ERROR`\r\nexport const SET_SUGGESTIONS_MODIFIER = 'r34-react/SET_SUGGESTIONS_MODIFIER'\r\nexport const SCROLL_TO_POST = 'r34-react/SCROLL_TO_POST'\r\n\r\n// Action Types\r\ninterface AddTagAction {\r\n  type: typeof ADD_TAG\r\n  tag: AnyBiasedTag\r\n}\r\n\r\ninterface RemoveTagAction {\r\n  type: typeof REMOVE_TAG\r\n  tagName: string\r\n}\r\n\r\ninterface AddAliasesAction {\r\n  type: typeof ADD_ALIASES\r\n  aliases: AliasTag[]\r\n  forTag: string\r\n}\r\n\r\nexport interface AddPostsAction {\r\n  type: typeof ADD_POSTS\r\n  posts: Post[]\r\n}\r\n\r\nexport interface SetPostsAction {\r\n  type: typeof SET_POSTS\r\n  posts: Post[]\r\n  count: number\r\n  pageNumber?: number\r\n}\r\n\r\ninterface SetCommentsAction {\r\n  type: typeof SET_COMMENTS\r\n  postId: number\r\n  comments: Comment[]\r\n}\r\n\r\ninterface FetchCommentsAction {\r\n  type: typeof FETCH_COMMENTS\r\n  postId: number\r\n}\r\n\r\ninterface SetPreferenceAction {\r\n  type: typeof SET_PREFERENCE\r\n  key: PreferenceKey\r\n  value: PreferencesState[PreferenceKey]\r\n}\r\n\r\ninterface SetPreferencesAction {\r\n  type: typeof SET_PREFERENCES\r\n  preferences: Partial<PreferencesState>\r\n}\r\n\r\ninterface GetResultsAction {\r\n  type: typeof GET_RESULTS\r\n  pageNumber: number\r\n}\r\n\r\ninterface GetMoreResultsAction {\r\n  type: typeof GET_MORE_RESULTS\r\n}\r\n\r\ninterface EnterFullcreenAction {\r\n  type: typeof ENTER_FULLSCREEN\r\n  postId: number\r\n}\r\n\r\ninterface SetFullScreenPostAction {\r\n  type: typeof SET_FULLSCREEN_POST\r\n  index: number\r\n}\r\n\r\ninterface ExitFullscreenAction {\r\n  type: typeof EXIT_FULLSCREEN\r\n}\r\n\r\ninterface LikePostAction {\r\n  type: typeof LIKE_POST\r\n  postId: number\r\n}\r\n\r\ninterface OpenModalAction {\r\n  type: typeof OPEN_MODAL\r\n  modalId: ModalId\r\n}\r\n\r\ninterface CloseModalAction {\r\n  type: typeof CLOSE_MODAL\r\n}\r\n\r\ninterface SetSuggestionsAction {\r\n  type: typeof SET_SUGGESTIONS\r\n  suggestions: AnyTag[]\r\n}\r\n\r\ninterface SetSuggestionsErrorAction {\r\n  type: typeof SET_SUGGESTIONS_ERROR\r\n  error: SuggestionsError\r\n}\r\n\r\ninterface FetchSuggestionsAction {\r\n  type: typeof FETCH_SUGGESTIONS\r\n  value: string\r\n  includeSupertags: boolean\r\n}\r\n\r\ninterface FetchPreferencesAction {\r\n  type: typeof FETCH_PREFERENCES\r\n}\r\n\r\ninterface SavePreferencesAction {\r\n  type: typeof SAVE_PREFERENCES\r\n}\r\n\r\ninterface SetSuggestionsModifierAction {\r\n  type: typeof SET_SUGGESTIONS_MODIFIER\r\n  modifier: TagModifier\r\n}\r\n\r\ninterface ScrollToPostAction {\r\n  type: typeof SCROLL_TO_POST\r\n  index: number\r\n}\r\n\r\nexport type AppAction =\r\n  | AddAliasesAction\r\n  | AddPostsAction\r\n  | AddTagAction\r\n  | CloseModalAction\r\n  | EnterFullcreenAction\r\n  | ExitFullscreenAction\r\n  | FetchCommentsAction\r\n  | FetchPreferencesAction\r\n  | FetchSuggestionsAction\r\n  | GetMoreResultsAction\r\n  | GetResultsAction\r\n  | LikePostAction\r\n  | OpenModalAction\r\n  | RemoveTagAction\r\n  | SavePreferencesAction\r\n  | SetCommentsAction\r\n  | SetFullScreenPostAction\r\n  | SetPostsAction\r\n  | SetPreferenceAction\r\n  | SetPreferencesAction\r\n  | SetSuggestionsAction\r\n  | SetSuggestionsErrorAction\r\n  | SetSuggestionsModifierAction\r\n  | ScrollToPostAction\r\n\r\n// Action Creators\r\nexport function addTag(tag: AnyBiasedTag): AddTagAction {\r\n  return {\r\n    type: ADD_TAG,\r\n    tag,\r\n  }\r\n}\r\n\r\nexport function removeTag(tagName: string): RemoveTagAction {\r\n  return {\r\n    type: REMOVE_TAG,\r\n    tagName,\r\n  }\r\n}\r\n\r\nexport function addAliases(aliases: AliasTag[], forTag: string): AddAliasesAction {\r\n  return {\r\n    type: ADD_ALIASES,\r\n    aliases,\r\n    forTag,\r\n  }\r\n}\r\n\r\nexport function addPosts(posts: Post[]): AddPostsAction {\r\n  return {\r\n    type: ADD_POSTS,\r\n    posts,\r\n  }\r\n}\r\n\r\nexport function setPosts(posts: Post[], count: number, pageNumber: number = 0): SetPostsAction {\r\n  return {\r\n    type: SET_POSTS,\r\n    posts,\r\n    count,\r\n    pageNumber,\r\n  }\r\n}\r\n\r\nexport function setComments(postId: number, comments: Comment[]): SetCommentsAction {\r\n  return {\r\n    type: SET_COMMENTS,\r\n    postId,\r\n    comments,\r\n  }\r\n}\r\n\r\nexport function fetchComments(postId: number): FetchCommentsAction {\r\n  return {\r\n    type: FETCH_COMMENTS,\r\n    postId,\r\n  }\r\n}\r\n\r\nexport function setPreference(key: PreferenceKey, value: any): SetPreferenceAction {\r\n  return {\r\n    type: SET_PREFERENCE,\r\n    key,\r\n    value,\r\n  }\r\n}\r\n\r\nexport function setPreferences(preferences: Partial<PreferencesState>): SetPreferencesAction {\r\n  return {\r\n    type: SET_PREFERENCES,\r\n    preferences,\r\n  }\r\n}\r\n\r\nexport function getResults(pageNumber: number = 0): GetResultsAction {\r\n  return {\r\n    type: GET_RESULTS,\r\n    pageNumber,\r\n  }\r\n}\r\n\r\nexport function getMoreResults(): GetMoreResultsAction {\r\n  return {\r\n    type: GET_MORE_RESULTS,\r\n  }\r\n}\r\n\r\nexport function enterFullscreen(postId: number): EnterFullcreenAction {\r\n  return {\r\n    type: ENTER_FULLSCREEN,\r\n    postId,\r\n  }\r\n}\r\n\r\nexport function exitFullscreen(): ExitFullscreenAction {\r\n  return {\r\n    type: EXIT_FULLSCREEN,\r\n  }\r\n}\r\n\r\nexport function setFullscreenPost(index: number): SetFullScreenPostAction {\r\n  return {\r\n    type: SET_FULLSCREEN_POST,\r\n    index,\r\n  }\r\n}\r\n\r\nexport function scrollToPost(index: number): ScrollToPostAction {\r\n  return {\r\n    type: SCROLL_TO_POST,\r\n    index,\r\n  }\r\n}\r\n\r\nexport function likePost(postId: number): LikePostAction {\r\n  return {\r\n    type: LIKE_POST,\r\n    postId,\r\n  }\r\n}\r\n\r\nexport function openModal(modalId: ModalId): OpenModalAction {\r\n  return {\r\n    type: OPEN_MODAL,\r\n    modalId,\r\n  }\r\n}\r\n\r\nexport function closeModal(): CloseModalAction {\r\n  return {\r\n    type: CLOSE_MODAL,\r\n  }\r\n}\r\n\r\nexport function setSuggestions(suggestions: AnyTag[]): SetSuggestionsAction {\r\n  return {\r\n    type: SET_SUGGESTIONS,\r\n    suggestions,\r\n  }\r\n}\r\n\r\nexport function setSuggestionsError(error: SuggestionsError): SetSuggestionsErrorAction {\r\n  return {\r\n    type: SET_SUGGESTIONS_ERROR,\r\n    error,\r\n  }\r\n}\r\n\r\nexport function fetchSuggestions(value: string, includeSupertags: boolean): FetchSuggestionsAction {\r\n  return {\r\n    type: FETCH_SUGGESTIONS,\r\n    value,\r\n    includeSupertags,\r\n  }\r\n}\r\n\r\nexport function fetchPreferences(): FetchPreferencesAction {\r\n  return {\r\n    type: FETCH_PREFERENCES,\r\n  }\r\n}\r\n\r\nexport function savePreferences(): SavePreferencesAction {\r\n  return {\r\n    type: SAVE_PREFERENCES,\r\n  }\r\n}\r\n\r\nexport function setSuggestionsModifier(modifier: TagModifier): SetSuggestionsModifierAction {\r\n  return {\r\n    type: SET_SUGGESTIONS_MODIFIER,\r\n    modifier,\r\n  }\r\n}\r\n","import * as r34 from 'r34-types'\r\nimport { createSelector, defaultMemoize } from 'reselect'\r\nimport { isSupertag } from '../data/tagUtils'\r\nimport { ModalId } from '../data/types'\r\nimport { AppState } from './appState'\r\n\r\n// Simple selectors\r\nexport const selectActiveTags = (state: AppState) => state.tags.active\r\nexport const selectActiveThemeId = (state: AppState) => state.preferences.themeId\r\nexport const selectAliases = (state: AppState) => state.tags.aliases\r\nexport const selectAutoPlay = (state: AppState) => state.preferences.autoPlay\r\nexport const selectCookies = (state: AppState) => state.preferences.cookies\r\nexport const selectCount = (state: AppState) => state.results.count\r\nexport const selectFullsceenIndex = (state: AppState) => state.fullscreen.currentIndex\r\nexport const selectFullsceenState = (state: AppState) => state.fullscreen.isEnabled\r\nexport const selectHideSeen = (state: AppState) => state.preferences.hideSeen\r\nexport const selectOpenModalId = (state: AppState) => state.modals.openModal\r\nexport const selectOriginals = (state: AppState) => state.preferences.originals\r\nexport const selectPageNumber = (state: AppState) => state.results.pageNumber\r\nexport const selectPageSize = (state: AppState) => state.preferences.pageSize\r\nexport const selectPosts = (state: AppState) => state.results.posts\r\nexport const selectPreferences = (state: AppState) => state.preferences\r\nexport const selectPreloadVideos = (state: AppState) => state.preferences.preloadVideos\r\nexport const selectPreloadGifs = (state: AppState) => state.preferences.preloadVideos\r\nexport const selectRated = (state: AppState) => state.preferences.rated\r\nexport const selectRatedThreshold = (state: AppState) => state.preferences.ratedThreshold\r\nexport const selectResults = (state: AppState) => state.results\r\nexport const selectResultsLayout = (state: AppState) => state.preferences.resultsLayout\r\nexport const selectShowComments = (state: AppState) => state.preferences.showComments\r\nexport const selectShowMetadata = (state: AppState) => state.preferences.showMetadata\r\nexport const selectSort = (state: AppState) => state.preferences.sort\r\nexport const selectSuggestions = (state: AppState) => state.suggestions.entries\r\nexport const selectSuggestionsError = (state: AppState) => state.suggestions.error\r\nexport const selectSuggestionsModifier = (state: AppState) => state.suggestions.modifier\r\nexport const selectTagSuggestionCount = (state: AppState) => state.preferences.tagSuggestionsCount\r\nexport const selectUpdated = (state: AppState) => state.results.updated\r\nexport const selectAutoscrollDelay = (state: AppState) => state.preferences.autoscrollDelay\r\nexport const selectScrollIndex = (state: AppState) => state.fullscreen.scrollIndex\r\nexport const selectShowPostDetails = (state: AppState) => state.preferences.showPostDetails\r\n\r\n// Memoized selectors\r\nexport const selectNumberOfActiveTags = createSelector(selectActiveTags, (tags) => Object.keys(tags).length)\r\nexport const selectAliasesAsList = createSelector(selectAliases, (aliases) => Object.values(aliases).flat())\r\nexport const selectHasResults = createSelector(selectPosts, (posts) => posts.length !== 0)\r\nexport const selectOutOfResults = createSelector(selectPosts, selectCount, (posts, count) => posts.length === count)\r\nexport const selectHasMoreResults = createSelector(selectOutOfResults, (outOfResults) => !outOfResults)\r\nexport const selectLastPage = createSelector(\r\n  selectCount,\r\n  selectPageSize,\r\n  (count, pageSize) => Math.ceil(count / pageSize) - 1\r\n)\r\nexport const selectFullScreenPost = createSelector(\r\n  selectPosts,\r\n  selectFullsceenIndex,\r\n  (posts, fullScreenIndex) => posts[fullScreenIndex]\r\n)\r\nexport const selectFullScreenIndex = createSelector(selectPosts, selectFullScreenPost, (posts, fullScreenPost) =>\r\n  fullScreenPost ? posts.indexOf(fullScreenPost) : -1\r\n)\r\nexport const selectMinRating = createSelector(selectRated, selectRatedThreshold, (rated, ratedThreshold) =>\r\n  rated ? ratedThreshold : 0\r\n)\r\nexport const selectNextIndex = createSelector(selectPosts, selectFullScreenIndex, (posts, selectedIndex) =>\r\n  selectedIndex + 1 < posts.length ? selectedIndex + 1 : undefined\r\n)\r\nexport const selectPreviousIndex = createSelector(selectFullScreenIndex, (selectedIndex) =>\r\n  selectedIndex > 0 ? selectedIndex - 1 : undefined\r\n)\r\nexport const selectSupertagModalOpen = createSelector(\r\n  selectOpenModalId,\r\n  (modalId) => modalId === ModalId.CREATE_SUPERTAG\r\n)\r\nexport const selectCellularWarningModalOpen = createSelector(\r\n  selectOpenModalId,\r\n  (modalId) => modalId === ModalId.CELLULAR_WARNING\r\n)\r\n\r\n// Parameterized selectors\r\nexport const selectPostById = defaultMemoize((id: number) => {\r\n  return createSelector(selectPosts, (posts) => {\r\n    return posts.find((post) => post.id === id) as r34.Post\r\n  })\r\n})\r\nexport const selectPostByIndex = defaultMemoize((index: number) => {\r\n  return createSelector(selectPosts, (posts) => {\r\n    return posts[index]\r\n  })\r\n})\r\n\r\nexport const selectAliasesByTagName = defaultMemoize((tagName: string) => {\r\n  return createSelector(selectAliases, (aliases) => {\r\n    return aliases[tagName]\r\n  })\r\n})\r\n\r\nexport const selectLikedByPostId = defaultMemoize((id: number) => (state: AppState) => id in state.likes)\r\n\r\nexport const selectActiveSupertagTags = createSelector(selectActiveTags, (activeTags) =>\r\n  Object.values(activeTags)\r\n    .filter(isSupertag)\r\n    .reduce((result, tag) => ({ ...result, ...tag.tags }), {})\r\n)\r\n","import { css } from 'styled-components'\r\nimport { flexRowGap, flexColumnGap, gap, defaultRowSpacing } from './gap'\r\nimport { transitionAll } from './theming'\r\nimport { PropsWithTheme } from './types'\r\n\r\nexport function multilineList({ theme }: PropsWithTheme) {\r\n  return css`\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    ${flexRowGap(theme.dimensions.bigSpacing)}\r\n    ${flexColumnGap(theme.dimensions.bigSpacing)}\r\n  `\r\n}\r\n\r\nexport function flexColumn() {\r\n  return css`\r\n    display: flex;\r\n    flex-direction: column;\r\n  `\r\n}\r\n\r\nexport function flexColumnWithGap({ theme }: PropsWithTheme) {\r\n  return css`\r\n    display: flex;\r\n    flex-direction: column;\r\n    ${flexColumnGap(theme.dimensions.bigSpacing)};\r\n  `\r\n}\r\n\r\nexport function gridWithGap({ theme }: PropsWithTheme) {\r\n  return css`\r\n    display: grid;\r\n    ${gap(theme.dimensions.bigSpacing)}\r\n  `\r\n}\r\n\r\nexport function flexRowWithGap({ theme }: PropsWithTheme) {\r\n  return css`\r\n    display: flex;\r\n    align-items: center;\r\n    ${flexRowGap(theme.dimensions.bigSpacing)};\r\n  `\r\n}\r\n\r\n/**\r\n * Limits content to a maximum width and centers it\r\n */\r\nexport function centeredMaxWidth({ theme }: PropsWithTheme) {\r\n  return css`\r\n    width: 100%;\r\n    max-width: ${theme.dimensions.bodyWidth};\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n  `\r\n}\r\n\r\n/**\r\n * Fixed height and padding\r\n */\r\nexport function defaultBlock({ theme }: PropsWithTheme) {\r\n  return css`\r\n    height: ${theme.dimensions.blockHeight};\r\n    padding: 0 ${theme.dimensions.bigSpacing};\r\n  `\r\n}\r\n\r\nexport function fullscreenOverlay() {\r\n  return css`\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    ${coverScreen};\r\n  `\r\n}\r\n\r\nexport function coverScreen() {\r\n  return css`\r\n    width: 100vw;\r\n    height: 100vh;\r\n  `\r\n}\r\n\r\nexport function buttonBaseStyle({ theme }: PropsWithTheme) {\r\n  return css`\r\n    display: inline-flex;\r\n    align-items: center;\r\n    place-content: center;\r\n\r\n    height: ${theme.dimensions.blockHeight};\r\n    cursor: pointer;\r\n    white-space: nowrap;\r\n    border-radius: ${theme.dimensions.borderRadius};\r\n    font-size: ${theme.fontSizes.content};\r\n    ${defaultRowSpacing}\r\n    ${transitionAll}\r\n  `\r\n}\r\n","import * as r34 from 'r34-types'\r\nimport { SuggestionsError } from './types'\r\n\r\n//#region Tag serialization\r\n\r\n/**\r\n * Accepts a map of all tags and serializes them into a string that can be used as a Querystring parameter\r\n */\r\nexport function serializeAllTags(tags: Record<string, r34.QueryTag | r34.Supertag>) {\r\n  const resolvedTags = flattenSupertags(Object.values(tags))\r\n  const tagsByModifier = groupTagsByModifier(resolvedTags)\r\n  const normalTags = [...tagsByModifier['+'], ...tagsByModifier['-']].map(serializeTag).join(' + ')\r\n  const optionalTags =\r\n    tagsByModifier['~'].length > 0 ? ` + ( ${tagsByModifier['~'].map(serializeTag).join(' ~ ')} )` : ''\r\n\r\n  return `${normalTags}${optionalTags}`\r\n}\r\n\r\n/**\r\n * Accepts a list that holds normal tags and supertags and unpacks all supertags.\r\n * The result contains all normal tags given plus all contents of the supertags given.\r\n */\r\nexport function flattenSupertags(tags: Array<r34.QueryTag | r34.Supertag>) {\r\n  let resolvedTags: r34.QueryTag[] = []\r\n\r\n  tags.forEach((tag) => {\r\n    if (isSupertag(tag)) {\r\n      Object.entries(tag.tags).forEach(([name, modifier]) => {\r\n        resolvedTags.push({ name, modifier })\r\n      })\r\n    } else {\r\n      resolvedTags.push(tag)\r\n    }\r\n  })\r\n\r\n  return resolvedTags\r\n}\r\n\r\n/**\r\n * Given a list of tags this function returns a record with an entry for each modifier countaining all tags of the original list that match that modifier.\r\n */\r\nexport function groupTagsByModifier(tags: r34.QueryTag[]) {\r\n  return tags.reduce(\r\n    (result, current) => {\r\n      if (!(current.modifier in result)) result[current.modifier] = []\r\n\r\n      result[current.modifier]?.push(current)\r\n\r\n      return result\r\n    },\r\n    { '+': [], '-': [], '~': [] } as Record<r34.TagModifier, r34.QueryTag[]>\r\n  )\r\n}\r\n\r\n/**\r\n * Serializes a tag for use in urls\r\n */\r\nexport function serializeTag(tag: r34.QueryTag) {\r\n  return `${tag.modifier === '-' ? '-' : ''}${serializeTagname(tag.name)}`\r\n}\r\n\r\n/**\r\n * Serializes tag names for use in api requests.\r\n */\r\nexport function serializeTagname(tagname: string) {\r\n  return encodeURIComponent(tagname.toLowerCase().replace(/ /g, '_'))\r\n}\r\n\r\n//#endregion\r\n\r\n//#region Query parameter construction\r\n\r\n/**\r\n * Constructs the tag parameter for getting posts from the api\r\n */\r\nexport function getTagParameter(\r\n  tags: Record<string, r34.QueryTag | r34.Supertag>,\r\n  minScore: number,\r\n  sort: r34.PostsSort\r\n) {\r\n  const tagParts = []\r\n\r\n  if (Object.keys(tags).length > 0) {\r\n    tagParts.push(serializeAllTags(tags))\r\n  }\r\n\r\n  if (minScore > 0) {\r\n    tagParts.push(encodeURIComponent(`score:>=${minScore}`))\r\n  }\r\n\r\n  if (sort) {\r\n    tagParts.push(encodeURIComponent(`sort:${sort}`))\r\n  }\r\n\r\n  return tagParts.join(' + ')\r\n}\r\n\r\n//#endregion\r\n\r\n//#region Typing\r\n\r\nexport function bias(tag: r34.Tag, modifier: r34.TagModifier): r34.BiasedTag {\r\n  return { ...tag, modifier }\r\n}\r\n\r\nexport function isBiased(tag: r34.Tag | r34.BiasedTag): tag is r34.BiasedTag {\r\n  return (tag as r34.BiasedTag).modifier !== undefined\r\n}\r\n\r\nexport function isSupertag(tag: unknown): tag is r34.Supertag {\r\n  return (tag as r34.Supertag).tags !== undefined\r\n}\r\n\r\nexport function getInterestingType(types: r34.TagType[]) {\r\n  return types.find((t) => !t.match(/^[general|ambiguous]$/))\r\n}\r\n\r\nexport function isSuggestionError(value: unknown): value is SuggestionsError {\r\n  return (value as SuggestionsError).message !== undefined\r\n}\r\n\r\n//#endregion\r\n\r\n//#region Compression\r\n\r\nfunction removeLeadingHastag(value: string) {\r\n  if (value[0] === '#') return value.substr(1)\r\n  else return value\r\n}\r\n\r\nexport function encodeSupertag(supertag: r34.Supertag) {\r\n  const payload = `${encodeURI(supertag.name)}/${encodeURI(supertag.description)}/${encodeURI(\r\n    Object.entries(supertag.tags)\r\n      .map(([t, m]) => `${t},${m}`)\r\n      .join(';')\r\n  )}`\r\n\r\n  return Buffer.from(payload).toString('base64')\r\n}\r\n\r\nexport function decodeSupertag(base64: string) {\r\n  const payload = Buffer.from(removeLeadingHastag(base64), 'base64').toString()\r\n\r\n  const parts = payload.split('/').map(decodeURI)\r\n\r\n  const supertag: r34.Supertag = {\r\n    name: parts[0],\r\n    description: parts[1],\r\n    tags: Object.fromEntries(parts[2].split(';').map((e) => e.split(','))),\r\n  }\r\n\r\n  return supertag\r\n}\r\n\r\n//#endregion\r\n","import { IconProp } from '@fortawesome/fontawesome-svg-core'\r\nimport {\r\n  faDeviantart,\r\n  faDiscord,\r\n  faGithub,\r\n  faGoogle,\r\n  faPatreon,\r\n  faTumblr,\r\n  faTwitter,\r\n} from '@fortawesome/free-brands-svg-icons'\r\nimport {\r\n  faArrowRight,\r\n  faArrowUp,\r\n  faBackward,\r\n  faCalendarDay,\r\n  faCaretDown,\r\n  faCheckCircle,\r\n  faCheckSquare,\r\n  faCodeBranch,\r\n  faCog,\r\n  faCopy,\r\n  faCopyright,\r\n  faDownload,\r\n  faExpand,\r\n  faExternalLinkAlt,\r\n  faForward,\r\n  faHashtag,\r\n  faHeart,\r\n  faImage,\r\n  faInfoCircle,\r\n  faLink,\r\n  faPen,\r\n  faPlus,\r\n  faRegistered,\r\n  faScroll,\r\n  faSearch,\r\n  faShareAlt,\r\n  faSignOutAlt,\r\n  faTags,\r\n  faTimes,\r\n  faTimesCircle,\r\n  faUndoAlt,\r\n  faUser,\r\n  faUserShield,\r\n  faWrench,\r\n} from '@fortawesome/free-solid-svg-icons'\r\nimport { FontAwesomeIcon, FontAwesomeIconProps } from '@fortawesome/react-fontawesome'\r\nimport React from 'react'\r\n\r\n/**\r\n * Component factory that shortens the definition of a new icon considerably\r\n */\r\nconst bindIcon = (icon: IconProp) =>\r\n  React.memo((props: Omit<FontAwesomeIconProps, 'icon'>) => (\r\n    <FontAwesomeIcon data-testid='icon' icon={icon} {...props} />\r\n  ))\r\n\r\nexport const ArrowDown = bindIcon(faCaretDown)\r\nexport const ArtistIcon = bindIcon(faPen)\r\nexport const CalendarIcon = bindIcon(faCalendarDay)\r\nexport const CharacterIcon = bindIcon(faUser)\r\nexport const CheckIcon = bindIcon(faCheckSquare)\r\nexport const CloseIcon = bindIcon(faTimes)\r\nexport const CodeBranchIcon = bindIcon(faCodeBranch)\r\nexport const CopyIcon = bindIcon(faCopy)\r\nexport const CopyrightIcon = bindIcon(faCopyright)\r\nexport const DeviantArtIcon = bindIcon(faDeviantart)\r\nexport const DiscordIcon = bindIcon(faDiscord)\r\nexport const DownloadIcon = bindIcon(faDownload)\r\nexport const ExpandIcon = bindIcon(faExpand)\r\nexport const ExternalLinkIcon = bindIcon(faExternalLinkAlt)\r\nexport const FailedIcon = bindIcon(faTimesCircle)\r\nexport const GithubIcon = bindIcon(faGithub)\r\nexport const GoogleIcon = bindIcon(faGoogle)\r\nexport const HeartIcon = bindIcon(faHeart)\r\nexport const ImageIcon = bindIcon(faImage)\r\nexport const LinkIcon = bindIcon(faLink)\r\nexport const MetaDataIcon = bindIcon(faInfoCircle)\r\nexport const PatreonIcon = bindIcon(faPatreon)\r\nexport const PlusIcon = bindIcon(faPlus)\r\nexport const PrivacyIcon = bindIcon(faUserShield)\r\nexport const RatingIcon = bindIcon(faRegistered)\r\nexport const SearchIcon = bindIcon(faSearch)\r\nexport const PreferencesIcon = bindIcon(faCog)\r\nexport const ShareIcon = bindIcon(faShareAlt)\r\nexport const SignOutIcon = bindIcon(faSignOutAlt)\r\nexport const SourceIcon = bindIcon(faHashtag)\r\nexport const SuccessIcon = bindIcon(faCheckCircle)\r\nexport const SupertagIcon = bindIcon(faTags)\r\nexport const TermsIcon = bindIcon(faScroll)\r\nexport const TumblrIcon = bindIcon(faTumblr)\r\nexport const TwitterIcon = bindIcon(faTwitter)\r\nexport const UndoIcon = bindIcon(faUndoAlt)\r\nexport const WrenchIcon = bindIcon(faWrench)\r\nexport const ForwardIcon = bindIcon(faForward)\r\nexport const BackwardIcon = bindIcon(faBackward)\r\nexport const SubmitIcon = bindIcon(faArrowRight)\r\nexport const ArrowUp = bindIcon(faArrowUp)\r\n","/**\r\n * Tabs displayed in Post details\r\n */\r\nexport type ActiveTab = 'tags' | 'comments' | 'metadata'\r\n\r\n/**\r\n * All routes of the app.\r\n */\r\nexport enum RouteName {\r\n  SEARCH = '/',\r\n  PREFERENCES = '/preferences',\r\n  ABOUT = '/about',\r\n  PRIVACY = '/privacy',\r\n  TERMS = '/terms',\r\n  STORIES = '/stories',\r\n  SHARE = '/share',\r\n}\r\n\r\n/**\r\n * All modals the app can display.\r\n */\r\nexport enum ModalId {\r\n  CREATE_SUPERTAG,\r\n  CELLULAR_WARNING,\r\n}\r\n\r\nexport type EmptyCallback = () => void\r\n\r\n/**\r\n * One-time definition of an empty function. Reusing this improves React's performance as it does not break memoization.\r\n */\r\nexport const NO_OP = () => {}\r\n\r\n/**\r\n * Error sent from the backend when too many tag results were found\r\n */\r\nexport type SuggestionsError = { message: string; results: number }\r\n\r\n/**\r\n * direct: Tag is part of active tags\r\n * indirect: Tag is part of a supertag that is in active tags\r\n * no: Tag is not part of supertags at all\r\n */\r\nexport type TagIsActive = 'direct' | 'indirect' | 'no'\r\n\r\n/**\r\n * Unit for display in the TagSelector dropdown\r\n */\r\nexport type CountUnit = 'tags' | 'posts'\r\n","import styled, { css } from 'styled-components'\r\nimport { buttonBaseStyle } from '../../styled/mixins/layout'\r\nimport { dropShadow } from '../../styled/mixins/shadow'\r\nimport { defaultBorder, primary, transitionAll } from '../../styled/mixins/theming'\r\n\r\nconst TextButton = styled.button`\r\n  ${buttonBaseStyle}\r\n`\r\n\r\nexport const LinkButton = styled.a(\r\n  ({ theme }) => css`\r\n    ${buttonBaseStyle}\r\n\r\n    gap: ${theme.dimensions.bigSpacing};\r\n    padding: 0 ${theme.dimensions.hugeSpacing};\r\n    background-color: ${theme.colors.layerBg};\r\n    border-radius: ${theme.dimensions.borderRadius};\r\n    color: ${theme.colors.text};\r\n\r\n    :visited {\r\n      color: ${theme.colors.text} !important;\r\n      text-decoration: none !important;\r\n    }\r\n\r\n    :hover {\r\n      opacity: 0.8;\r\n      text-decoration: none !important;\r\n    }\r\n\r\n    :active {\r\n      opacity: 0.6;\r\n      text-decoration: none !important;\r\n    }\r\n  `\r\n)\r\n\r\nexport const InvisButton = styled.button(\r\n  ({ theme }) => css`\r\n    background-color: transparent;\r\n    border: none;\r\n    padding: ${theme.dimensions.bigSpacing};\r\n    color: ${theme.colors.text};\r\n    cursor: pointer;\r\n    font-size: ${theme.fontSizes.content};\r\n\r\n    ${dropShadow}\r\n\r\n    svg {\r\n      ${transitionAll}\r\n    }\r\n  `\r\n)\r\n\r\nexport const PrimaryButton = styled(TextButton)(\r\n  ({ theme }) => css`\r\n    ${primary}\r\n\r\n    gap: ${theme.dimensions.bigSpacing};\r\n    padding: 0 ${theme.dimensions.hugeSpacing};\r\n  `\r\n)\r\n\r\nexport const BlockButton = styled(PrimaryButton)`\r\n  width: 100%;\r\n`\r\n\r\nexport const AddButton = styled(PrimaryButton)(\r\n  ({ theme }) => css`\r\n    border-radius: 0 ${theme.dimensions.borderRadius} ${theme.dimensions.borderRadius} 0;\r\n    min-width: ${theme.dimensions.blockHeight};\r\n  `\r\n)\r\n\r\nexport const ModifierButton = styled(TextButton)(\r\n  ({ theme }) => css`\r\n    background-color: transparent;\r\n    min-width: 48px;\r\n    font-size: 24px;\r\n\r\n    :focus {\r\n      text-decoration: none;\r\n    }\r\n\r\n    ${defaultBorder}\r\n    border-right-width: 0;\r\n    border-radius: ${theme.dimensions.borderRadius} 0 0 ${theme.dimensions.borderRadius};\r\n  `\r\n)\r\n","import { css } from 'styled-components'\r\nimport { defaultBlock } from './layout'\r\nimport { PropsWithTheme, SupportsDisable } from './types'\r\n\r\n/**\r\n * Adds a short transition to every attribute\r\n */\r\nexport function transitionAll({ theme }: PropsWithTheme) {\r\n  return css`\r\n    transition: all ${theme.timings.transitionTime} linear;\r\n  `\r\n}\r\n\r\n/**\r\n * Sets border-radius to the default\r\n */\r\nexport function borderRadius({ theme }: PropsWithTheme) {\r\n  return css`\r\n    border-radius: ${theme.dimensions.borderRadius};\r\n  `\r\n}\r\n\r\n/**\r\n * Gives elements a border\r\n */\r\nexport function defaultBorder({ theme }: PropsWithTheme) {\r\n  return css`\r\n    border-color: ${theme.colors.accentColor};\r\n    border-width: ${theme.dimensions.borderWidth};\r\n    border-style: solid;\r\n    ${borderRadius}\r\n  `\r\n}\r\n\r\n/**\r\n * Accent colored element with hover/focus/active/disabled states\r\n */\r\nexport function primary({ theme, disabled }: PropsWithTheme & Partial<SupportsDisable>) {\r\n  return css`\r\n    color: ${theme.colors.backgroundColor};\r\n    background-color: ${disabled ? theme.colors.subduedText : theme.colors.accentColor};\r\n    border: none;\r\n\r\n    ${transitionAll}\r\n    ${pointerInteraction}\r\n  `\r\n}\r\n\r\n/**\r\n * Transparent with text and border in accentcolor\r\n */\r\nexport function secondary({ theme, disabled }: PropsWithTheme & Partial<SupportsDisable>) {\r\n  const foreground = disabled ? theme.colors.subduedText : theme.colors.accentColor\r\n\r\n  return css`\r\n    color: ${foreground};\r\n    background-color: transparent;\r\n\r\n    ${transitionAll}\r\n    ${defaultBorder}\r\n    ${pointerInteraction}\r\n  `\r\n}\r\n\r\nexport function focus({ theme }: PropsWithTheme) {\r\n  return css`\r\n    :focus {\r\n      color: ${theme.colors.backgroundColor2};\r\n      border-color: ${theme.colors.backgroundColor2};\r\n    }\r\n  `\r\n}\r\n\r\nexport function pointerInteraction({ disabled }: PropsWithTheme & Partial<SupportsDisable>) {\r\n  return disabled\r\n    ? ''\r\n    : css`\r\n        :hover {\r\n          filter: brightness(120%);\r\n        }\r\n\r\n        :focus {\r\n          ${focus}\r\n        }\r\n\r\n        :active {\r\n          filter: brightness(90%);\r\n        }\r\n      `\r\n}\r\n\r\n/**\r\n * Element will look like a new layer\r\n */\r\nexport function layer({ theme }: PropsWithTheme) {\r\n  return css`\r\n    background-color: ${theme.colors.layerBg};\r\n    ${borderRadius}\r\n  `\r\n}\r\n\r\n/**\r\n * Element will look like a new layer\r\n */\r\nexport function solidLayer({ theme }: PropsWithTheme) {\r\n  return css`\r\n    background-color: ${theme.colors.layerBgSolid};\r\n    ${borderRadius}\r\n  `\r\n}\r\n\r\n/**\r\n * Height and coloring for most inputs\r\n */\r\nexport function defaultInput({ theme }: PropsWithTheme) {\r\n  return css`\r\n    ${defaultBorder}\r\n    ${defaultBlock}\r\n   \r\n    background-color: ${theme.colors.backgroundColor2};\r\n    cursor: pointer;\r\n  `\r\n}\r\n","import { css } from 'styled-components'\r\nimport { supportsFlexGap, supportsGap } from '../../data/browserUtils'\r\nimport { PropsWithTheme } from './types'\r\n\r\nexport function gap(amount: string) {\r\n  return supportsGap\r\n    ? css`\r\n        gap: ${amount};\r\n      `\r\n    : css`\r\n        > :not(:last-child) {\r\n          margin-right: ${amount};\r\n          margin-bottom: ${amount};\r\n        }\r\n      `\r\n}\r\n\r\nexport function flexRowGap(amount: string) {\r\n  return supportsFlexGap\r\n    ? css`\r\n        gap: ${amount};\r\n      `\r\n    : css`\r\n        > :not(:last-child) {\r\n          margin-right: ${amount};\r\n        }\r\n      `\r\n}\r\n\r\nexport function flexColumnGap(amount: string) {\r\n  return supportsFlexGap\r\n    ? css`\r\n        gap: ${amount};\r\n      `\r\n    : css`\r\n        > :not(:last-child) {\r\n          margin-bottom: ${amount};\r\n        }\r\n      `\r\n}\r\n\r\n/**\r\n * `gap` and `padding` set to `bigSpacing`\r\n */\r\nexport function defaultSpacing({ theme }: PropsWithTheme) {\r\n  return css`\r\n    ${gap(theme.dimensions.bigSpacing)};\r\n    padding: ${theme.dimensions.bigSpacing};\r\n  `\r\n}\r\n\r\n/**\r\n * `gap` and `padding` set to `bigSpacing`. `padding` only horizontally.\r\n * Use `align-items: center` or similar to handle veritcal padding\r\n */\r\nexport function defaultRowSpacing({ theme }: PropsWithTheme) {\r\n  return css`\r\n    ${gap(theme.dimensions.bigSpacing)};\r\n    padding: 0 ${theme.dimensions.bigSpacing};\r\n  `\r\n}\r\n","import firebase from 'firebase/app'\r\nimport 'firebase/auth'\r\n\r\nlet initialized = false\r\nlet googleAuthProvider!: firebase.auth.GoogleAuthProvider\r\n\r\nexport function init() {\r\n  googleAuthProvider = new firebase.auth.GoogleAuthProvider()\r\n  initialized = true\r\n}\r\n\r\nexport function signIn() {\r\n  if (initialized) {\r\n    firebase\r\n      .auth()\r\n      .signInWithPopup(googleAuthProvider)\r\n      .catch((error) => {\r\n        console.error('Sign in failed:', error.code, error.message)\r\n      })\r\n  } else {\r\n    console.warn('Cannot sign in before initialization')\r\n  }\r\n}\r\n\r\nexport async function signOut() {\r\n  if (initialized) {\r\n    return await firebase\r\n      .auth()\r\n      .signOut()\r\n      .catch((error) => {\r\n        console.error('Sign out failed:', error.code, error.message)\r\n      })\r\n  } else {\r\n    console.warn('Cannot sign out before initialization')\r\n  }\r\n}\r\n","import firebase from \"firebase/app\"\r\n\r\nexport class GenericConverter<T> {\r\n  toFirestore(data: T): firebase.firestore.DocumentData {\r\n    return data as firebase.firestore.DocumentData\r\n  }\r\n  fromFirestore(\r\n    snapshot: firebase.firestore.QueryDocumentSnapshot,\r\n    options: firebase.firestore.SnapshotOptions\r\n  ): T {\r\n    const data = snapshot.data(options)!\r\n    return data as T\r\n  }\r\n}\r\n","import firebase from 'firebase/app'\r\nimport 'firebase/auth'\r\nimport 'firebase/firestore'\r\nimport { Preferences, SupertagData, TagModifier, User } from 'r34-types'\r\nimport { sha256 } from '../utils'\r\nimport { GenericConverter } from './genericConverter'\r\n\r\nlet initialized = false\r\nlet userConverter!: GenericConverter<User>\r\n\r\nexport function init() {\r\n  userConverter = new GenericConverter<User>()\r\n  initialized = true\r\n}\r\n\r\nasync function getUserDoc() {\r\n  console.log('[firestore] getting user document')\r\n  if (!initialized) {\r\n    console.warn('Cannot get userDoc. Not initialized yet')\r\n    return undefined\r\n  }\r\n  try {\r\n    const { currentUser } = firebase.auth()\r\n    const email = currentUser?.email\r\n\r\n    if (email) {\r\n      const key = await sha256(email)\r\n      const userDoc = firebase.firestore().collection('users').doc(key)\r\n      return userDoc\r\n    }\r\n\r\n    return undefined\r\n  } catch (err) {\r\n    console.warn('Failed to get user document:', err)\r\n    return undefined\r\n  }\r\n}\r\n\r\nasync function getUserData() {\r\n  const userDoc = await getUserDoc()\r\n\r\n  if (userDoc) {\r\n    let userSnap = await userDoc.withConverter(userConverter).get()\r\n\r\n    const userData = userSnap.data()\r\n    return userData\r\n  }\r\n\r\n  return undefined\r\n}\r\n\r\nexport async function getPreferences() {\r\n  const userData = await getUserData()\r\n\r\n  if (userData) return userData.preferences\r\n\r\n  return undefined\r\n}\r\n\r\nexport async function setPreferences(preferences: Preferences) {\r\n  const userDoc = await getUserDoc()\r\n\r\n  await userDoc?.set({ preferences: preferences })\r\n}\r\n\r\nexport async function resetSeenPosts() {\r\n  console.warn('no longer supported')\r\n}\r\n\r\nexport async function getSupertags() {\r\n  const userDoc = await getUserDoc()\r\n\r\n  if (userDoc) {\r\n    console.log('[firestore] getting user supertags')\r\n    const snap = await userDoc.collection('supertags').get()\r\n    const result: Record<string, SupertagData> = {}\r\n\r\n    snap.forEach((doc) => {\r\n      result[doc.id] = doc.data() as SupertagData\r\n    })\r\n\r\n    return result\r\n  }\r\n\r\n  return undefined\r\n}\r\n\r\nexport async function addSupertag(name: string, description: string, tags: Record<string, TagModifier>) {\r\n  const userDoc = await getUserDoc()\r\n\r\n  userDoc?.collection('supertags').doc(name).set({ description, tags })\r\n}\r\n\r\nexport async function removeSupertag(name: string) {\r\n  const userDoc = await getUserDoc()\r\n\r\n  userDoc?.collection('supertags').doc(name).delete()\r\n}\r\n\r\nexport async function setTagsOfSupertag(name: string, tags: Record<string, TagModifier>) {\r\n  const userDoc = await getUserDoc()\r\n\r\n  userDoc?.collection('supertags').doc(name).update({ tags })\r\n}\r\n","import firebase from 'firebase/app'\r\nimport 'firebase/analytics'\r\n\r\nenum AnalyticsEventId {\r\n  SEARCH = 'r34_search',\r\n}\r\n\r\nexport type SearchEvent = {\r\n  id: AnalyticsEventId.SEARCH\r\n  payload: {\r\n    page_number: number\r\n  }\r\n}\r\n\r\n/**\r\n * Should be called whenever a new search is started.\r\n */\r\nexport const searchEvent = (page_number: number): SearchEvent => ({\r\n  id: AnalyticsEventId.SEARCH,\r\n  payload: {\r\n    page_number,\r\n  },\r\n})\r\n\r\nlet initialized = false\r\n\r\nexport function init() {\r\n  initialized = true\r\n}\r\n\r\nexport async function logEvent(event: SearchEvent) {\r\n  if (initialized) {\r\n    firebase.analytics().logEvent<typeof event.id>(event.id, event.payload)\r\n  }\r\n}\r\n\r\nexport async function logFirebaseRead() {\r\n  if (initialized) {\r\n    firebase.analytics().logEvent('firebase_read', { site: 'r34_react' })\r\n  }\r\n}\r\n\r\nexport async function logFirebaseWrite() {\r\n  if (initialized) {\r\n    firebase.analytics().logEvent('firebase_write', { site: 'r34_react' })\r\n  }\r\n}\r\n","import firebase from 'firebase/app'\r\nimport 'firebase/analytics'\r\nimport 'firebase/auth'\r\nimport 'firebase/firestore'\r\nimport * as signIn from './signIn'\r\nimport * as storage from './storage'\r\nimport * as analytics from './analytics'\r\n\r\nlet initialized = false\r\nconst firebaseConfig = {\r\n  apiKey: 'AIzaSyBHdepwE7M4Byu2lFtX2s__9COcMdvXu7Q',\r\n  authDomain: 'r34-react.firebaseapp.com',\r\n  databaseURL: 'https://r34-react.firebaseio.com',\r\n  projectId: 'r34-react',\r\n  storageBucket: 'r34-react.appspot.com',\r\n  messagingSenderId: '844749417844',\r\n  appId: '1:844749417844:web:11fa1fda0e14f1ac2dd021',\r\n  measurementId: 'G-27J3QXZ8YR',\r\n}\r\n\r\nexport function init() {\r\n  if (!initialized) {\r\n    firebase.initializeApp(firebaseConfig)\r\n\r\n    initialized = true\r\n\r\n    signIn.init()\r\n    storage.init()\r\n    analytics.init()\r\n  }\r\n}\r\n\r\nexport * from './analytics'\r\nexport * from './signIn'\r\nexport * from './storage'\r\n","import styled, { css } from 'styled-components'\r\nimport { flexRowWithGap } from '../../styled/mixins/layout'\r\n\r\nexport const Title = styled.h2(\r\n  ({ theme }) => css`\r\n    font-size: ${theme.fontSizes.bigTitle};\r\n    font-weight: lighter;\r\n    text-align: center;\r\n  `\r\n)\r\n\r\nexport const BigTitle = styled.h1(\r\n  ({ theme }) => css`\r\n    ${flexRowWithGap({ theme })}\r\n\r\n    justify-content: center;\r\n    font-size: ${theme.fontSizes.bigTitle};\r\n    font-weight: lighter;\r\n    text-align: center;\r\n  `\r\n)\r\n\r\nexport const SmallTitle = styled.h3(\r\n  ({ theme }) => css`\r\n    font-size: ${theme.fontSizes.content};\r\n  `\r\n)\r\n\r\nexport const Faded = styled.span(\r\n  ({ theme }) => css`\r\n    color: ${theme.colors.subduedText};\r\n  `\r\n)\r\n","export enum ZIndex {\r\n  POST = 1,\r\n  OVERLAY = 2,\r\n  COOKIEBAR = 100,\r\n  DROPDOWN = 3,\r\n  MODAL = 1000,\r\n}\r\n","export const supportsFlexGap = (() => {\r\n  // create flex container with row-gap set\r\n  var flex = document.createElement('div')\r\n  flex.style.display = 'flex'\r\n  flex.style.flexDirection = 'column'\r\n  flex.style.rowGap = '1px'\r\n\r\n  // create two, elements inside it\r\n  flex.appendChild(document.createElement('div'))\r\n  flex.appendChild(document.createElement('div'))\r\n\r\n  // append to the DOM (needed to obtain scrollHeight)\r\n  document.body.appendChild(flex)\r\n  var isSupported = flex.scrollHeight === 1 // flex container should be 1px high from the row-gap\r\n  //@ts-expect-error\r\n  flex.parentNode.removeChild(flex)\r\n\r\n  return isSupported\r\n})()\r\n\r\nexport const supportsGap = 'gap' in document.body.style\r\nexport const supportsAspectRatio = 'aspect-ratio' in document.body.style\r\nexport const supportsObjectFit = 'object-fit' in document.body.style\r\nexport const supportsFullscreen = document.fullscreenEnabled\r\nexport const supportsNetworkInformationAPI =\r\n  'connection' in navigator || 'mozConnection' in navigator || 'webkitConnection' in navigator\r\nexport const supportsLocalStorage = Boolean(localStorage)\r\n\r\nexport async function openFullscreen(element: Element) {\r\n  if (document.fullscreenEnabled && document.fullscreenElement === null) {\r\n    try {\r\n      const result = element.requestFullscreen()\r\n\r\n      if ('then' in result) {\r\n        return await result\r\n      }\r\n\r\n      return Promise.resolve(result)\r\n    } catch (err) {\r\n      // this causes a warning in console. So nothing to do for me here.\r\n    }\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nexport async function closeFullscreen() {\r\n  if (document.fullscreenEnabled && document.fullscreenElement !== null) {\r\n    try {\r\n      const result = document.exitFullscreen()\r\n\r\n      if ('then' in result) {\r\n        return await result\r\n      }\r\n\r\n      return Promise.resolve(result)\r\n    } catch (err) {\r\n      // this causes a warning in console. So nothing to do for me here.\r\n    }\r\n  }\r\n\r\n  return null\r\n}\r\n","/**\r\n * Converts a list of objects into a map.\r\n * @param list The original list\r\n * @param keyProp The keyProp parameter defines which property of the objects will be used as the index for the map\r\n */\r\nexport const listToMap = <T>(list: T[], keyProp: string): Record<string, T> => {\r\n  return list.reduce((result: Record<string, T>, current: any) => {\r\n    result[current[keyProp]] = current\r\n    return result\r\n  }, {})\r\n}\r\n\r\n/**\r\n * Returns a URL object when the value is a hyperlink. Else undefined\r\n */\r\nexport function parseUrl(value: string) {\r\n  try {\r\n    return new URL(value)\r\n  } catch (err) {\r\n    // This is expected. If this method cannot parse the url it will return undefined.\r\n    return undefined\r\n  }\r\n}\r\n\r\n/**\r\n * converts a version like \"1.2.7\" into 127\r\n */\r\nexport function versionToNumber(majorMinorPatch: string) {\r\n  return Number(majorMinorPatch.split('.').join(''))\r\n}\r\n\r\n/**\r\n * Hacky ass way to download images cross origin. Could solve this by hosting both the app and the api on the same domain.\r\n */\r\nexport function download(url: string) {\r\n  const filename = url.split('/').pop() || ''\r\n\r\n  fetch(`https://r34-json.herokuapp.com/images?url=${url}`)\r\n    .then((response) => response.blob())\r\n    .then((blob) => {\r\n      var a = document.createElement('a')\r\n      a.download = filename\r\n      a.href = window.URL.createObjectURL(blob)\r\n      document.body.appendChild(a)\r\n      a.click()\r\n      a.remove()\r\n    })\r\n    .catch((e) => console.error('Download error:', e))\r\n}\r\n\r\n/**\r\n * Returns the current version of the project\r\n */\r\nexport function getVersion() {\r\n  // Some browsers fail to get environment variables. In that case return unknown.\r\n  if (process?.env?.REACT_APP_VERSION) {\r\n    return process.env.REACT_APP_VERSION\r\n  }\r\n\r\n  return 'unknown'\r\n}\r\n\r\n/**\r\n * Render ready version.\r\n */\r\nexport function getVersionString() {\r\n  const version = getVersion()\r\n\r\n  return version === 'unknown' ? 'Latest Release' : `Version ${version}`\r\n}\r\n\r\n/**\r\n * Returns the correct source based on preferences\r\n */\r\nexport function getCorrectSource(loadOriginal: boolean, big_src: string, small_src: string) {\r\n  const source = loadOriginal ? big_src : small_src\r\n  return source\r\n}\r\n\r\nexport function boolToNumber(value: boolean) {\r\n  return value ? 1 : 0\r\n}\r\n\r\nexport const randomBelow = (max: number) => Math.floor(Math.random() * max)\r\n","import { useCallback } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport { AnyAction } from 'redux'\r\n\r\n/**\r\n * A hook that simplifies usage of simple (unparameterized) Redux actions\r\n */\r\nexport default function useAction<T extends () => AnyAction>(actionCreator: T) {\r\n  const dispatch = useDispatch()\r\n\r\n  return useCallback(() => dispatch(actionCreator()), [actionCreator, dispatch])\r\n}\r\n","import { useCallback } from 'react'\r\nimport { PreferenceKey } from 'r34-types'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { setPreference } from '../redux/actions'\r\nimport { PreferencesState } from '../redux/reducers/preferences'\r\nimport { selectPreferences } from '../redux/selectors'\r\n\r\n/**\r\n * useState for preferences using redux instead of local state.\r\n */\r\nexport default function usePreference<T extends PreferenceKey>(\r\n  key: T\r\n): [PreferencesState[T], (value: PreferencesState[T]) => void] {\r\n  const dispatch = useDispatch()\r\n  const preferences = useSelector(selectPreferences)\r\n  const setValue = useCallback((value: any) => dispatch(setPreference(key, value)), [dispatch, key])\r\n\r\n  return [preferences[key], setValue]\r\n}\r\n","import styled from 'styled-components'\r\nimport { defaultSpacing } from '../../styled/mixins/gap'\r\nimport { layer, solidLayer } from '../../styled/mixins/theming'\r\n\r\n/**\r\n * Includes spacing and background color\r\n */\r\nexport const Surface = styled.div`\r\n  display: grid;\r\n  ${defaultSpacing}\r\n  ${layer}\r\n  width: 100%;\r\n`\r\n\r\n/**\r\n * Includes spacing and background color\r\n */\r\nexport const SolidSurface = styled.div`\r\n  ${defaultSpacing}\r\n  ${solidLayer}\r\n  width: 100%;\r\n`\r\n","import { parseUrl } from '../data/utils'\r\n\r\n/**\r\n * Transforms a number into a shortened version for rendering.\r\n * Useful as it takes up less space.\r\n */\r\nexport const formatCount = (value: number) => {\r\n  if (value / 1e6 >= 1) {\r\n    return `${Math.trunc(value / 1e6)}M`\r\n  }\r\n\r\n  if (value >= 1e3) {\r\n    return `${Math.trunc(value / 1e3)}K`\r\n  }\r\n\r\n  return value.toString()\r\n}\r\n\r\n/**\r\n * Formats source strings for rendering\r\n */\r\nexport const formatSource = (source: string) => {\r\n  const url = parseUrl(source)\r\n  return url ? url.host : source\r\n}\r\n\r\n/**\r\n * Seconds to mm:ss formatter\r\n */\r\nexport function formatDuration(duration: number) {\r\n  const min = Math.trunc(duration / 60)\r\n  const sec = Math.trunc(duration % 60)\r\n\r\n  return min + ':' + (sec < 10 ? '0' : '') + sec\r\n}\r\n\r\n/**\r\n * Formats tag names for rendering.\r\n */\r\nexport function formatTagname(tagname: string) {\r\n  return tagname\r\n    .replace(/_/g, ' ')\r\n    .replace(/source:/g, '')\r\n    .replace(/rating:/g, '')\r\n}\r\n\r\n/**\r\n * Formats tags with their count if possible\r\n */\r\nexport function formatTagnameAndCount(name: string, count?: number) {\r\n  return count ? `${formatTagname(name)} (${formatCount(count)})` : formatTagname(name)\r\n}\r\n\r\nconst z = (value: number) => (value < 10 ? `0${value}` : value.toString())\r\n\r\n/**\r\n * Returns a string containing date and time of agiven Date object\r\n */\r\nexport function formatDatetime(date: Date) {\r\n  const dd = z(date.getDate())\r\n  const MM = z(date.getMonth() + 1) // zero indexed\r\n  const yyyy = date.getFullYear()\r\n  const hh = z(date.getHours())\r\n  const mm = z(date.getMinutes())\r\n\r\n  return `${dd}/${MM}/${yyyy} ${hh}:${mm}`\r\n}\r\n\r\n/**\r\n * Returns a human friendly approximation of a given time\r\n */\r\nexport function formatTime(milliseconds: number) {\r\n  if (milliseconds >= 315576e5) {\r\n    return formatUnit(milliseconds, 315576e5, 'year')\r\n  }\r\n\r\n  if (milliseconds >= 26297568e2) {\r\n    return formatUnit(milliseconds, 26297568e2, 'month')\r\n  }\r\n\r\n  if (milliseconds >= 6048e5) {\r\n    return formatUnit(milliseconds, 6048e5, 'week')\r\n  }\r\n\r\n  if (milliseconds >= 854e5) {\r\n    return formatUnit(milliseconds, 854e5, 'day')\r\n  }\r\n\r\n  if (milliseconds >= 36e5) {\r\n    return formatUnit(milliseconds, 36e5, 'hour')\r\n  }\r\n\r\n  if (milliseconds >= 6e4) {\r\n    return formatUnit(milliseconds, 6e4, 'minute')\r\n  }\r\n\r\n  if (milliseconds >= 1e3) {\r\n    return formatUnit(milliseconds, 1e3, 'second')\r\n  }\r\n\r\n  return `${milliseconds} ms`\r\n}\r\n\r\nexport function formatUnit(value: number, unitSize: number, unit: string) {\r\n  const result = (value / unitSize).toFixed(0)\r\n\r\n  const unitString = result === '1' ? unit : `${unit}s`\r\n\r\n  return `${result} ${unitString}`\r\n}\r\n","import styled from 'styled-components'\r\nimport { flexRowWithGap } from '../../styled/mixins/layout'\r\n\r\nconst FlexPair = styled.div`\r\n  ${flexRowWithGap}\r\n`\r\n\r\nexport default FlexPair\r\n","import styled from 'styled-components'\r\nimport { flexMedia, preserveAspectRatio } from '../../styled/mixins/media'\r\n\r\nconst FlexImage = styled.img`\r\n  ${flexMedia}\r\n  ${preserveAspectRatio}\r\n`\r\n\r\nexport default FlexImage\r\n","export type ParamsRecord = Record<string, string | number | boolean>\r\n\r\nexport const asString = (value: any): string => (typeof value === 'string' ? value : value.toString())\r\n\r\nexport const createSearchParams = (params: ParamsRecord) =>\r\n  Object.entries(params).reduce((acc, [key, value]) => {\r\n    acc.append(key, asString(value))\r\n    return acc\r\n  }, new URLSearchParams())\r\n\r\nexport const sha256 = async (value: string) => {\r\n  const msgBuffer = new TextEncoder().encode(value)\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer)\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\r\n  const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('')\r\n\r\n  return hashHex\r\n}\r\n","import React, { MouseEventHandler } from 'react'\r\nimport FlexPair from './FlexPair'\r\nimport Toggle from './Toggle'\r\n\r\ninterface LabeledToggleProps {\r\n  children: React.ReactNode\r\n  value: boolean\r\n  onToggle: MouseEventHandler\r\n  className?: string\r\n}\r\n\r\nexport default function LabeledToggle(props: LabeledToggleProps) {\r\n  const { children, value, onToggle, className } = props\r\n\r\n  return (\r\n    <FlexPair className={className}>\r\n      <Toggle value={value} onToggle={onToggle} />\r\n      <span>{children}</span>\r\n    </FlexPair>\r\n  )\r\n}\r\n","import { TagType } from 'r34-types'\r\nimport React from 'react'\r\nimport {\r\n  CharacterIcon,\r\n  CopyrightIcon,\r\n  ArtistIcon,\r\n  RatingIcon,\r\n  SourceIcon,\r\n  MetaDataIcon,\r\n  SupertagIcon,\r\n} from './FontAwesomeIcons'\r\n\r\ninterface TypeIconProps {\r\n  type?: TagType\r\n  className?: string\r\n}\r\n\r\nexport default function TypeIcon(props: TypeIconProps) {\r\n  const { type, className = '' } = props\r\n\r\n  switch (type) {\r\n    case 'character':\r\n      return <CharacterIcon className={className} />\r\n    case 'copyright':\r\n      return <CopyrightIcon className={className} />\r\n    case 'artist':\r\n      return <ArtistIcon className={className} />\r\n    case 'rating':\r\n      return <RatingIcon className={className} />\r\n    case 'source':\r\n      return <SourceIcon className={className} />\r\n    case 'metadata':\r\n      return <MetaDataIcon className={className} />\r\n    case 'supertag':\r\n      return <SupertagIcon className={className} />\r\n    default:\r\n      return null\r\n  }\r\n}\r\n","import { css } from 'styled-components'\r\nimport { PropsWithTheme } from './types'\r\n\r\nexport function dropdownScrollbar({ theme }: PropsWithTheme) {\r\n  return css`\r\n    overflow-x: hidden;\r\n    overflow-y: auto;\r\n\r\n    ::-webkit-scrollbar {\r\n      width: 8px;\r\n\r\n      :hover {\r\n        background: ${theme.colors.layerBg};\r\n      }\r\n    }\r\n\r\n    /* Track */\r\n    ::-webkit-scrollbar-track {\r\n      background: ${theme.colors.backgroundColor2};\r\n      border-left: 1px lightgray solid;\r\n    }\r\n\r\n    /* Handle */\r\n    :hover {\r\n      ::-webkit-scrollbar {\r\n        background: ${theme.colors.backgroundColor}20;\r\n      }\r\n    }\r\n\r\n    ::-webkit-scrollbar-thumb {\r\n      background: ${theme.colors.backgroundColor}40;\r\n      border-radius: 100px;\r\n\r\n      :hover {\r\n        background: ${theme.colors.backgroundColor}30;\r\n      }\r\n    }\r\n  `\r\n}\r\n","import styled from 'styled-components'\r\nimport { defaultSpacing } from '../../styled/mixins/gap'\r\nimport { flexColumn } from '../../styled/mixins/layout'\r\n\r\nexport const FlexColumn = styled.div`\r\n  ${flexColumn}\r\n  width: 100%;\r\n  min-height: 100%;\r\n`\r\n\r\nexport const FlexColumnWithSpacing = styled(FlexColumn)`\r\n  ${defaultSpacing}\r\n`\r\n","import { Size } from 'react-virtualized'\r\nimport { css } from 'styled-components'\r\nimport { supportsAspectRatio } from '../../data/browserUtils'\r\nimport { borderRadius } from './theming'\r\n\r\n/**\r\n * Determines how media elements are displayed\r\n */\r\nexport function mediaStyle() {\r\n  return css`\r\n    ${borderRadius}\r\n  `\r\n}\r\n\r\n/**\r\n * Preserves aspect ratio of the element and ensures it is displayed as big as possible\r\n */\r\nexport function flexMedia() {\r\n  return css`\r\n    width: 100%;\r\n    height: 100%;\r\n    display: block;\r\n    object-fit: contain;\r\n  `\r\n}\r\n\r\n/**\r\n * Attempts to preserve aspect ration of an element.\r\n */\r\nexport function preserveAspectRatio({ width, height }: Partial<Size>) {\r\n  if (!width || !height) {\r\n    return ''\r\n  }\r\n\r\n  return supportsAspectRatio\r\n    ? css`\r\n        aspect-ratio: ${width} / ${height};\r\n      `\r\n    : css`\r\n        max-width: 100%;\r\n        height: auto;\r\n      `\r\n}\r\n","import {\r\n  TagType,\r\n  Tag,\r\n  TagModifier,\r\n  BiasedTag,\r\n  Supertag,\r\n  TagsError,\r\n  QueryTag,\r\n} from \"r34-types\"\r\n\r\nconst removeLeadingHastag = (value: string) =>\r\n  value[0] === \"#\" ? value.substr(1) : value\r\nconst isInteresting = (tagType: TagType) =>\r\n  ![\"general\", \"ambiguous\"].includes(tagType)\r\nexport const getInterestingType = (types: TagType[]) =>\r\n  types.find(isInteresting)\r\n\r\n//#region Typing\r\nexport const bias = (tag: Tag, modifier: TagModifier): BiasedTag => ({\r\n  ...tag,\r\n  modifier,\r\n})\r\nexport const isBiased = (tag: Tag | BiasedTag): tag is BiasedTag =>\r\n  (tag as BiasedTag).modifier !== undefined\r\nexport const isSupertag = (tag: unknown): tag is Supertag =>\r\n  (tag as Supertag).tags !== undefined\r\nexport const isSuggestionError = (value: unknown): value is TagsError =>\r\n  (value as TagsError).message !== undefined\r\n//#endregion\r\n\r\n//#region Compression\r\nexport function encodeSupertag(supertag: Supertag) {\r\n  const payload = `${encodeURI(supertag.name)}/${encodeURI(\r\n    supertag.description\r\n  )}/${encodeURI(\r\n    Object.entries(supertag.tags)\r\n      .map(([t, m]) => `${t},${m}`)\r\n      .join(\";\")\r\n  )}`\r\n\r\n  return Buffer.from(payload).toString(\"base64\")\r\n}\r\n\r\nexport function decodeSupertag(base64: string) {\r\n  const payload = Buffer.from(removeLeadingHastag(base64), \"base64\").toString()\r\n  const parts = payload.split(\"/\").map(decodeURI)\r\n  const supertag: Supertag = {\r\n    name: parts[0],\r\n    description: parts[1],\r\n    tags: Object.fromEntries(parts[2].split(\";\").map((e) => e.split(\",\"))),\r\n  }\r\n\r\n  return supertag\r\n}\r\n//#endregion\r\n\r\n//#region Tag serialization\r\n\r\n/**\r\n * Accepts a map of all tags and serializes them into a string that can be used as a Querystring parameter\r\n */\r\nexport function serializeAllTags(tags: Record<string, QueryTag | Supertag>) {\r\n  const resolvedTags = flattenSupertags(Object.values(tags))\r\n  const tagsByModifier = groupTagsByModifier(resolvedTags)\r\n  const normalTags = [...tagsByModifier[\"+\"], ...tagsByModifier[\"-\"]]\r\n    .map(serializeTag)\r\n    .join(\" + \")\r\n  const optionalTags =\r\n    tagsByModifier[\"~\"].length > 0\r\n      ? ` + ( ${tagsByModifier[\"~\"].map(serializeTag).join(\" ~ \")} )`\r\n      : \"\"\r\n\r\n  return `${normalTags}${optionalTags}`\r\n}\r\n\r\n/**\r\n * Accepts a list that holds normal tags and supertags and unpacks all supertags.\r\n * The result contains all normal tags given plus all contents of the supertags given.\r\n */\r\nexport function flattenSupertags(tags: Array<QueryTag | Supertag>) {\r\n  let resolvedTags: QueryTag[] = []\r\n\r\n  tags.forEach((tag) => {\r\n    if (isSupertag(tag)) {\r\n      Object.entries(tag.tags).forEach(([name, modifier]) => {\r\n        resolvedTags.push({ name, modifier })\r\n      })\r\n    } else {\r\n      resolvedTags.push(tag)\r\n    }\r\n  })\r\n\r\n  return resolvedTags\r\n}\r\n\r\n/**\r\n * Given a list of tags this function returns a record with an entry for each modifier countaining all tags of the original list that match that modifier.\r\n */\r\nexport function groupTagsByModifier(tags: QueryTag[]) {\r\n  return tags.reduce(\r\n    (result, current) => {\r\n      if (!(current.modifier in result)) result[current.modifier] = []\r\n\r\n      result[current.modifier]?.push(current)\r\n\r\n      return result\r\n    },\r\n    { \"+\": [], \"-\": [], \"~\": [] } as Record<TagModifier, QueryTag[]>\r\n  )\r\n}\r\n\r\n/**\r\n * Serializes a tag for use in urls\r\n */\r\nexport function serializeTag(tag: QueryTag) {\r\n  return `${tag.modifier === \"-\" ? \"-\" : \"\"}${serializeTagname(tag.name)}`\r\n}\r\n\r\n/**\r\n * Serializes tag names for use in api requests.\r\n */\r\nexport function serializeTagname(tagname: string) {\r\n  return encodeURIComponent(tagname.toLowerCase().replace(/ /g, \"_\"))\r\n}\r\n\r\n//#endregion\r\n","import React, { MouseEventHandler } from 'react'\r\nimport styled, { css, DefaultTheme } from 'styled-components'\r\nimport { supportsAspectRatio } from '../../data/browserUtils'\r\nimport { defaultBorder } from '../../styled/mixins/theming'\r\n\r\nconst Track = styled.div(\r\n  (props) => css`\r\n    height: 24px;\r\n    width: 50px;\r\n    ${defaultBorder(props)}\r\n    border-radius: 30px;\r\n    background-color: transparent;\r\n    transition: transform ${props.theme.timings.longTransitionTime} ease-in-out;\r\n    cursor: pointer;\r\n  `\r\n)\r\n\r\n/**\r\n * CSS helper that falls back to less fancy styling on older browsers\r\n */\r\nfunction circle() {\r\n  return supportsAspectRatio\r\n    ? css`\r\n        height: 100%;\r\n        aspect-ratio: 1/1;\r\n      `\r\n    : css`\r\n        height: 100%;\r\n        width: 22px;\r\n      `\r\n}\r\n\r\nconst Thumb = styled.div(\r\n  (props: { value: boolean; theme: DefaultTheme }) => css`\r\n    ${circle()}\r\n    background-color: ${props.value ? props.theme.colors.accentColor : props.theme.colors.toggleOff};\r\n    border-radius: 100px;\r\n    transition: all 0.2s ease-in-out;\r\n    transform: translate(${props.value ? '26px' : '0px'});\r\n  `\r\n)\r\n\r\ninterface ToggleProps {\r\n  value: boolean\r\n  onToggle: MouseEventHandler\r\n}\r\n\r\nexport default function Toggle(props: ToggleProps) {\r\n  const { value, onToggle } = props\r\n\r\n  return (\r\n    <Track onClick={onToggle} role='checkbox' aria-checked={value}>\r\n      <Thumb value={value} />\r\n    </Track>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport { useTheme } from 'styled-components'\r\nimport { useOnlineChange } from '../../hooks/useOnlineChange'\r\nimport { FailedIcon } from '../../icons/FontAwesomeIcons'\r\n\r\nexport default function OfflineIndicator() {\r\n  const theme = useTheme()\r\n  const isOnline = useOnlineChange()\r\n\r\n  return isOnline ? <div></div> : <FailedIcon title='You are offline' color={theme.colors.negative} />\r\n}\r\n","import React from 'react'\r\n\r\ninterface UseOnlineChangeOptions {\r\n  onOnline?: () => void\r\n  onOffline?: () => void\r\n}\r\n\r\nexport function useOnlineChange(options?: UseOnlineChangeOptions) {\r\n  const [isOnline, setIsOnline] = React.useState(window.navigator.onLine)\r\n\r\n  React.useEffect(() => {\r\n    const listenter = () => {\r\n      setIsOnline(true)\r\n      options?.onOnline?.()\r\n    }\r\n    window.addEventListener('online', listenter)\r\n    return () => window.removeEventListener('online', listenter)\r\n  })\r\n\r\n  React.useEffect(() => {\r\n    const listenter = () => {\r\n      setIsOnline(false)\r\n      options?.onOffline?.()\r\n    }\r\n    window.addEventListener('offline', listenter)\r\n    return () => window.removeEventListener('offline', listenter)\r\n  })\r\n\r\n  return isOnline\r\n}\r\n","import { RefAttributes } from 'react'\r\nimport { Link, LinkProps, useLocation } from 'react-router-dom'\r\nimport styled, { css, ThemeProps } from 'styled-components'\r\nimport { RouteName } from '../../data/types'\r\nimport { buttonBaseStyle, flexRowWithGap } from '../../styled/mixins/layout'\r\n\r\nconst MenuBar = styled.nav`\r\n  ${flexRowWithGap}\r\n  place-content: center;\r\n`\r\n\r\ntype LocationStyledLinkProps = LinkProps<unknown> &\r\n  RefAttributes<HTMLAnchorElement> &\r\n  ThemeProps<any> & { current: string }\r\n\r\nconst LocationStyledLink = styled(Link)(\r\n  ({ to, current, theme }: LocationStyledLinkProps) => css`\r\n    ${buttonBaseStyle}\r\n    color: ${to === current ? theme.colors.accentColor : theme.colors.text};\r\n    border-bottom: solid transparent ${theme.dimensions.borderWidth};\r\n    border-bottom-color: ${to === current\r\n      ? css`\r\n          ${theme.colors.accentColor}\r\n        `\r\n      : 'none'};\r\n    border-radius: 0px;\r\n  `\r\n)\r\n\r\nexport default function Menu() {\r\n  const current = useLocation().pathname\r\n\r\n  return (\r\n    <MenuBar>\r\n      <LocationStyledLink current={current} to={RouteName.SEARCH}>\r\n        <span>Search</span>\r\n      </LocationStyledLink>\r\n\r\n      <LocationStyledLink current={current} to={RouteName.PREFERENCES}>\r\n        <span>Preferences</span>\r\n      </LocationStyledLink>\r\n\r\n      <LocationStyledLink current={current} to={RouteName.ABOUT}>\r\n        <span>About</span>\r\n      </LocationStyledLink>\r\n    </MenuBar>\r\n  )\r\n}\r\n","import styled, { css } from 'styled-components'\r\nimport R34Icon from '../../icons/R34Icon'\r\nimport { defaultSpacing } from '../../styled/mixins/gap'\r\nimport { flexColumn } from '../../styled/mixins/layout'\r\nimport FlexPair from '../designsystem/FlexPair'\r\nimport { BigTitle } from '../designsystem/Text'\r\nimport OfflineIndicator from '../widgets/OfflineIndicator'\r\nimport Menubar from '../widgets/Menubar'\r\nimport React from 'react'\r\n\r\nconst HeaderWrapper = styled.header(\r\n  ({ theme }) => css`\r\n    ${flexColumn}\r\n    background: ${theme.colors.layerBgSolid};\r\n  `\r\n)\r\n\r\nconst TitleBar = styled.div(\r\n  ({ theme }) => css`\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    ${defaultSpacing}\r\n\r\n    > :first-child,\r\n    > :last-child {\r\n      width: ${theme.dimensions.blockHeight};\r\n    }\r\n  `\r\n)\r\n\r\nexport default function Header() {\r\n  return (\r\n    <HeaderWrapper role='cell'>\r\n      <TitleBar>\r\n        <div>{/*placeholder*/}</div>\r\n        <FlexPair>\r\n          <R34Icon size={32} />\r\n          <BigTitle>Rule34 React</BigTitle>\r\n        </FlexPair>\r\n        <OfflineIndicator />\r\n      </TitleBar>\r\n      <Menubar />\r\n    </HeaderWrapper>\r\n  )\r\n}\r\n","import styled, { css } from 'styled-components'\r\nimport { TagModifier } from 'r34-types'\r\n\r\nconst modifierToStyle = {\r\n  '+': css``,\r\n  '-': css`\r\n    text-decoration: line-through;\r\n  `,\r\n  '~': css`\r\n    font-style: italic;\r\n  `,\r\n}\r\n\r\ninterface ModifierStyledTextProps {\r\n  modifier: TagModifier\r\n}\r\n\r\nexport const ModifierStyledText = styled.span(\r\n  ({ modifier = '+' }: ModifierStyledTextProps) => modifierToStyle[modifier]\r\n)\r\n","import { TagModifier } from 'r34-types'\r\nimport { formatTagnameAndCount } from '../../misc/formatting'\r\nimport { ModifierStyledText } from '../designsystem/ModifierStyledText'\r\n\r\ninterface TagNameProps {\r\n  modifier: TagModifier\r\n  name: string\r\n  count?: number\r\n}\r\n\r\nexport default function TagName(props: TagNameProps) {\r\n  const { modifier, name, count } = props\r\n\r\n  return <ModifierStyledText modifier={modifier}>{formatTagnameAndCount(name, count)}</ModifierStyledText>\r\n}\r\n","import React, { MouseEventHandler, useCallback } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport styled, { css } from 'styled-components'\r\nimport { TagModifier } from 'r34-types'\r\nimport { addTag } from '../../redux/actions'\r\nimport { flexRowWithGap } from '../../styled/mixins/layout'\r\nimport TagName from './TagName'\r\n\r\ninterface AliasProps {\r\n  modifier: TagModifier\r\n  name: string\r\n  count: number\r\n}\r\n\r\nconst AliasWrapper = styled.div(\r\n  ({ theme }) => css`\r\n    ${flexRowWithGap({ theme })}\r\n    padding: ${theme.dimensions.bigSpacing};\r\n    font-size: ${theme.fontSizes.content};\r\n    cursor: pointer;\r\n  `\r\n)\r\n\r\nexport default function Alias(props: AliasProps) {\r\n  const { name, count, modifier } = props\r\n\r\n  const dispatch = useDispatch()\r\n\r\n  const handleClick: MouseEventHandler = useCallback(\r\n    (event) => {\r\n      event.stopPropagation()\r\n      dispatch(addTag({ name, types: [], count, modifier }))\r\n    },\r\n    [count, dispatch, modifier, name]\r\n  )\r\n\r\n  return (\r\n    <AliasWrapper onClick={handleClick} data-name={`alias:${name}`}>\r\n      <TagName modifier={modifier} name={name} count={count} />\r\n    </AliasWrapper>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport styled, { css, DefaultTheme } from 'styled-components'\r\nimport Alias from './Alias'\r\nimport * as r34 from 'r34-types'\r\nimport { dropdownScrollbar } from '../../styled/mixins/scrollbar'\r\nimport { ZIndex } from '../../styled/zIndex'\r\n\r\nconst ListWrapper = styled.div(({ theme, parentRef }: { theme: DefaultTheme; parentRef: HTMLDivElement }) => {\r\n  if (parentRef) {\r\n    const clientRect = parentRef.getBoundingClientRect()\r\n\r\n    return css`\r\n      position: absolute;\r\n      top: ${parentRef.offsetTop + clientRect.height}px;\r\n      left: ${parentRef.offsetLeft}px;\r\n      width: ${clientRect.width}px;\r\n\r\n      display: flex;\r\n      flex-direction: column;\r\n\r\n      border-bottom-left-radius: ${theme.dimensions.borderRadius};\r\n      border-bottom-right-radius: ${theme.dimensions.borderRadius};\r\n      border: ${theme.dimensions.borderWidth} solid ${theme.colors.accentColor};\r\n      border-top: none;\r\n\r\n      background: ${theme.colors.backgroundColor2};\r\n      z-index: ${ZIndex.DROPDOWN};\r\n      color: ${theme.colors.backgroundColor};\r\n\r\n      > :not(:last-child) {\r\n        border-bottom: ${theme.dimensions.borderWidth} solid lightgray;\r\n      }\r\n\r\n      max-height: 30vh;\r\n\r\n      ${dropdownScrollbar}\r\n    `\r\n  } else {\r\n    return css`\r\n      display: none;\r\n    `\r\n  }\r\n})\r\n\r\ninterface AliasesListProps {\r\n  aliases: r34.AliasTag[]\r\n  modifier: r34.TagModifier\r\n  parentRef: HTMLDivElement\r\n}\r\n\r\nexport default function AliasesList(props: AliasesListProps) {\r\n  const { aliases, modifier, parentRef } = props\r\n\r\n  return (\r\n    <ListWrapper parentRef={parentRef} className='aliaslist'>\r\n      {aliases.map(({ name, count }) => (\r\n        <Alias key={'a_' + name} name={name} count={count} modifier={modifier} />\r\n      ))}\r\n    </ListWrapper>\r\n  )\r\n}\r\n","import styled, { css, DefaultTheme } from 'styled-components'\r\nimport { TagIsActive } from '../../data/types'\r\nimport { flexRowWithGap } from '../../styled/mixins/layout'\r\nimport { primary, secondary, focus } from '../../styled/mixins/theming'\r\n\r\nconst dropdownBorderRadius = (collapsed: boolean, theme: DefaultTheme) =>\r\n  collapsed ? theme.dimensions.borderRadius : `${theme.dimensions.borderRadius} ${theme.dimensions.borderRadius} 0 0`\r\n\r\nconst switchingColors = (active: TagIsActive, collapsed: boolean, theme: DefaultTheme) => {\r\n  switch (active) {\r\n    case 'direct':\r\n      return css`\r\n        ${primary}\r\n      `\r\n    case 'indirect':\r\n      return css`\r\n        color: ${theme.colors.accentColor};\r\n        background-color: ${theme.colors.accentColor}40;\r\n\r\n        :hover {\r\n          background-color: ${theme.colors.accentColor}60;\r\n        }\r\n\r\n        :active {\r\n          background-color: ${theme.colors.accentColor}50;\r\n        }\r\n\r\n        ${focus}\r\n      `\r\n    case 'no':\r\n      return css`\r\n        ${secondary}\r\n      `\r\n  }\r\n}\r\n\r\nexport const ChipWrapper = styled.div(\r\n  (props: { active: TagIsActive; collapsed: boolean; theme: DefaultTheme }) =>\r\n    css`\r\n      cursor: pointer;\r\n      border: ${props.theme.colors.accentColor} ${props.theme.dimensions.borderWidth} solid;\r\n      ${flexRowWithGap({ theme: props.theme })}\r\n      ${switchingColors(props.active, props.collapsed, props.theme)}\r\n      padding: 0 ${props.theme.dimensions.bigSpacing};\r\n      height: ${props.theme.dimensions.blockHeight};\r\n      border-radius: ${dropdownBorderRadius(props.collapsed, props.theme)};\r\n      font-size: ${props.theme.fontSizes.content};\r\n      user-select: none;\r\n\r\n      ${props.collapsed\r\n        ? ''\r\n        : css`\r\n            border-bottom-color: ${props.theme.colors.accentColor};\r\n          `}\r\n    `\r\n)\r\n","import React, { KeyboardEventHandler, MouseEventHandler, SyntheticEvent, useCallback, useState } from 'react'\r\nimport styled, { DefaultTheme, css } from 'styled-components'\r\nimport { TagModifier, TagType, AliasTag } from 'r34-types'\r\nimport useToggle from '../../hooks/useToggle'\r\nimport { ArrowDown } from '../../icons/FontAwesomeIcons'\r\nimport TypeIcon from '../../icons/TypeIcon'\r\nimport AliasesList from './AliasesList'\r\nimport { ChipWrapper } from './ChipWrapper'\r\nimport TagName from './TagName'\r\nimport { TagIsActive } from '../../data/types'\r\n\r\nconst DropdownArrow = styled(ArrowDown)(\r\n  ({ $collapsed, theme }: { $collapsed: boolean; theme: DefaultTheme }) => css`\r\n    transition: all ${theme.timings.transitionTime} ease-out;\r\n    height: 32px;\r\n    width: 32px !important;\r\n    padding: 8px;\r\n    margin: 0 -8px;\r\n    ${$collapsed\r\n      ? css``\r\n      : css`\r\n          transform: rotate(180deg);\r\n        `}\r\n  `\r\n)\r\n\r\nconst DropdownWrapper = styled.div(\r\n  ({ theme }) => css`\r\n    .aliaslist {\r\n      border-color: ${theme.colors.backgroundColor2};\r\n    }\r\n  `\r\n)\r\n\r\ninterface TagChipProps {\r\n  name: string\r\n  modifier: TagModifier\r\n  count?: number\r\n  type?: TagType\r\n  isActive: TagIsActive\r\n  detailed: boolean\r\n  onClick: React.EventHandler<SyntheticEvent>\r\n  onContextMenu?: React.EventHandler<SyntheticEvent>\r\n  aliases?: AliasTag[]\r\n}\r\n\r\nexport default function TagChip(props: TagChipProps) {\r\n  const { name, count, modifier, type, isActive, detailed, onClick, onContextMenu, aliases } = props\r\n\r\n  const [tagRef, setTagRef] = useState<HTMLDivElement | null>(null)\r\n  const [collapsed, toggleCollapsed] = useToggle(true)\r\n\r\n  const handleClick = useCallback(\r\n    (event: React.MouseEvent | React.KeyboardEvent) => {\r\n      event.preventDefault()\r\n      event.stopPropagation()\r\n      onClick(event)\r\n    },\r\n    [onClick]\r\n  )\r\n\r\n  const handleArrowClick: MouseEventHandler = useCallback(\r\n    (event) => {\r\n      event.stopPropagation()\r\n      toggleCollapsed()\r\n    },\r\n    [toggleCollapsed]\r\n  )\r\n\r\n  const handleEnter: KeyboardEventHandler = useCallback(\r\n    (event) => {\r\n      if (event.key === 'Enter') handleClick(event)\r\n    },\r\n    [handleClick]\r\n  )\r\n\r\n  const handleContextMenu = React.useCallback(\r\n    (e) => {\r\n      e.stopPropagation()\r\n      e.preventDefault()\r\n      onContextMenu?.(e)\r\n    },\r\n    [onContextMenu]\r\n  )\r\n\r\n  return (\r\n    <DropdownWrapper>\r\n      <ChipWrapper\r\n        active={isActive}\r\n        collapsed={collapsed}\r\n        onClick={handleClick}\r\n        onKeyDown={handleEnter}\r\n        onContextMenu={handleContextMenu}\r\n        ref={setTagRef}\r\n        tabIndex={0}\r\n        role='listitem'\r\n      >\r\n        {detailed && <TypeIcon type={type} />}\r\n        <TagName modifier={modifier} name={name} count={count} />\r\n        {detailed && aliases && aliases.length > 0 && (\r\n          <DropdownArrow onClick={handleArrowClick} $collapsed={collapsed} title='Show aliases' />\r\n        )}\r\n      </ChipWrapper>\r\n      {detailed && aliases && aliases.length > 0 && !collapsed && tagRef && (\r\n        <AliasesList aliases={aliases} modifier={modifier} parentRef={tagRef} />\r\n      )}\r\n    </DropdownWrapper>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport * as r34 from 'r34-types'\r\nimport TagChip from './TagChip'\r\nimport { TagIsActive } from '../../data/types'\r\n\r\ninterface SupertagProps {\r\n  tag: r34.Supertag\r\n  isActive: TagIsActive\r\n  detailed: boolean\r\n  onClick: React.MouseEventHandler\r\n}\r\n\r\nexport default function Supertag(props: SupertagProps) {\r\n  const { tag, isActive, detailed, onClick } = props\r\n  const { name, tags } = tag\r\n\r\n  const count = Object.keys(tags).length\r\n\r\n  return (\r\n    <TagChip\r\n      name={name}\r\n      modifier='+'\r\n      type='supertag'\r\n      count={count}\r\n      isActive={isActive}\r\n      detailed={detailed}\r\n      onClick={onClick}\r\n    />\r\n  )\r\n}\r\n","import * as r34 from 'r34-types'\r\nimport TagChip from './TagChip'\r\nimport { getInterestingType } from '../../data/tagUtils'\r\nimport { TagIsActive } from '../../data/types'\r\nimport { useSelector } from 'react-redux'\r\nimport { selectAliases } from '../../redux/selectors'\r\n\r\ninterface TagProps {\r\n  tag: r34.BiasedTag\r\n  isActive: TagIsActive\r\n  detailed: boolean\r\n  onClick: React.MouseEventHandler\r\n  onContextMenu: React.MouseEventHandler\r\n}\r\n\r\nexport function BiasedTag(props: TagProps) {\r\n  const { tag, detailed, onClick, isActive, onContextMenu } = props\r\n  const { name, count, modifier, types } = tag\r\n\r\n  const aliases = useSelector(selectAliases)[name]\r\n\r\n  return (\r\n    <TagChip\r\n      name={name}\r\n      modifier={modifier}\r\n      type={getInterestingType(types)}\r\n      count={count}\r\n      isActive={isActive}\r\n      detailed={detailed}\r\n      onClick={onClick}\r\n      onContextMenu={onContextMenu}\r\n      aliases={aliases}\r\n    />\r\n  )\r\n}\r\n","import React, { MouseEventHandler, useCallback } from 'react'\r\nimport * as r34 from 'r34-types'\r\nimport { bias, isBiased, isSupertag } from '../../data/tagUtils'\r\nimport Supertag from './Supertag'\r\nimport { BiasedTag } from './BiasedTag'\r\nimport { TagIsActive } from '../../data/types'\r\n\r\ninterface TagProps {\r\n  tag: r34.AnyBiasedTag | r34.AnyTag\r\n  isActive: TagIsActive\r\n  detailed: boolean\r\n  onClick: (tag: r34.AnyBiasedTag) => void\r\n  onContextMenu: (tag: r34.AnyBiasedTag) => void\r\n}\r\n\r\nexport default function Tag(props: TagProps) {\r\n  const { tag, isActive, detailed, onClick, onContextMenu } = props\r\n\r\n  const biasedTag = isSupertag(tag) || isBiased(tag) ? tag : bias(tag, '+')\r\n\r\n  const handleClick: MouseEventHandler = useCallback(\r\n    (event) => {\r\n      event?.stopPropagation()\r\n      onClick(biasedTag)\r\n    },\r\n    [onClick, biasedTag]\r\n  )\r\n\r\n  const handleContextMenu: MouseEventHandler = useCallback(\r\n    (event) => {\r\n      onContextMenu(biasedTag)\r\n    },\r\n    [biasedTag, onContextMenu]\r\n  )\r\n\r\n  return isSupertag(biasedTag) ? (\r\n    <Supertag tag={biasedTag} isActive={isActive} detailed={detailed} onClick={handleClick} />\r\n  ) : (\r\n    <BiasedTag\r\n      tag={biasedTag}\r\n      isActive={isActive}\r\n      detailed={detailed}\r\n      onClick={handleClick}\r\n      onContextMenu={handleContextMenu}\r\n    />\r\n  )\r\n}\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\nimport { AnyBiasedTag, AnyTag } from 'r34-types'\r\nimport { multilineList } from '../../styled/mixins/layout'\r\nimport Tag from './Tag'\r\nimport { TagIsActive } from '../../data/types'\r\n\r\nconst TagListWrapper = styled.div`\r\n  ${multilineList}\r\n`\r\n\r\ninterface TagListProps {\r\n  /**\r\n   * The entries of the list. Must be a map to avoid duplicates\r\n   */\r\n  tags: Record<string, AnyTag>\r\n  /**\r\n   * Passthrough classname for styling from outside\r\n   */\r\n  className?: string\r\n  /**\r\n   * Setting detailed to true displays a type for some tags and provides the ability to add aliases.\r\n   */\r\n  detailed: boolean\r\n  /**\r\n   * Children will be added at the end of the list. Here you can provide additional functionality or information\r\n   */\r\n  children?: React.ReactNode\r\n\r\n  onTagClick: (tag: AnyBiasedTag) => void\r\n  onTagMenu: (tag: AnyBiasedTag) => void\r\n  getIsActive?: (tag: AnyTag) => TagIsActive\r\n}\r\n\r\n/**\r\n * This component can be used to display multiple tags in a list of chips/badges.\r\n *\r\n */\r\nexport default function TagList(props: TagListProps) {\r\n  const { tags, className, detailed, children = null, onTagClick, getIsActive, onTagMenu } = props\r\n\r\n  return (\r\n    <TagListWrapper className={className} role='list'>\r\n      {Object.entries(tags).map(([key, tag]) => (\r\n        <Tag\r\n          key={key}\r\n          detailed={detailed}\r\n          tag={tag}\r\n          onClick={onTagClick}\r\n          onContextMenu={onTagMenu}\r\n          isActive={getIsActive?.(tag) || 'no'}\r\n        />\r\n      ))}\r\n      {children}\r\n    </TagListWrapper>\r\n  )\r\n}\r\n","import { css } from 'styled-components'\r\nimport { PropsWithTheme } from './types'\r\n\r\nexport function boxShadow({ theme }: PropsWithTheme) {\r\n  return css`\r\n    box-shadow: 0 1px ${theme.shadow.radius} ${theme.shadow.color};\r\n  `\r\n}\r\n\r\nexport function dropShadow({ theme }: PropsWithTheme) {\r\n  return css`\r\n    filter: drop-shadow(0 1px ${theme.shadow.radius} ${theme.shadow.color});\r\n  `\r\n}\r\n","import styled, { css } from 'styled-components'\r\n\r\nexport const HorizontalLine = styled.div(\r\n  (props) => css`\r\n    align-self: stretch;\r\n    height: 1px;\r\n    background: ${props.theme.colors.layerBgHighlight};\r\n  `\r\n)\r\n\r\nexport const VerticalLine = styled.div(\r\n  (props) => css`\r\n    width: 1px;\r\n    align-self: stretch;\r\n    background: ${props.theme.colors.layerBgHighlight};\r\n  `\r\n)\r\n","import { useCallback, useState } from 'react'\r\n\r\n/**\r\n * A small wrapper for a useState<boolean> that is primarily used for toggling.\r\n * Saves me a few useCallbacks.\r\n */\r\nexport default function useToggle(initialValue = false): [boolean, () => void, () => void] {\r\n  const [value, setValue] = useState<boolean>(initialValue)\r\n  const toggleValue = useCallback(() => setValue(!value), [value])\r\n  const resetValue = useCallback(() => setValue(initialValue), [initialValue])\r\n\r\n  return [value, toggleValue, resetValue]\r\n}\r\n","import { useCallback } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { removeTag, addTag } from '../redux/actions'\r\nimport { selectActiveTags } from '../redux/selectors'\r\nimport * as r34 from 'r34-types'\r\n\r\n/**\r\n * This hook allows you to add a tag to your search or remove it based on its current status.\r\n */\r\nexport default function useToggleTag() {\r\n  const dispatch = useDispatch()\r\n  const activeTags = useSelector(selectActiveTags)\r\n  const toggleTag = useCallback(\r\n    (tag: r34.AnyBiasedTag) => {\r\n      if (tag.name in activeTags) {\r\n        dispatch(removeTag(tag.name))\r\n      } else {\r\n        dispatch(addTag(tag))\r\n      }\r\n    },\r\n    [activeTags, dispatch]\r\n  )\r\n\r\n  return toggleTag\r\n}\r\n","import React from 'react'\r\nimport * as r34 from 'r34-types'\r\nimport styled, { css } from 'styled-components'\r\nimport { CountUnit } from '../../data/types'\r\nimport TypeIcon from '../../icons/TypeIcon'\r\nimport { formatCount, formatTagname } from '../../misc/formatting'\r\n\r\nconst EntryWrapper = styled.div(\r\n  ({ theme }) => css`\r\n    display: grid;\r\n    grid-template-columns: 48px 1fr auto;\r\n    background: ${theme.colors.backgroundColor2};\r\n    padding: ${theme.dimensions.bigSpacing} 0;\r\n    align-items: center;\r\n    cursor: pointer;\r\n  `\r\n)\r\n\r\nconst Name = styled.span`\r\n  grid-column: 2/3;\r\n`\r\n\r\nconst Count = styled.span(\r\n  ({ theme }) => css`\r\n    grid-column: 3/4;\r\n    padding-right: ${theme.dimensions.bigSpacing};\r\n  `\r\n)\r\n\r\nconst Icon = styled.div`\r\n  grid-column: 1/2;\r\n  text-align: center;\r\n`\r\n\r\ninterface EntryProps {\r\n  name: string\r\n  count: number\r\n  type?: r34.TagType\r\n  onClick: React.MouseEventHandler\r\n}\r\n\r\nexport default function DropdownListEntry(props: EntryProps) {\r\n  const { name, count, type, onClick } = props\r\n\r\n  const unit: CountUnit = type === 'supertag' ? 'tags' : 'posts'\r\n\r\n  return (\r\n    <EntryWrapper onClick={onClick} role='listitem'>\r\n      <Icon>\r\n        <TypeIcon type={type} />\r\n      </Icon>\r\n      <Name>{formatTagname(name)}</Name>\r\n      <Count title={`${count} ${unit}`}>\r\n        {count && formatCount(count)} {unit}\r\n      </Count>\r\n    </EntryWrapper>\r\n  )\r\n}\r\n","import styled, { css } from 'styled-components'\r\nimport { flexRowWithGap } from '../../styled/mixins/layout'\r\n\r\nexport const DropdownListError = styled.div(\r\n  ({ theme }) => css`\r\n    ${flexRowWithGap}\r\n    flex-wrap: wrap;\r\n    min-height: ${theme.dimensions.blockHeight}; // COMPAT: Kiwi Browser\r\n    background: ${theme.colors.backgroundColor2};\r\n    padding: 6px;\r\n    align-items: center;\r\n    justify-content: center;\r\n    text-align: center;\r\n  `\r\n)\r\n","import React from 'react'\r\nimport styled, { css, DefaultTheme } from 'styled-components'\r\nimport DropdownListEntry from './DropdownListEntry'\r\nimport * as r34 from 'r34-types'\r\nimport { getInterestingType, isSupertag } from '../../data/tagUtils'\r\nimport { SuggestionsError } from '../../data/types'\r\nimport { DropdownListError } from './DropdownListError'\r\nimport { flexColumnGap } from '../../styled/mixins/gap'\r\nimport { flexColumn } from '../../styled/mixins/layout'\r\nimport { dropdownScrollbar } from '../../styled/mixins/scrollbar'\r\nimport { ZIndex } from '../../styled/zIndex'\r\n\r\nfunction sizeAndPosition(tagSelector: HTMLElement | null) {\r\n  if (tagSelector) {\r\n    const { offsetTop, clientHeight, offsetLeft, clientWidth } = tagSelector\r\n\r\n    return css`\r\n      position: absolute;\r\n      top: ${offsetTop + clientHeight}px;\r\n      left: ${offsetLeft}px;\r\n      width: ${clientWidth}px;\r\n      max-height: 50vh;\r\n    `\r\n  } else {\r\n    return css`\r\n      display: none;\r\n    `\r\n  }\r\n}\r\n\r\nconst ListWrapper = styled.div(\r\n  ({ theme, tagSelectorRef }: { tagSelectorRef: HTMLElement | null; theme: DefaultTheme }) => css`\r\n    ${flexColumn()}\r\n    ${flexColumnGap('1px')}\r\n    ${sizeAndPosition(tagSelectorRef)};\r\n    background: lightgrey;\r\n    box-sizing: border-box;\r\n    border: ${theme.dimensions.borderWidth} ${theme.colors.accentColor} solid;\r\n    border-top: none;\r\n    border-radius: 0 0 3px 3px;\r\n    color: black;\r\n    z-index: ${ZIndex.DROPDOWN};\r\n\r\n    ${dropdownScrollbar}\r\n  `\r\n)\r\n\r\ninterface DropdownListProps {\r\n  tagSelectorRef: HTMLElement | null\r\n  entries: r34.AnyTag[]\r\n  onClick: (entry: r34.AnyTag) => void\r\n  error: SuggestionsError | null\r\n}\r\n\r\nexport default function DropdownList(props: DropdownListProps) {\r\n  const { tagSelectorRef, entries, onClick, error } = props\r\n\r\n  return (\r\n    <ListWrapper tagSelectorRef={tagSelectorRef} role='list'>\r\n      {error ? (\r\n        <DropdownListError role='listitem'>\r\n          <span>{error.message}.</span>\r\n          <span>{error.results} tags found</span>\r\n        </DropdownListError>\r\n      ) : (\r\n        entries.map((entry) => {\r\n          const type = isSupertag(entry) ? 'supertag' : getInterestingType(entry.types)\r\n          const count = isSupertag(entry) ? Object.keys(entry.tags).length : (entry.count as number)\r\n\r\n          return (\r\n            <DropdownListEntry\r\n              key={entry.name}\r\n              onClick={() => onClick(entry)}\r\n              name={entry.name}\r\n              type={type}\r\n              count={count}\r\n            />\r\n          )\r\n        })\r\n      )}\r\n    </ListWrapper>\r\n  )\r\n}\r\n","import React, { ChangeEventHandler, KeyboardEventHandler, useCallback } from 'react'\r\nimport styled, { css } from 'styled-components'\r\n\r\nconst Input = styled.input(\r\n  (props) => css`\r\n    width: 100%;\r\n    border: none;\r\n    outline: none;\r\n    background: none;\r\n    font-size: ${props.theme.fontSizes.content};\r\n    border-top: ${props.theme.colors.accentColor} ${props.theme.dimensions.borderWidth} solid;\r\n    border-bottom: ${props.theme.colors.accentColor} ${props.theme.dimensions.borderWidth} solid;\r\n  `\r\n)\r\n\r\ninterface TagInputProps {\r\n  value: string\r\n  setValue: (newValue: string) => void\r\n  onSubmit: () => void\r\n}\r\n\r\nexport default function TagInput(props: TagInputProps) {\r\n  const { value, setValue, onSubmit } = props\r\n\r\n  const handleChange: ChangeEventHandler<HTMLInputElement> = useCallback(\r\n    (event) => {\r\n      setValue(event.target.value)\r\n    },\r\n    [setValue]\r\n  )\r\n\r\n  const handleEnter: KeyboardEventHandler = useCallback(\r\n    (event: React.KeyboardEvent) => {\r\n      if (event.key === 'Enter') {\r\n        onSubmit()\r\n      }\r\n    },\r\n    [onSubmit]\r\n  )\r\n\r\n  return (\r\n    <Input\r\n      id='tag-input'\r\n      value={value}\r\n      onChange={handleChange}\r\n      onKeyDown={handleEnter}\r\n      placeholder='Search for tags'\r\n      aria-label='Search'\r\n    />\r\n  )\r\n}\r\n","import React from 'react'\r\nimport * as r34 from 'r34-types'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport styled, { css, DefaultTheme } from 'styled-components'\r\nimport useThrottledEffect from 'use-throttled-effect'\r\nimport { bias, isSupertag, serializeTagname } from '../../data/tagUtils'\r\nimport useModifier from '../../hooks/useModifier'\r\nimport { SubmitIcon } from '../../icons/FontAwesomeIcons'\r\nimport { fetchSuggestions, setSuggestions } from '../../redux/actions'\r\nimport { selectSuggestions, selectSuggestionsError } from '../../redux/selectors'\r\nimport { AddButton, ModifierButton } from '../designsystem/Buttons'\r\nimport DropdownList from './DropdownList'\r\nimport TagInput from './TagInput'\r\n\r\nconst TagSelectorWrapper = styled.form(\r\n  (props: { closed: boolean; ref: (ref: HTMLInputElement) => void; theme: DefaultTheme }) => css`\r\n    display: flex;\r\n    background: white;\r\n    ${props.closed\r\n      ? css`\r\n          border-radius: ${props.theme.dimensions.borderRadius};\r\n        `\r\n      : css`\r\n          border-radius: ${props.theme.dimensions.borderRadius} ${props.theme.dimensions.borderRadius} 0 0;\r\n\r\n          > ${AddButton} {\r\n            border-radius: 0 ${props.theme.dimensions.borderRadius} 0 0;\r\n          }\r\n\r\n          > ${ModifierButton} {\r\n            border-radius: ${props.theme.dimensions.borderRadius} 0 0 0;\r\n          }\r\n        `}\r\n  `\r\n)\r\n\r\ninterface TagSelectorProps {\r\n  showSupertags: boolean\r\n  onSubmit: (tag: r34.AnyBiasedTag) => void\r\n}\r\n\r\nexport default function TagSelector(props: TagSelectorProps) {\r\n  const { onSubmit, showSupertags } = props\r\n\r\n  const dispatch = useDispatch()\r\n\r\n  const [value, setValue] = React.useState('')\r\n  const [tagSelectorRef, setTagSelectorRef] = React.useState<HTMLElement | null>(null)\r\n  const [modifier, nextModifier] = useModifier()\r\n\r\n  const suggestions = useSelector(selectSuggestions)\r\n  const error = useSelector(selectSuggestionsError)\r\n\r\n  const activateTag = React.useCallback(\r\n    (tag: r34.Tag | r34.Supertag) => {\r\n      const biasedTag = isSupertag(tag) ? tag : bias(tag, modifier)\r\n      onSubmit(biasedTag)\r\n      setValue('')\r\n    },\r\n    [modifier, onSubmit]\r\n  )\r\n\r\n  // This effect updates suggestions based on the input value\r\n  // if the value is empty, it clears suggestions\r\n  // if the value is not empty, it fetches suggestions from the backend\r\n  useThrottledEffect(\r\n    () => {\r\n      if (value === '') {\r\n        if (suggestions.length > 0) {\r\n          dispatch(setSuggestions([]))\r\n        }\r\n      } else {\r\n        dispatch(fetchSuggestions(value, showSupertags))\r\n      }\r\n    },\r\n    300,\r\n    [value]\r\n  )\r\n\r\n  const handleAddClick = React.useCallback(() => {\r\n    if (value.trim()) {\r\n      const sanitizedTagname = serializeTagname(value)\r\n      const suggestion: r34.AnyTag | undefined = suggestions.find((s) => s.name === sanitizedTagname)\r\n\r\n      if (suggestion) {\r\n        activateTag(suggestion)\r\n      } else {\r\n        activateTag({ name: sanitizedTagname, types: [] })\r\n      }\r\n    }\r\n  }, [value, activateTag, suggestions])\r\n\r\n  const showList = suggestions.length > 0 || error !== null\r\n\r\n  const preventDefault = React.useCallback((e) => e.preventDefault(), [])\r\n\r\n  return (\r\n    <TagSelectorWrapper ref={setTagSelectorRef} closed={!showList} onSubmit={preventDefault}>\r\n      <ModifierButton onClick={nextModifier} aria-label='Tag Modifier' title='Cycle tag modifier'>\r\n        {modifier}\r\n      </ModifierButton>\r\n      <TagInput value={value} setValue={setValue} onSubmit={handleAddClick} />\r\n      <AddButton onClick={handleAddClick} aria-label='Add Tag'>\r\n        <SubmitIcon title='Add tag' />\r\n      </AddButton>\r\n      {showList && value.length > 0 && (\r\n        <DropdownList tagSelectorRef={tagSelectorRef} entries={suggestions} error={error} onClick={activateTag} />\r\n      )}\r\n    </TagSelectorWrapper>\r\n  )\r\n}\r\n","import React, { useCallback } from 'react'\r\nimport { signOut } from '../../client/firebase'\r\nimport { UndoIcon } from '../../icons/FontAwesomeIcons'\r\nimport { BlockButton } from '../designsystem/Buttons'\r\n\r\nexport default function ResetButton(props: any) {\r\n  const reset = useCallback(async () => {\r\n    // localStorage can be disabled in browser settings\r\n    localStorage?.clear()\r\n\r\n    await signOut()\r\n\r\n    window.location.hash = ''\r\n    window.location.reload()\r\n  }, [])\r\n\r\n  return (\r\n    <BlockButton onClick={reset} {...props}>\r\n      <UndoIcon /> Reset Application\r\n    </BlockButton>\r\n  )\r\n}\r\n","export default __webpack_public_path__ + \"static/media/OutOfResults.9c71691c.png\";","import React from 'react'\r\nimport styled from 'styled-components'\r\n\r\n// Don't use theme here so the loadingScreen is independent\r\n// eg. Loading the theme displays this loading screen\r\nconst StyledSvg = styled.svg`\r\n  height: 32px;\r\n  padding: 8px;\r\n  color: white;\r\n`\r\n\r\nexport default function Loading() {\r\n  return (\r\n    <StyledSvg\r\n      xmlns='http://www.w3.org/2000/svg'\r\n      xmlnsXlink='http://www.w3.org/1999/xlink'\r\n      viewBox='0 0 50 20'\r\n      enable-background='new 0 0 0 0'\r\n      xmlSpace='preserve'\r\n    >\r\n      <circle fill='currentcolor' stroke='none' cx='6' cy='10' r='6'>\r\n        <animate attributeName='opacity' dur='1s' values='0;1;0' repeatCount='indefinite' begin='0.1' />\r\n      </circle>\r\n      <circle fill='currentcolor' stroke='none' cx='25' cy='10' r='6'>\r\n        <animate attributeName='opacity' dur='1s' values='0;1;0' repeatCount='indefinite' begin='0.2' />\r\n      </circle>\r\n      <circle fill='currentcolor' stroke='none' cx='44' cy='10' r='6'>\r\n        <animate attributeName='opacity' dur='1s' values='0;1;0' repeatCount='indefinite' begin='0.3' />\r\n      </circle>\r\n    </StyledSvg>\r\n  )\r\n}\r\n","import { useTheme } from 'styled-components'\r\n\r\nexport default function R34Icon(props: { size: number; className?: string }) {\r\n  const theme = useTheme()\r\n\r\n  return (\r\n    <svg\r\n      xmlns='http://www.w3.org/2000/svg'\r\n      width={props.size}\r\n      height={props.size}\r\n      viewBox='0 0 12.7 12.7'\r\n      className={props.className}\r\n    >\r\n      <g transform='translate(0,-284.3)'>\r\n        <circle\r\n          id='path18'\r\n          cx='6.3499999'\r\n          cy='290.65002'\r\n          fill='none'\r\n          stroke={theme.colors.accentColor}\r\n          strokeWidth='0.50848764'\r\n          strokeMiterlimit='4'\r\n          strokeDasharray='none'\r\n          strokeOpacity='1'\r\n          r='6.0957561'\r\n        />\r\n        <text\r\n          fontStyle='normal'\r\n          fontWeight='normal'\r\n          fontSize='8.3113203px'\r\n          fontFamily='sansSerif'\r\n          letterSpacing='0px'\r\n          wordSpacing='0px'\r\n          fill={theme.colors.accentColor}\r\n          fillOpacity='1'\r\n          x='2.1363549'\r\n          y='289.02704'\r\n          id='text4533'\r\n          transform='scale(0.98538224,1.0148346)'\r\n        >\r\n          <tspan\r\n            id='tspan4531'\r\n            x='2'\r\n            y='289.1'\r\n            fontStyle='normal'\r\n            fontVariant='normal'\r\n            fontWeight='300'\r\n            fontStretch='normal'\r\n            fontFamily='Calibri'\r\n            fill={theme.colors.accentColor}\r\n            fillOpacity='1'\r\n          >\r\n            34\r\n          </tspan>\r\n        </text>\r\n      </g>\r\n    </svg>\r\n  )\r\n}\r\n","import { useCallback } from 'react'\r\nimport { TagModifier } from 'r34-types'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { selectSuggestionsModifier } from '../redux/selectors'\r\nimport { setSuggestionsModifier } from '../redux/actions'\r\n\r\nconst order: TagModifier[] = ['+', '-', '~']\r\n\r\n/**\r\n * Small utility hook to abstract the rotating modifier away\r\n */\r\nexport default function useModifier() {\r\n  const dispatch = useDispatch()\r\n  const modifier = useSelector(selectSuggestionsModifier)\r\n  const nextModifier = useCallback(\r\n    () => dispatch(setSuggestionsModifier(order[(order.indexOf(modifier) + 1) % order.length])),\r\n    [dispatch, modifier]\r\n  )\r\n\r\n  return [modifier, nextModifier] as const\r\n}\r\n","import React, { useCallback, useEffect } from 'react'\r\nimport * as r34 from 'r34-types'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { isSupertag } from '../../data/tagUtils'\r\nimport { ModalId, NO_OP } from '../../data/types'\r\nimport { useCheckIsActive } from '../../hooks/useCheckIsActive'\r\nimport useToggleTag from '../../hooks/useToggleTag'\r\nimport { SupertagIcon } from '../../icons/FontAwesomeIcons'\r\nimport { addTag, openModal } from '../../redux/actions'\r\nimport { selectActiveTags, selectNumberOfActiveTags } from '../../redux/selectors'\r\nimport { PrimaryButton } from '../designsystem/Buttons'\r\nimport TagList from '../tag/TagList'\r\n\r\ninterface ActiveTagsProps {\r\n  onChange?: () => void\r\n  offerSupertags?: boolean\r\n}\r\n\r\nexport default function ActiveTags(props: ActiveTagsProps) {\r\n  const { onChange = NO_OP, offerSupertags = false } = props\r\n\r\n  const dispatch = useDispatch()\r\n\r\n  const activeTags = useSelector(selectActiveTags)\r\n  const numberOfActiveTags = useSelector(selectNumberOfActiveTags)\r\n  const openSupertagModal = useCallback(() => dispatch(openModal(ModalId.CREATE_SUPERTAG)), [dispatch])\r\n\r\n  const toggleTag = useToggleTag()\r\n  const checkIsActive = useCheckIsActive()\r\n\r\n  const onTagMenu = React.useCallback(\r\n    (tag: r34.AnyBiasedTag) => {\r\n      if (!isSupertag(tag)) {\r\n        const order: r34.TagModifier[] = ['+', '-', '~']\r\n        const nextModifer = order[(order.indexOf(tag.modifier) + 1) % 3]\r\n        dispatch(addTag({ ...tag, modifier: nextModifer }))\r\n      }\r\n    },\r\n    [dispatch]\r\n  )\r\n\r\n  // Fire change event when tags change\r\n  // This is used to re-measure the height\r\n  useEffect(() => onChange(), [onChange, activeTags])\r\n\r\n  return numberOfActiveTags > 0 ? (\r\n    <TagList tags={activeTags} onTagClick={toggleTag} getIsActive={checkIsActive} onTagMenu={onTagMenu} detailed>\r\n      {offerSupertags && Object.keys(activeTags).length > 1 && (\r\n        <PrimaryButton onClick={openSupertagModal} title='Create a supertag'>\r\n          <SupertagIcon />\r\n        </PrimaryButton>\r\n      )}\r\n    </TagList>\r\n  ) : null\r\n}\r\n","import { useCallback } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport { AnyTag } from 'r34-types'\r\nimport { TagIsActive } from '../data/types'\r\nimport { selectActiveSupertagTags, selectActiveTags } from '../redux/selectors'\r\n\r\nexport const useCheckIsActive = () => {\r\n  const activeTags = useSelector(selectActiveTags)\r\n  const activeSupertagsTags = useSelector(selectActiveSupertagTags)\r\n\r\n  return useCallback(\r\n    (tag: AnyTag): TagIsActive => {\r\n      if (tag.name in activeTags) return 'direct'\r\n      if (tag.name in activeSupertagsTags) return 'indirect'\r\n      else return 'no'\r\n    },\r\n    [activeSupertagsTags, activeTags]\r\n  )\r\n}\r\n","import * as r34 from 'r34-types'\r\nimport { useCallback } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport { addTag } from '../redux/actions'\r\n\r\nexport const useActivateTag = () => {\r\n  const dispatch = useDispatch()\r\n\r\n  return useCallback(\r\n    (tag: r34.AnyBiasedTag) => {\r\n      dispatch(addTag(tag))\r\n    },\r\n    [dispatch]\r\n  )\r\n}\r\n","import React, { ReactNode } from 'react'\r\n\r\ninterface ErrorBoundaryProps {\r\n  fallback: ReactNode\r\n  children: ReactNode\r\n}\r\n\r\ninterface ErrorBoundaryState {\r\n  hasError: boolean\r\n}\r\n\r\nexport default class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\r\n  constructor(props: ErrorBoundaryProps) {\r\n    super(props)\r\n    this.state = { hasError: false }\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error) {\r\n    return { hasError: true }\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return this.props.fallback\r\n    }\r\n\r\n    return this.props.children\r\n  }\r\n}\r\n","import React from 'react'\r\nimport { RouteName } from '../../data/types'\r\n\r\nconst keybinds: Record<string, () => void> = {\r\n  '/': () => document.getElementById('tag-input')?.focus(),\r\n  'ctrl+1': () => (window.location.hash = `#${RouteName.SEARCH}`),\r\n  'ctrl+2': () => (window.location.hash = `#${RouteName.PREFERENCES}`),\r\n  'ctrl+3': () => (window.location.hash = `#${RouteName.ABOUT}`),\r\n}\r\n\r\nexport default function GlobalKeybindings() {\r\n  React.useEffect(() => {\r\n    const handler = (event: KeyboardEvent) => {\r\n      const pressed = `${event.ctrlKey ? 'ctrl+' : ''}${event.key}`\r\n\r\n      if (pressed in keybinds) {\r\n        event.preventDefault()\r\n        event.stopPropagation()\r\n        keybinds[pressed]()\r\n      }\r\n    }\r\n    document.addEventListener('keydown', handler)\r\n    return () => document.removeEventListener('keydown', handler)\r\n  })\r\n\r\n  return null\r\n}\r\n","import { createGlobalStyle, css } from 'styled-components'\r\n\r\nexport default createGlobalStyle(\r\n  ({ theme }) => css`\r\n    p,\r\n    a,\r\n    button,\r\n    span,\r\n    div,\r\n    select,\r\n    input {\r\n      font-family: 'Raleway', sans-serif;\r\n      -webkit-font-smoothing: antialiased;\r\n      -moz-osx-font-smoothing: grayscale;\r\n      font-size: ${theme.fontSizes.content};\r\n    }\r\n\r\n    html {\r\n      background-color: ${theme.colors.backgroundColor};\r\n    }\r\n\r\n    body {\r\n      font-size: ${theme.fontSizes.content};\r\n      color: ${theme.colors.text};\r\n      background-color: ${theme.colors.backgroundColor};\r\n      transition: color 0.4s, background-color 0.4s;\r\n\r\n      // always show scrollbar to prevent layout shifts when changing pages\r\n      overflow-y: scroll;\r\n    }\r\n\r\n    a {\r\n      color: ${theme.colors.accentColor};\r\n      text-decoration: none;\r\n    }\r\n\r\n    // Not a touch device\r\n    // Touch devices have nice scrollbars by default\r\n    @media (pointer: fine) {\r\n      // Underline stuff that is focused on non-touch devices\r\n      // makes keyboard navigation clearer\r\n      button,\r\n      input,\r\n      select {\r\n        &:focus {\r\n          text-decoration: underline;\r\n        }\r\n      }\r\n\r\n      ::-webkit-scrollbar {\r\n        height: 8px;\r\n        transition: all ${theme.timings.transitionTime} ease-in-out;\r\n\r\n        :hover {\r\n          background: ${theme.colors.layerBg};\r\n        }\r\n      }\r\n\r\n      /* Track */\r\n      ::-webkit-scrollbar-track {\r\n        background: transparent;\r\n      }\r\n\r\n      /* Handle */\r\n      :hover {\r\n        ::-webkit-scrollbar {\r\n          background: ${theme.colors.layerBg};\r\n        }\r\n      }\r\n\r\n      ::-webkit-scrollbar-thumb {\r\n        background: ${theme.colors.layerBg};\r\n        border-radius: 1000px;\r\n\r\n        :hover {\r\n          background: ${theme.colors.layerBgHighlight};\r\n        }\r\n      }\r\n    }\r\n  `\r\n)\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\nimport ResetButton from '../widgets/ResetButton'\r\nimport outOfResultsPicture from '../../icons/OutOfResults.png'\r\nimport FlexImage from '../designsystem/FlexImage'\r\nimport { themes, defaultThemeId } from 'r34-branding'\r\nimport GlobalStyles from '../../GlobalStyles'\r\nimport { BlockButton } from '../designsystem/Buttons'\r\nimport { UndoIcon } from '../../icons/FontAwesomeIcons'\r\n\r\nconst FullScreenCentered = styled.div`\r\n  height: 100vh;\r\n  width: 100%;\r\n  display: grid;\r\n  place-items: center;\r\n  align-content: center;\r\n  padding: 30px;\r\n  background: ${({ theme }) => theme.colors.backgroundColor};\r\n\r\n  > * {\r\n    margin-bottom: 10px;\r\n  }\r\n`\r\n\r\nexport default function ErrorScreen() {\r\n  const theme = themes[defaultThemeId]\r\n\r\n  return (\r\n    <FullScreenCentered theme={theme}>\r\n      <GlobalStyles theme={theme} />\r\n      <FlexImage src={outOfResultsPicture} alt='Cute image to make unexpected crash more bearable' />\r\n      <h1>Sorry about that...</h1>\r\n      <p>A page reload might help:</p>\r\n      <BlockButton onClick={() => window.location.reload()}>\r\n        <UndoIcon /> Reload\r\n      </BlockButton>\r\n      <p>If the issue persists try resetting the app</p>\r\n      <ResetButton theme={theme} />\r\n    </FullScreenCentered>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\nimport Loading from '../../icons/Loading'\r\n\r\nconst FullScreenCentered = styled.div`\r\n  height: 100vh;\r\n  width: 100vw;\r\n  display: grid;\r\n  place-items: center;\r\n  background: black;\r\n`\r\n\r\nexport default function LoadingScreen() {\r\n  return (\r\n    <FullScreenCentered>\r\n      <Loading />\r\n    </FullScreenCentered>\r\n  )\r\n}\r\n","import styled, { css } from 'styled-components'\r\nimport { DiscordIcon } from '../../icons/FontAwesomeIcons'\r\nimport { gap } from '../../styled/mixins/gap'\r\nimport { LinkButton } from '../designsystem/Buttons'\r\nimport { FlexColumn, FlexColumnWithSpacing } from '../designsystem/FlexColumn'\r\nimport { Surface } from '../designsystem/Surface'\r\nimport { Faded, Title } from '../designsystem/Text'\r\nimport Header from '../features/Header'\r\n\r\nconst SectionBody = styled(Surface)(\r\n  ({ theme }) => css`\r\n    padding: ${theme.dimensions.hugeSpacing};\r\n    ${gap(theme.dimensions.hugeSpacing)};\r\n  `\r\n)\r\n\r\nconst Section = styled(FlexColumnWithSpacing)`\r\n  flex-grow: 1;\r\n`\r\n\r\nexport default function Terms() {\r\n  document.title = 'Rule34 React - Terms of Service'\r\n\r\n  return (\r\n    <FlexColumn>\r\n      <Header />\r\n      <Section>\r\n        <Title>Terms of Service</Title>\r\n        <SectionBody>\r\n          <p>\r\n            Because this website is basically just a really powerful looking glass, I do not impose any additional terms\r\n            or conditions on you.\r\n          </p>\r\n          <p>\r\n            However, terms for the technologies this app uses still apply. Therefore, you should read the following\r\n            terms.\r\n          </p>\r\n          <a href='https://policies.google.com/terms'>Google - Privacy & Terms</a>\r\n          <a href='https://rule34.xxx/tos.php'>Rule34 - Terms of Serivce</a>\r\n          <Faded>If you have any questions feel free to contact me via Discord</Faded>\r\n          <LinkButton href=' https://discord.gg/yyJFG5PVBZ'>\r\n            <DiscordIcon />\r\n            Discord\r\n          </LinkButton>\r\n        </SectionBody>\r\n      </Section>\r\n    </FlexColumn>\r\n  )\r\n}\r\n","import React, { useCallback } from 'react'\r\nimport styled, { css } from 'styled-components'\r\nimport useAction from '../../hooks/useAction'\r\nimport { closeModal } from '../../redux/actions'\r\nimport { flexColumnWithGap, fullscreenOverlay } from '../../styled/mixins/layout'\r\nimport { ZIndex } from '../../styled/zIndex'\r\nimport { SolidSurface } from './Surface'\r\n\r\nconst Wrapper = styled.div(\r\n  ({ theme }) => css`\r\n    display: grid;\r\n    place-items: center;\r\n    ${fullscreenOverlay}\r\n    z-index: ${ZIndex.MODAL};\r\n    padding: ${theme.dimensions.hugeSpacing};\r\n    background: ${theme.colors.backdrop};\r\n  `\r\n)\r\n\r\nconst ModalSurface = styled(SolidSurface)(\r\n  ({ theme }) => css`\r\n    ${flexColumnWithGap}\r\n    max-width: ${theme.dimensions.modalWidth};\r\n    max-height: 100vh;\r\n    overflow-y: auto;\r\n    overscroll-behavior: none;\r\n  `\r\n)\r\n\r\ninterface ModalProps {\r\n  children: React.ReactNode\r\n}\r\n\r\nexport default function Modal(props: ModalProps) {\r\n  const { children } = props\r\n\r\n  const close = useAction(closeModal)\r\n  const blockEvent = useCallback((e) => e.stopPropagation(), [])\r\n\r\n  return (\r\n    <Wrapper onClick={close} title='Close modal'>\r\n      <ModalSurface onClick={blockEvent} title=''>\r\n        {children}\r\n      </ModalSurface>\r\n    </Wrapper>\r\n  )\r\n}\r\n","export default __webpack_public_path__ + \"static/media/eeek.ff41d889.png\";","import React, { useCallback } from 'react'\r\nimport useAction from '../../hooks/useAction'\r\nimport { closeModal, getResults } from '../../redux/actions'\r\nimport Modal from '../designsystem/Modal'\r\nimport eeek from '../../icons/eeek.png'\r\nimport FlexImage from '../designsystem/FlexImage'\r\nimport { Faded, Title } from '../designsystem/Text'\r\nimport { flexRowWithGap } from '../../styled/mixins/layout'\r\nimport { PrimaryButton } from '../designsystem/Buttons'\r\nimport styled from 'styled-components'\r\nimport { FailedIcon, SuccessIcon } from '../../icons/FontAwesomeIcons'\r\nimport LabeledToggle from '../designsystem/LabeledToggle'\r\nimport usePreference from '../../hooks/usePreference'\r\n\r\nconst ButtonRow = styled.div`\r\n  ${flexRowWithGap}\r\n\r\n  > ${PrimaryButton} {\r\n    flex-grow: 1;\r\n  }\r\n`\r\n\r\nexport default function CellularWarningModal() {\r\n  const close = useAction(closeModal)\r\n  const search = useAction(getResults)\r\n\r\n  const onConfirm = useCallback(() => {\r\n    search()\r\n    close()\r\n  }, [close, search])\r\n\r\n  const onCancel = useCallback(() => {\r\n    close()\r\n  }, [close])\r\n\r\n  const [autoPlay, setAutoPlay] = usePreference('autoPlay')\r\n  const toggleAutoPlay = useCallback(() => setAutoPlay(!autoPlay), [autoPlay, setAutoPlay])\r\n  const [preloadVideos, setPreloadVideos] = usePreference('preloadVideos')\r\n  const togglePreloadVideos = useCallback(() => setPreloadVideos(!preloadVideos), [preloadVideos, setPreloadVideos])\r\n  const [originals, setOriginals] = usePreference('originals')\r\n  const toggleOriginals = useCallback(() => setOriginals(!originals), [originals, setOriginals])\r\n\r\n  return (\r\n    <Modal>\r\n      <FlexImage src={eeek} />\r\n      <Title>Wait!</Title>\r\n      <Faded>\r\n        You are on cellular and have some features enabled that will consume a lot of data. Are you sure this is\r\n        intended?\r\n      </Faded>\r\n      <LabeledToggle value={autoPlay} onToggle={toggleAutoPlay}>\r\n        Auto-play Animations\r\n      </LabeledToggle>\r\n      <LabeledToggle value={preloadVideos} onToggle={togglePreloadVideos}>\r\n        Preload Animations\r\n      </LabeledToggle>\r\n      <LabeledToggle value={originals} onToggle={toggleOriginals}>\r\n        Load original sizes\r\n      </LabeledToggle>\r\n      <ButtonRow>\r\n        <PrimaryButton onClick={onConfirm}>\r\n          <SuccessIcon /> Yes\r\n        </PrimaryButton>\r\n        <PrimaryButton onClick={onCancel}>\r\n          <FailedIcon /> No\r\n        </PrimaryButton>\r\n      </ButtonRow>\r\n    </Modal>\r\n  )\r\n}\r\n","import React, { useCallback } from 'react'\r\nimport styled, { css } from 'styled-components'\r\nimport { PrimaryButton } from '../designsystem/Buttons'\r\nimport usePreference from '../../hooks/usePreference'\r\nimport { ZIndex } from '../../styled/zIndex'\r\nimport { SolidSurface } from '../designsystem/Surface'\r\n\r\nconst CookieWrapper = styled(SolidSurface)(\r\n  ({ theme }) => css`\r\n    position: sticky;\r\n    bottom: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    color: ${theme.colors.text};\r\n    background: ${theme.colors.layerBgSolid};\r\n    z-index: ${ZIndex.COOKIEBAR};\r\n  `\r\n)\r\n\r\nconst StyledSpan = styled.span`\r\n  height: min-content;\r\n`\r\n\r\nexport default function CookieConfirmation() {\r\n  const [, setCookies] = usePreference('cookies')\r\n\r\n  const handleAccept = useCallback(() => setCookies(true), [setCookies])\r\n\r\n  return (\r\n    <CookieWrapper>\r\n      <StyledSpan>This website uses cookies.</StyledSpan>\r\n      <PrimaryButton onClick={handleAccept} aria-label='Allow Cookies' title='Accept Cookie usage'>\r\n        Okay\r\n      </PrimaryButton>\r\n    </CookieWrapper>\r\n  )\r\n}\r\n","import React, { useCallback, useState } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport styled, { css } from 'styled-components'\r\nimport { addSupertag } from '../../client/firebase'\r\nimport { selectActiveTags } from '../../redux/selectors'\r\nimport { defaultBorder } from '../../styled/mixins/theming'\r\nimport { BlockButton } from '../designsystem/Buttons'\r\nimport { HorizontalLine } from '../designsystem/Lines'\r\nimport { Title } from '../designsystem/Text'\r\nimport TagSelector from '../tagSelector/TagSelector'\r\nimport ActiveTags from './ActiveTags'\r\nimport * as r34 from 'r34-types'\r\nimport { isSupertag } from '../../data/tagUtils'\r\nimport { useActivateTag } from '../../hooks/useActivateTag'\r\nimport { closeModal, removeTag } from '../../redux/actions'\r\nimport useAction from '../../hooks/useAction'\r\nimport Modal from '../designsystem/Modal'\r\nimport { defaultBlock } from '../../styled/mixins/layout'\r\n\r\nconst StyledInput = styled.input(\r\n  ({ theme }) => css`\r\n    ${defaultBorder}\r\n    background-color: ${theme.colors.backgroundColor2};\r\n    ${defaultBlock}\r\n    text-align: left;\r\n  `\r\n)\r\n\r\nexport default function SupertagModal() {\r\n  const [name, setName] = useState('')\r\n  const [description, setDescription] = useState('')\r\n  const activeTags = useSelector(selectActiveTags)\r\n  const dispatch = useDispatch()\r\n  const activateTag = useActivateTag()\r\n  const close = useAction(closeModal)\r\n\r\n  const tags: Record<string, r34.TagModifier> = Object.values(activeTags)\r\n    .filter((tag): tag is r34.BiasedTag => !isSupertag(tag))\r\n    .reduce((result, tag) => ({ ...result, [tag.name]: tag.modifier }), {})\r\n\r\n  const handleCreate = useCallback(() => {\r\n    addSupertag(name, description, tags)\r\n      .then(() => {\r\n        Object.keys(tags).forEach((tagname) => dispatch(removeTag(tagname)))\r\n        activateTag({ name, description, tags })\r\n        close()\r\n      })\r\n      .catch((err) => console.error('Failed to create supertag', err))\r\n  }, [activateTag, close, description, dispatch, name, tags])\r\n\r\n  return (\r\n    <Modal>\r\n      <Title>Create Supertag</Title>\r\n      <HorizontalLine />\r\n      <StyledInput type='text' placeholder='Name' value={name} onChange={(e) => setName(e.target.value)} />\r\n      <StyledInput\r\n        type='text'\r\n        placeholder='Description'\r\n        value={description}\r\n        onChange={(e) => setDescription(e.target.value)}\r\n      />\r\n      <TagSelector showSupertags={false} onSubmit={activateTag} />\r\n      <ActiveTags />\r\n      <BlockButton onClick={handleCreate}>Create</BlockButton>\r\n    </Modal>\r\n  )\r\n}\r\n","enum AnalyticsEventId {\r\n  SEARCH = 'r34_search',\r\n}\r\n\r\nexport type SearchEvent = {\r\n  id: AnalyticsEventId.SEARCH\r\n  payload: {\r\n    page_number: number\r\n  }\r\n}\r\n\r\n/**\r\n * Should be called whenever a new search is started.\r\n */\r\nexport const searchEvent = (page_number: number): SearchEvent => ({\r\n  id: AnalyticsEventId.SEARCH,\r\n  payload: {\r\n    page_number,\r\n  },\r\n})\r\n","import { AppAction, SET_POSTS, ADD_POSTS } from '../actions'\r\n\r\nimport { searchEvent } from '../../analytics/events'\r\nimport { selectPageNumber, selectCookies } from '../selectors'\r\nimport { MiddlewareAPI, Dispatch } from 'redux'\r\nimport { logEvent } from '../../client/firebase'\r\n\r\nconst eventLogging = (store: MiddlewareAPI<any>) => (next: Dispatch<AppAction>) => (action: AppAction) => {\r\n  const state = store.getState()\r\n  const cookies = selectCookies(state)\r\n\r\n  // Only send analytics if the user consented\r\n  if (cookies) {\r\n    if (action.type === ADD_POSTS || action.type === SET_POSTS) {\r\n      const pageNumber = selectPageNumber(state)\r\n      logEvent(searchEvent(pageNumber))\r\n    }\r\n  }\r\n\r\n  next(action)\r\n}\r\n\r\nexport default eventLogging\r\n","import produce from 'immer'\r\nimport * as r34 from 'r34-types'\r\nimport { AppAction, SET_PREFERENCE, SET_PREFERENCES } from '../actions'\r\n\r\nexport interface PreferencesState {\r\n  rated: boolean\r\n  ratedThreshold: number\r\n  originals: boolean\r\n  cookies: boolean\r\n  preloadVideos: boolean\r\n  tagSuggestionsCount: number\r\n  resultsLayout: r34.ResultsLayout\r\n  pageSize: number\r\n  showMetadata: boolean\r\n  showComments: boolean\r\n  sort: r34.PostsSort\r\n  themeId: r34.Theme\r\n  autoPlay: boolean\r\n  hideSeen: boolean\r\n  autoscrollDelay: number\r\n  showPostDetails: boolean\r\n  backends: string[]\r\n}\r\n\r\nexport const initialPreferencesState: PreferencesState = {\r\n  rated: false,\r\n  ratedThreshold: 1,\r\n  originals: false,\r\n  cookies: false,\r\n  preloadVideos: false,\r\n  tagSuggestionsCount: 20,\r\n  resultsLayout: 'infinite_column',\r\n  pageSize: 20,\r\n  showMetadata: false,\r\n  showComments: false,\r\n  sort: 'date:desc',\r\n  themeId: 'dark',\r\n  autoPlay: false,\r\n  hideSeen: false,\r\n  autoscrollDelay: 10,\r\n  showPostDetails: true,\r\n  backends: ['https://r34-json.herokuapp.com', 'https://r34-api-clone.herokuapp.com'],\r\n}\r\n\r\nfunction setPreference<T extends r34.PreferenceKey>(state: PreferencesState, key: T, value: PreferencesState[T]) {\r\n  return produce(state, (draft) => {\r\n    draft[key] = value\r\n  })\r\n}\r\n\r\nfunction setPreferences(state: PreferencesState, preferences: Partial<PreferencesState>) {\r\n  return produce(state, (draft) => {\r\n    Object.assign(draft, preferences)\r\n  })\r\n}\r\n\r\nconst preferences = (state: PreferencesState = initialPreferencesState, action: AppAction): PreferencesState => {\r\n  switch (action.type) {\r\n    case SET_PREFERENCE:\r\n      return setPreference(state, action.key, action.value)\r\n    case SET_PREFERENCES:\r\n      return setPreferences(state, action.preferences)\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default preferences\r\n","import { MiddlewareAPI } from 'redux'\r\nimport { Dispatch } from 'react'\r\nimport {\r\n  AppAction,\r\n  FETCH_PREFERENCES,\r\n  savePreferences,\r\n  SAVE_PREFERENCES,\r\n  setPreferences,\r\n  SET_PREFERENCE,\r\n} from '../actions'\r\nimport * as firebaseFunctions from '../../client/firebase'\r\nimport { initialPreferencesState } from '../reducers/preferences'\r\n\r\nlet saveTimeout: ReturnType<typeof setTimeout> | null = null\r\n\r\nconst persistence = (store: MiddlewareAPI) => (next: Dispatch<AppAction>) => async (action: AppAction) => {\r\n  if (action.type === SET_PREFERENCE) {\r\n    if (saveTimeout) {\r\n      clearTimeout(saveTimeout)\r\n      saveTimeout = null\r\n    } else {\r\n      saveTimeout = setTimeout(() => {\r\n        store.dispatch(savePreferences())\r\n        saveTimeout = null\r\n      }, 10000)\r\n    }\r\n  }\r\n\r\n  if (action.type === FETCH_PREFERENCES) {\r\n    const preferences = await firebaseFunctions.getPreferences()\r\n\r\n    if (preferences) {\r\n      // fill gaps with default values to avoid invalid preferences\r\n      const newPreferences = { ...initialPreferencesState, ...preferences }\r\n      store.dispatch(setPreferences(newPreferences))\r\n    }\r\n  }\r\n\r\n  if (action.type === SAVE_PREFERENCES) {\r\n    const { preferences } = store.getState()\r\n    firebaseFunctions.setPreferences(preferences)\r\n  }\r\n\r\n  next(action)\r\n}\r\n\r\nexport default persistence\r\n","import { AliasTag } from 'r34-types'\r\nimport { R34Client } from '../../client/R34Client'\r\nimport { Dispatch } from 'react'\r\nimport { MiddlewareAPI } from 'redux'\r\nimport { isSuggestionError, isSupertag, serializeTagname } from '../../data/tagUtils'\r\nimport {\r\n  addAliases,\r\n  addPosts,\r\n  ADD_TAG,\r\n  AppAction,\r\n  FETCH_COMMENTS,\r\n  FETCH_SUGGESTIONS,\r\n  GET_MORE_RESULTS,\r\n  GET_RESULTS,\r\n  LIKE_POST,\r\n  setComments,\r\n  setPosts,\r\n  setSuggestions,\r\n  setSuggestionsError,\r\n  SET_PREFERENCE,\r\n} from '../actions'\r\nimport {\r\n  selectActiveTags,\r\n  selectHasMoreResults,\r\n  selectMinRating,\r\n  selectPageNumber,\r\n  selectPageSize,\r\n  selectPostById,\r\n  selectSort,\r\n  selectTagSuggestionCount,\r\n} from '../selectors'\r\n\r\nconst client = new R34Client(['https://r34-json.herokuapp.com', 'https://r34-api-clone.herokuapp.com'], {\r\n  version: 'v2',\r\n  useFirebase: true,\r\n  requestRetries: 1,\r\n  verbose: true,\r\n})\r\n\r\nconst apiRequests = (store: MiddlewareAPI) => (next: Dispatch<AppAction>) => async (action: AppAction) => {\r\n  const state = store.getState()\r\n  const hasMoreResults = selectHasMoreResults(state)\r\n\r\n  if (action.type === SET_PREFERENCE && action.key === 'backends') {\r\n    client.backends = action.value as string[]\r\n  }\r\n\r\n  if ((action as any).type === 'persist/REHYDRATE') {\r\n    if ((action as any)?.payload?.preferences?.backends) {\r\n      client.backends = (action as any).payload.preferences.backends\r\n    }\r\n  }\r\n\r\n  if (action.type === GET_RESULTS) {\r\n    const activeTags = selectActiveTags(state)\r\n    const pageSize = selectPageSize(state)\r\n    const minRating = selectMinRating(state)\r\n    const sort = selectSort(state)\r\n\r\n    const result = await client.getPosts({\r\n      tags: activeTags,\r\n      limit: pageSize,\r\n      page: action.pageNumber,\r\n      score: `>=${minRating}`,\r\n      sort,\r\n    })\r\n\r\n    store.dispatch(setPosts(result.posts, result.count, action.pageNumber))\r\n  }\r\n\r\n  if (action.type === GET_MORE_RESULTS && hasMoreResults) {\r\n    const activeTags = selectActiveTags(state)\r\n    const pageNumber = selectPageNumber(state)\r\n    const pageSize = selectPageSize(state)\r\n    const minRating = selectMinRating(state)\r\n    const sort = selectSort(state)\r\n\r\n    const result = await client.getPosts({\r\n      tags: activeTags,\r\n      limit: pageSize,\r\n      page: pageNumber + 1,\r\n      score: `>=${minRating}`,\r\n      sort,\r\n    })\r\n\r\n    store.dispatch(addPosts(result.posts))\r\n  }\r\n\r\n  if (action.type === ADD_TAG) {\r\n    const activeTags = selectActiveTags(state)\r\n    let aliases: AliasTag[] = []\r\n    try {\r\n      aliases = await client.getAliases({ name: action.tag.name })\r\n    } catch (err) {\r\n      console.warn('Failed toget aliases for tag:', action.tag)\r\n    }\r\n\r\n    const sanitizedAliases = aliases\r\n      .sort((a, b) => b.count - a.count)\r\n      .filter((alias) => !(alias.name in activeTags))\r\n      .map(({ name, count }) => ({ name, count, types: [] }))\r\n\r\n    store.dispatch(addAliases(sanitizedAliases, action.tag.name))\r\n\r\n    // Request types for newly added tag\r\n    if (!isSupertag(action.tag) && action.tag.types.length === 0) {\r\n      try {\r\n        const data = await client.getTags({\r\n          name: action.tag.name,\r\n          limit: 1,\r\n        })\r\n        if (!isSuggestionError(data)) {\r\n          const tag = data.find((tag) => tag.name === action.tag.name)\r\n\r\n          if (tag && !isSupertag(tag)) {\r\n            action.tag.types = tag.types\r\n            action.tag.count = tag.count\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.warn('Failed to get types for tag:', action.tag)\r\n      }\r\n    }\r\n  }\r\n\r\n  if (action.type === LIKE_POST) {\r\n    fetch(`https://rule34.xxx/index.php?page=post&s=vote&id=${action.postId}&type=up`, { mode: 'no-cors' })\r\n      .then(() => {\r\n        // nothing to do, I update the state in advance\r\n      })\r\n      .catch((err) => {\r\n        console.warn('Upvote rejected', err)\r\n      })\r\n  }\r\n\r\n  if (action.type === FETCH_SUGGESTIONS) {\r\n    const limit = selectTagSuggestionCount(state)\r\n    const result = await client.getTags({\r\n      name: serializeTagname(action.value),\r\n      limit,\r\n      supertags: action.includeSupertags,\r\n      sort: 'count',\r\n    })\r\n\r\n    if (isSuggestionError(result)) {\r\n      store.dispatch(setSuggestionsError(result))\r\n    } else {\r\n      store.dispatch(setSuggestions(result))\r\n    }\r\n  }\r\n\r\n  if (action.type === FETCH_COMMENTS) {\r\n    const post = selectPostById(action.postId)(state)\r\n\r\n    if (post) {\r\n      const commentsUrl = `https://rule34-api.netlify.app/comments?post_id=${post.id}`\r\n      const comments = await client.getComments({ commentsUrl })\r\n      store.dispatch(setComments(action.postId, comments))\r\n    }\r\n  }\r\n\r\n  next(action)\r\n}\r\n\r\nexport default apiRequests\r\n","import { AliasTag, AnyTag, api, ApiVersion, Artist, Comment } from 'r34-types'\r\nimport { getSupertags, init } from './firebase'\r\nimport { createSearchParams, ParamsRecord } from './utils'\r\nimport { isSuggestionError, serializeAllTags } from './tagUtils'\r\n\r\n/**\r\n * Configure your client.\r\n */\r\nexport interface R34ClientOptions {\r\n  /**\r\n   * API version to use.\r\n   */\r\n  version: ApiVersion\r\n  /**\r\n   * When set to true, the API provides additional, user-specific information like supertags.\r\n   */\r\n  useFirebase: boolean\r\n  /**\r\n   * Configure how many posts are returned by default\r\n   */\r\n  postLimit: number\r\n  /**\r\n   * Configure how many tags are returned by default\r\n   */\r\n  tagLimit: number\r\n  /**\r\n   * How many times to retry failed requests\r\n   */\r\n  requestRetries: number\r\n  /**\r\n   * Enables console logging\r\n   */\r\n  verbose: boolean\r\n}\r\n\r\n/**\r\n * Can be a single backend or multiple. If there are multiple it will automatically switch when one goes down.\r\n * Valid backends include protocol and port and do not have a trailing slash.\r\n * @example \"http://localhost:8080\"\r\n * @example \"https://my-api-server.herokuapp.com\"\r\n */\r\nexport type BackendsUrls = string | string[]\r\n\r\nexport class R34Client {\r\n  //#region Properties\r\n  private currentBackend: number\r\n\r\n  backends: string[]\r\n  useFirebase: boolean\r\n  postLimit: number\r\n  tagLimit: number\r\n  version: ApiVersion\r\n  requestRetries: number\r\n  verbose: boolean\r\n  //#endregion\r\n\r\n  //#region Management and Utils\r\n  /**\r\n   * Creates a new R34Client.\r\n   */\r\n  constructor(backends: BackendsUrls, options: Partial<R34ClientOptions> = {}) {\r\n    this.backends = typeof backends === 'string' ? [backends] : [...backends]\r\n    this.version = options.version || 'v2'\r\n    this.useFirebase = options.useFirebase || false\r\n    this.postLimit = options.postLimit || 20\r\n    this.tagLimit = options.tagLimit || 20\r\n    this.requestRetries = options.requestRetries || 1\r\n    this.verbose = options.verbose || false\r\n    this.currentBackend = 0\r\n\r\n    if (this.useFirebase) {\r\n      init()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Switches to the next backend in the list. When it runs out of backends returns to the first one.\r\n   */\r\n  private useNextBackend() {\r\n    this.currentBackend = (this.currentBackend + 1) % this.backends.length\r\n  }\r\n\r\n  /**\r\n   * Combines path with current backend and version to create a valid url\r\n   */\r\n  private getFullUrl(path: string, params: ParamsRecord): URL {\r\n    const host = this.backends[this.currentBackend]\r\n    const version = this.version\r\n    const search = createSearchParams(params).toString()\r\n\r\n    return new URL(`${host}/${version}/${path}?${search}`)\r\n  }\r\n\r\n  /**\r\n   * Wraps fetch with failover functionality\r\n   */\r\n  private async fetchWithFailover(\r\n    path: string,\r\n    params: ParamsRecord = {},\r\n    fetchOptions: Partial<RequestInit> = {},\r\n    retries = 0\r\n  ): Promise<Response> {\r\n    const url = this.getFullUrl(path, { ...params })\r\n\r\n    return fetch(url.toString(), fetchOptions).then((res) => {\r\n      if (!res.ok && this.backends.length > 1 && retries < this.requestRetries) {\r\n        if (this.verbose) {\r\n          console.warn(\r\n            `Fetch failed against ${url}. Status: ${res.status}. Retrying against next backend.\\nDetails:`,\r\n            res\r\n          )\r\n        }\r\n        this.useNextBackend()\r\n        return this.fetchWithFailover(path, params, fetchOptions, retries + 1)\r\n      }\r\n\r\n      return res\r\n    })\r\n  }\r\n  //#endregion\r\n\r\n  //#region API\r\n  //#region Tags\r\n  /**\r\n   * Retrieves tags given a searchTerm\r\n   */\r\n  private async fetchTags(params: api.params.Tags): Promise<api.responses.Tags> {\r\n    console.log(params)\r\n\r\n    const baseUrl = 'https://api.rule34.xxx/autocomplete.php?q='\r\n    const name = params.name?.replaceAll(' ', '_')\r\n    const fetched = await fetch(`${baseUrl}${name}`)\r\n\r\n    if (fetched.ok) {\r\n      const json = await fetched.json()\r\n      if (Array.isArray(json)) {\r\n        if (json.length === 0) {\r\n          throw new Error('No tags found')\r\n        } else {\r\n          return json.map((t) => ({\r\n            name: t.value,\r\n            count: Number(t.label.substring(t.label.lastIndexOf('(') + 1, t.label.length - 1)),\r\n            types: ['ambiguous'],\r\n          }))\r\n        }\r\n      } else if (json.message) {\r\n        return json\r\n      } else {\r\n        return { message: 'Invalid tag suggestions received', results: 0 }\r\n      }\r\n    } else {\r\n      return { message: 'Failed to load suggestions', results: 0 }\r\n    }\r\n  }\r\n\r\n  async getTags(params: api.params.Tags) {\r\n    try {\r\n      const result = await this.fetchTags(params)\r\n\r\n      if (isSuggestionError(result)) {\r\n        return result\r\n      }\r\n\r\n      let tags = result as AnyTag[]\r\n\r\n      const name = params.name\r\n\r\n      if (params.supertags && name) {\r\n        try {\r\n          const sanitzedName = name.replaceAll('*', '').toLowerCase()\r\n          const supertags = await getSupertags()\r\n          if (supertags) {\r\n            const matchingSupertags = Object.entries(supertags)\r\n              .filter(([key, _]) => key.toLowerCase().includes(sanitzedName))\r\n              .map(([name, details]) => ({\r\n                name,\r\n                ...details,\r\n              }))\r\n            tags = [...matchingSupertags, ...tags]\r\n          }\r\n        } catch {\r\n          // do nothing as supertags are only for registered users.\r\n        }\r\n      }\r\n\r\n      return tags\r\n    } catch (err) {\r\n      console.warn('Failed to get tags:', err)\r\n      return []\r\n    }\r\n  }\r\n  //#endregion\r\n\r\n  //#region Posts\r\n  getPostsUrl(pageNumber: number, limit: number, serializedTags: string) {\r\n    const url = `https://rule34-api.netlify.app/posts?limit=${limit.toString()}&pid=${pageNumber}`\r\n    return serializedTags === '' ? url : `${url}&tags=${serializedTags}`\r\n  }\r\n\r\n  /**\r\n   * This function can be used to retrieve a number of posts from the backend.\r\n   */\r\n  async getPosts(params: api.params.Posts) {\r\n    try {\r\n      let paramsInternal = {\r\n        limit: params.limit ?? this.postLimit,\r\n        pid: params.page ?? 0,\r\n        tags: '',\r\n      }\r\n\r\n      if (params.tags) paramsInternal.tags += serializeAllTags(params.tags)\r\n      if (params.score) paramsInternal.tags += `+score:${params.score}`\r\n      if (params.sort && params.sort !== 'date:desc') paramsInternal.tags += `+sort:${params.sort}`\r\n\r\n      const apiResponse = await fetch(this.getPostsUrl(paramsInternal.pid, paramsInternal.limit, paramsInternal.tags))\r\n\r\n      const text = await apiResponse.text()\r\n      const parser = new DOMParser()\r\n      const xml = parser.parseFromString(text, 'text/xml')\r\n\r\n      const count = Number(xml.getElementsByTagName('posts')[0].getAttribute('count'))\r\n      const posts = []\r\n\r\n      for (const post of xml.getElementsByTagName('post')) {\r\n        posts.push(this.parsePost(post.attributes))\r\n      }\r\n\r\n      return { count, posts }\r\n    } catch (err) {\r\n      console.warn('Failed to get posts:', err)\r\n      return { count: 0, posts: [] }\r\n    }\r\n  }\r\n\r\n  parsePost(post: any): any {\r\n    const height = post.getNamedItem('height').value\r\n    const score = post.getNamedItem('score').value\r\n    const file_url = post.getNamedItem('file_url').value\r\n    const parent_id = post.getNamedItem('parent_id').value\r\n    const sample_url = post.getNamedItem('sample_url').value\r\n    const sample_width = post.getNamedItem('sample_width').value\r\n    const sample_height = post.getNamedItem('sample_height').value\r\n    const preview_url = post.getNamedItem('preview_url').value\r\n    const rating = post.getNamedItem('rating').value\r\n    const tags = post.getNamedItem('tags').value\r\n    const id = post.getNamedItem('id').value\r\n    const width = post.getNamedItem('width').value\r\n    const change = post.getNamedItem('change').value\r\n    const md5 = post.getNamedItem('md5').value\r\n    const creator_id = post.getNamedItem('creator_id').value\r\n    const has_children = post.getNamedItem('has_children').value\r\n    const created_at = post.getNamedItem('created_at').value\r\n    const status = post.getNamedItem('status').value\r\n    const source = post.getNamedItem('source').value\r\n    const has_notes = post.getNamedItem('has_notes').value\r\n    const has_comments = post.getNamedItem('has_comments').value\r\n    const preview_width = post.getNamedItem('preview_width').value\r\n    const preview_height = post.getNamedItem('preview_height').value\r\n\r\n    return {\r\n      preview_url,\r\n      sample_url,\r\n      file_url,\r\n      created_at,\r\n      has_children: Boolean(has_children),\r\n      md5,\r\n      height: Number(height),\r\n      id: Number(id),\r\n      change: Number(change),\r\n      creator_id: Number(creator_id),\r\n      has_notes: Boolean(has_notes),\r\n      has_comments: Boolean(has_comments),\r\n      parent_id: parent_id ? Number(parent_id) : null,\r\n      preview_width: Number(preview_width),\r\n      preview_height: Number(preview_height),\r\n      rating,\r\n      sample_height: Number(sample_height),\r\n      sample_width: Number(sample_width),\r\n      score: Number(score),\r\n      source,\r\n      status,\r\n      tags: tags.split(' ').filter((tag: any, index: any, array: any) => tag !== '' && array.indexOf(tag) === index),\r\n      width: Number(width),\r\n      comments_url: '',\r\n      creator_url: '',\r\n      type:\r\n        file_url.endsWith('.webm') || file_url.endsWith('.mp4') ? 'video' : file_url.includes('.gif') ? 'gif' : 'image',\r\n    }\r\n  }\r\n  //#endregion\r\n\r\n  //#region Aliases\r\n  /**\r\n   * Returns all aliases for a given tag\r\n   */\r\n  async getAliases(params: api.params.Aliases) {\r\n    try {\r\n      const aliases: AliasTag[] = await (await this.fetchWithFailover('alias/' + params.name)).json()\r\n\r\n      return aliases\r\n    } catch (err) {\r\n      console.warn('Failed to get aliases:', err)\r\n      return []\r\n    }\r\n  }\r\n  //#endregion\r\n\r\n  //#region Comments\r\n  /**\r\n   * Returns all comments for a given post.\r\n   */\r\n  async getComments(params: api.params.Comments): Promise<api.responses.Comments> {\r\n    try {\r\n      // This does not use my api but it is included here for simplicity.\r\n      // Therefore, no failover etc.\r\n      const response = await fetch(params.commentsUrl)\r\n      const text = await response.text()\r\n      const parser = new DOMParser()\r\n      const xml = parser.parseFromString(text, 'text/xml')\r\n\r\n      const comments: Comment[] = []\r\n      for (const comment of xml.getElementsByTagName('comment')) {\r\n        const newComment = this.parseComment(comment.attributes)\r\n        comments.push(newComment)\r\n      }\r\n\r\n      return comments\r\n    } catch (err) {\r\n      console.warn('Failed to get comments:', err)\r\n      return []\r\n    }\r\n  }\r\n\r\n  parseComment = (comment: NamedNodeMap): Comment => {\r\n    let result = {} as Record<string, any>\r\n\r\n    for (const attr of comment) {\r\n      result[attr.name] = attr.value\r\n    }\r\n    return result as Comment\r\n  }\r\n  //#endregion\r\n\r\n  //#region Artists\r\n  async getArtist(params: api.params.Artist) {\r\n    try {\r\n      const artist: Artist = await (await this.fetchWithFailover('artist', params)).json()\r\n\r\n      return artist\r\n    } catch (err) {\r\n      console.warn('Failed to get aliases:', err)\r\n      return undefined\r\n    }\r\n  }\r\n  //#endregion\r\n  //#endregion\r\n}\r\n","import { applyMiddleware } from 'redux'\r\nimport analytics from './analytics'\r\nimport persistence from './persistence'\r\nimport requests from './requests'\r\nimport { composeWithDevTools } from 'redux-devtools-extension'\r\n\r\nconst middleware = composeWithDevTools(applyMiddleware(analytics, requests, persistence))\r\n\r\nexport default middleware\r\n","export const migrations = {\r\n  // Delete reader state\r\n  278: (state: any) => {\r\n    return {\r\n      ...state,\r\n      reader: undefined,\r\n    }\r\n  },\r\n  // Add autoscroll delay\r\n  279: (state: any) => {\r\n    return {\r\n      ...state,\r\n      preferences: {\r\n        ...state.preferences,\r\n        autoscrollDelay: 10,\r\n      },\r\n    }\r\n  },\r\n  // Removed electric theme\r\n  285: (state: any) => {\r\n    if (state.preferences.themeId === 'electric') {\r\n      return {\r\n        ...state,\r\n        preferences: {\r\n          ...state.preferences,\r\n          themeId: 'deepsea',\r\n        },\r\n      }\r\n    } else {\r\n      return state\r\n    }\r\n  },\r\n  288: (state: any) => {\r\n    return {\r\n      ...state,\r\n      preferences: {\r\n        ...state.preferences,\r\n        showPostDetails: true,\r\n      },\r\n    }\r\n  },\r\n  289: (state: any) => {\r\n    return {\r\n      ...state,\r\n      preferences: {\r\n        ...state.preferences,\r\n        backends: ['https://r34-json.herokuapp.com', 'https://r34-api-clone.herokuapp.com'],\r\n      },\r\n    }\r\n  },\r\n  301: (state: any) => {\r\n    return {\r\n      ...state,\r\n      preferences: {\r\n        ...state.preferences,\r\n        backends: ['https://json-api.onrender.com'],\r\n      },\r\n    }\r\n  },\r\n}\r\n","import produce from 'immer'\r\nimport { Comment, Post } from 'r34-types'\r\nimport { SET_POSTS, ADD_POSTS, SET_COMMENTS, AppAction } from '../actions'\r\n\r\nexport interface ResultsState {\r\n  posts: Post[]\r\n  pageNumber: number\r\n  count: number\r\n  updated: number\r\n}\r\n\r\nconst initialResultsState: ResultsState = {\r\n  posts: [],\r\n  pageNumber: 0,\r\n  count: 0,\r\n  updated: 0,\r\n}\r\n\r\nconst addPosts = (state: ResultsState, posts: Post[]) =>\r\n  produce(state, (draft) => {\r\n    draft.posts = [...state.posts, ...posts]\r\n    draft.pageNumber = state.pageNumber + 1\r\n    draft.updated = new Date().getTime()\r\n  })\r\n\r\nconst setPosts = (state: ResultsState, posts: Post[], postCount: number, pageNumber: number = 0) =>\r\n  produce(state, (draft) => {\r\n    draft.posts = posts\r\n    draft.count = postCount\r\n    draft.pageNumber = pageNumber\r\n    draft.updated = new Date().getTime()\r\n  })\r\n\r\nconst setComments = (state: ResultsState, postId: number, comments: Comment[]) =>\r\n  produce(state, (draft) => {\r\n    const postIndex = state.posts.findIndex((p) => p.id === postId)\r\n    if (postIndex >= 0) {\r\n      draft.posts[postIndex].comments = comments\r\n    }\r\n  })\r\n\r\nconst results = (state: ResultsState = initialResultsState, action: AppAction): ResultsState => {\r\n  switch (action.type) {\r\n    case ADD_POSTS:\r\n      return addPosts(state, action.posts)\r\n    case SET_POSTS:\r\n      return setPosts(state, action.posts, action.count, action.pageNumber)\r\n    case SET_COMMENTS:\r\n      return setComments(state, action.postId, action.comments)\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default results\r\n","import produce from 'immer'\r\nimport { AliasTag, AnyBiasedTag } from 'r34-types'\r\nimport { ADD_TAG, AppAction, REMOVE_TAG, ADD_ALIASES } from '../actions'\r\n\r\nexport interface TagsState {\r\n  active: Record<string, AnyBiasedTag>\r\n  aliases: Record<string, AliasTag[]>\r\n}\r\n\r\nconst initialTagsState: TagsState = {\r\n  active: {},\r\n  aliases: {},\r\n}\r\n\r\nconst addTag = (state: TagsState, newTag: AnyBiasedTag) =>\r\n  produce(state, (draft) => {\r\n    draft.active[newTag.name] = { ...state.active[newTag.name], ...newTag }\r\n  })\r\n\r\nconst addAliases = (state: TagsState, aliases: AliasTag[], forTag: string) =>\r\n  produce(state, (draft) => {\r\n    draft.aliases[forTag] = aliases\r\n  })\r\n\r\nconst removeTag = (state: TagsState, tagName: string) =>\r\n  produce(state, (draft) => {\r\n    delete draft.active[tagName]\r\n    delete draft.aliases[tagName]\r\n  })\r\n\r\nconst tags = (state: TagsState = initialTagsState, action: AppAction): TagsState => {\r\n  switch (action.type) {\r\n    case ADD_TAG:\r\n      return addTag(state, action.tag)\r\n    case REMOVE_TAG:\r\n      return removeTag(state, action.tagName)\r\n    case ADD_ALIASES:\r\n      return addAliases(state, action.aliases, action.forTag)\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default tags\r\n","import produce from 'immer'\r\nimport { ENTER_FULLSCREEN, EXIT_FULLSCREEN, SET_FULLSCREEN_POST, AppAction, SCROLL_TO_POST } from '../actions'\r\n\r\nexport interface FullscreenState {\r\n  isEnabled: boolean\r\n  currentIndex: number\r\n  scrollIndex: number | null\r\n}\r\n\r\nconst initialFullscreenState: FullscreenState = {\r\n  isEnabled: false,\r\n  currentIndex: 0,\r\n  scrollIndex: null,\r\n}\r\n\r\nconst enterFullscreen = (state: FullscreenState, index: number) =>\r\n  produce(state, (draft) => {\r\n    draft.isEnabled = true\r\n    draft.currentIndex = index\r\n  })\r\n\r\nconst exitFullscreen = (state: FullscreenState) =>\r\n  produce(state, (draft) => {\r\n    draft.isEnabled = false\r\n  })\r\n\r\nconst setIndex = (state: FullscreenState, index: number) =>\r\n  produce(state, (draft) => {\r\n    draft.currentIndex = index\r\n  })\r\n\r\nconst setScrollIndex = (state: FullscreenState, index: number) =>\r\n  produce(state, (draft) => {\r\n    draft.scrollIndex = index\r\n  })\r\n\r\nexport const fullscreen = (state: FullscreenState = initialFullscreenState, action: AppAction): FullscreenState => {\r\n  switch (action.type) {\r\n    case ENTER_FULLSCREEN:\r\n      return enterFullscreen(state, action.postId)\r\n    case SET_FULLSCREEN_POST:\r\n      return setIndex(state, action.index)\r\n    case EXIT_FULLSCREEN:\r\n      return exitFullscreen(state)\r\n    case SCROLL_TO_POST:\r\n      return setScrollIndex(state, action.index)\r\n    default:\r\n      return state\r\n  }\r\n}\r\n","import produce from 'immer'\r\nimport { AppAction, LIKE_POST } from '../actions'\r\n\r\n/**\r\n * Key is postId, Value is time of like\r\n */\r\nexport type LikesState = Record<number, number>\r\n\r\nconst initialLikesState: LikesState = {}\r\n\r\nconst likePost = (state: LikesState, postId: number) =>\r\n  produce(state, (draft) => {\r\n    if (!(postId in state)) {\r\n      draft[postId] = Date.now()\r\n    }\r\n\r\n    // NOTE: Might need to introduce a cap here...\r\n    // Like 1000 likes max, delete oldest when more are added?\r\n  })\r\n\r\nconst likes = (state: LikesState = initialLikesState, action: AppAction): LikesState => {\r\n  switch (action.type) {\r\n    case LIKE_POST:\r\n      return likePost(state, action.postId)\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default likes\r\n","import produce from 'immer'\r\nimport { ModalId } from '../../data/types'\r\nimport { AppAction, CLOSE_MODAL, OPEN_MODAL } from '../actions'\r\n\r\nexport interface ModalsState {\r\n  openModal: ModalId | null\r\n}\r\n\r\nconst initialModalsState: ModalsState = {\r\n  openModal: null,\r\n}\r\n\r\nconst setOpenModal = (state: ModalsState, modalId: ModalId | null) =>\r\n  produce(state, (draft) => {\r\n    draft.openModal = modalId\r\n  })\r\n\r\nconst modals = (state: ModalsState = initialModalsState, action: AppAction): ModalsState => {\r\n  switch (action.type) {\r\n    case OPEN_MODAL:\r\n      return setOpenModal(state, action.modalId)\r\n    case CLOSE_MODAL:\r\n      return setOpenModal(state, null)\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default modals\r\n","import produce from 'immer'\r\nimport * as r34 from 'r34-types'\r\nimport { SuggestionsError } from '../../data/types'\r\nimport { AppAction, SET_SUGGESTIONS, SET_SUGGESTIONS_ERROR, SET_SUGGESTIONS_MODIFIER } from '../actions'\r\n\r\nexport interface SuggestionsState {\r\n  entries: r34.AnyTag[]\r\n  error: SuggestionsError | null\r\n  modifier: r34.TagModifier\r\n}\r\n\r\nconst initialSuggestionsState: SuggestionsState = {\r\n  entries: [],\r\n  error: null,\r\n  modifier: '+',\r\n}\r\n\r\nconst setSuggestions = (state: SuggestionsState, suggestions: r34.AnyTag[]) =>\r\n  produce(state, (draft) => {\r\n    draft.entries = suggestions\r\n    draft.error = null\r\n  })\r\n\r\nconst setError = (state: SuggestionsState, error: SuggestionsError) =>\r\n  produce(state, (draft) => {\r\n    draft.entries = []\r\n    draft.error = error\r\n  })\r\n\r\nconst setModifier = (state: SuggestionsState, modifier: r34.TagModifier) =>\r\n  produce(state, (draft) => {\r\n    draft.modifier = modifier\r\n  })\r\n\r\nconst suggestions = (state: SuggestionsState = initialSuggestionsState, action: AppAction): SuggestionsState => {\r\n  switch (action.type) {\r\n    case SET_SUGGESTIONS:\r\n      return setSuggestions(state, action.suggestions)\r\n    case SET_SUGGESTIONS_ERROR:\r\n      return setError(state, action.error)\r\n    case SET_SUGGESTIONS_MODIFIER:\r\n      return setModifier(state, action.modifier)\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default suggestions\r\n","import { combineReducers } from 'redux'\r\nimport preferences from './preferences'\r\nimport results from './results'\r\nimport tags from './tags'\r\nimport { fullscreen } from './fullscreen'\r\nimport likes from './likes'\r\nimport modals from './modals'\r\nimport suggestions from './suggestions'\r\n\r\nexport default combineReducers({ tags, results, preferences, fullscreen, likes, suggestions, modals })\r\n","import { createStore } from 'redux'\r\nimport { createMigrate, persistReducer, persistStore } from 'redux-persist'\r\nimport storage from 'redux-persist/lib/storage'\r\nimport { getVersion, versionToNumber } from '../data/utils'\r\nimport middleware from './middleware'\r\nimport { migrations } from './migrations'\r\nimport rootReducer from './reducers'\r\n\r\nconst version = getVersion()\r\n\r\nconst persistConfig = {\r\n  key: 'appstate',\r\n  version: versionToNumber(version),\r\n  storage,\r\n  migrate: createMigrate(migrations),\r\n}\r\n\r\nconst persistedReducer = persistReducer(persistConfig, rootReducer)\r\n\r\nexport const store = createStore(persistedReducer, middleware)\r\n\r\nexport const persistor = persistStore(store)\r\n","import React, { Suspense } from 'react'\r\nimport { Helmet } from 'react-helmet'\r\nimport { Provider, useSelector } from 'react-redux'\r\nimport { HashRouter, Route, Switch } from 'react-router-dom'\r\nimport { PersistGate } from 'redux-persist/integration/react'\r\nimport { ThemeProvider } from 'styled-components'\r\nimport ErrorBoundary from './components/features/ErrorBoundary'\r\nimport GlobalKeybindings from './components/features/GlobalKeybindings'\r\nimport ErrorScreen from './components/pages/ErrorScreen'\r\nimport LoadingScreen from './components/pages/LoadingScreen'\r\nimport Terms from './components/pages/Terms'\r\nimport CellularWarningModal from './components/widgets/CellularWarningModal'\r\nimport CookieConfirmation from './components/widgets/CookieConfirmation'\r\nimport SupertagModal from './components/widgets/SupertagModal'\r\nimport { RouteName } from './data/types'\r\nimport './client/firebase' // init firebase immediately\r\nimport GlobalStyles from './GlobalStyles'\r\nimport {\r\n  selectActiveThemeId,\r\n  selectCellularWarningModalOpen,\r\n  selectCookies,\r\n  selectSupertagModalOpen,\r\n} from './redux/selectors'\r\nimport { persistor, store } from './redux/store'\r\nimport { themes, defaultThemeId } from 'r34-branding'\r\n\r\nconst About = React.lazy(() => import('./components/pages/About'))\r\nconst Privacy = React.lazy(() => import('./components/pages/Privacy'))\r\nconst Search = React.lazy(() => import('./components/pages/Search'))\r\nconst Preferences = React.lazy(() => import('./components/pages/Preferences'))\r\nconst Share = React.lazy(() => import('./components/pages/Share'))\r\nconst Stories = React.lazy(() => import('./components/pages/Stories'))\r\n\r\nconst loadingScreen = <LoadingScreen />\r\n\r\nexport default function App() {\r\n  return (\r\n    <ErrorBoundary fallback={<ErrorScreen />}>\r\n      <Provider store={store}>\r\n        <PersistGate loading={loadingScreen} persistor={persistor}>\r\n          <ThemedApp />\r\n        </PersistGate>\r\n      </Provider>\r\n    </ErrorBoundary>\r\n  )\r\n}\r\n\r\nfunction ThemedApp() {\r\n  const cookies = useSelector(selectCookies)\r\n  const isCellularWarningModalOpen = useSelector(selectCellularWarningModalOpen)\r\n  const isSupertagModalOpen = useSelector(selectSupertagModalOpen)\r\n  const themeId = useSelector(selectActiveThemeId)\r\n  const theme = themes[themeId || defaultThemeId]\r\n\r\n  // useLoadPreferences()\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <GlobalStyles />\r\n      <GlobalKeybindings />\r\n      <Helmet>\r\n        <meta name='theme-color' content={theme.colors.layerBgSolid} />\r\n      </Helmet>\r\n      <HashRouter>\r\n        <Suspense fallback={loadingScreen}>\r\n          <Switch>\r\n            <Route exact path={RouteName.ABOUT} component={About} />\r\n            <Route exact path={RouteName.PRIVACY} component={Privacy} />\r\n            <Route exact path={RouteName.PREFERENCES} component={Preferences} />\r\n            <Route exact path={RouteName.STORIES} component={Stories} />\r\n            <Route exact path={RouteName.TERMS} component={Terms} />\r\n            <Route exact path={RouteName.SHARE} component={Share} />\r\n            <Route path={RouteName.SEARCH} component={Search} />\r\n          </Switch>\r\n        </Suspense>\r\n\r\n        {isSupertagModalOpen && <SupertagModal />}\r\n        {isCellularWarningModalOpen && <CellularWarningModal />}\r\n        {!cookies && <CookieConfirmation />}\r\n      </HashRouter>\r\n    </ThemeProvider>\r\n  )\r\n}\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n)\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void\r\n}\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config)\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          )\r\n        })\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing\r\n        if (installingWorker == null) {\r\n          return\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              )\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration)\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.')\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error)\r\n    })\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type')\r\n      if (response.status === 404 || (contentType != null && contentType.indexOf('javascript') === -1)) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload()\r\n          })\r\n        })\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.')\r\n    })\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister()\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message)\r\n      })\r\n  }\r\n}\r\n","// Polyfills\r\nimport 'whatwg-fetch'\r\n\r\nimport * as Sentry from '@sentry/react'\r\nimport { Offline } from '@sentry/integrations'\r\nimport ReactDOM from 'react-dom'\r\nimport App from './App'\r\nimport { getVersionString } from './data/utils'\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration'\r\n\r\nSentry.init({\r\n  dsn: 'https://1a2933d829da41fe84d4dab5fcc520ae@o955708.ingest.sentry.io/5905045',\r\n  integrations: [new Offline()],\r\n  tracesSampleRate: 1.0,\r\n  release: getVersionString(),\r\n  allowUrls: [/https:\\/\\/kurozenzen\\.github\\.io(.*)/, /https:\\/\\/r34-json\\.herokuapp\\.com(.*)/],\r\n  ignoreErrors: [\r\n    // Random plugins/extensions\r\n    'top.GLOBALS',\r\n    // See: http://blog.errorception.com/2012/03/tale-of-unfindable-js-error.html\r\n    'originalCreateNotification',\r\n    'canvas.contentDocument',\r\n    'MyApp_RemoveAllHighlights',\r\n    'http://tt.epicplay.com',\r\n    \"Can't find variable: ZiteReader\",\r\n    'jigsaw is not defined',\r\n    'ComboSearch is not defined',\r\n    'http://loading.retry.widdit.com/',\r\n    'atomicFindClose',\r\n  ],\r\n  denyUrls: [\r\n    // Chrome extensions\r\n    /extensions\\//i,\r\n    /^chrome:\\/\\//i,\r\n  ],\r\n  beforeBreadcrumb(breadcrumb, hint) {\r\n    try {\r\n      if (breadcrumb?.category?.startsWith('ui')) {\r\n        const target = hint?.event.target as HTMLElement\r\n        const tag = target.tagName.toLowerCase()\r\n        if (target.innerText) {\r\n          breadcrumb.message = `${tag}: ${target.innerText}`\r\n        } else if (target.id) {\r\n          breadcrumb.message = `${tag}: ${target.id}`\r\n        } else if (target.getAttribute('name')) {\r\n          breadcrumb.message = `${tag}: ${target.getAttribute('name')}`\r\n        } else if (target.title) {\r\n          breadcrumb.message = `${tag}: ${target.title}`\r\n        } else if (target.getAttribute('aria-label')) {\r\n          breadcrumb.message = `${tag}: ${target.getAttribute('aria-label')}`\r\n        } else if (target.getAttribute('data-name')) {\r\n          breadcrumb.message = `${tag}: ${target.getAttribute('data-name')}`\r\n        }\r\n      }\r\n    } catch (err) {\r\n      // fancy breadcrumbs are optional. So no error handling required.\r\n    }\r\n    return breadcrumb\r\n  },\r\n})\r\n\r\nReactDOM.render(\r\n  // <React.StrictMode>\r\n  <App />,\r\n  // </React.StrictMode>\r\n  document.getElementById('app-root')\r\n)\r\n\r\nserviceWorkerRegistration.register()\r\n"],"sourceRoot":""}